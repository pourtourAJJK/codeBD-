<!-- 订单确认页 -->
<view class="confirm-container">
  <!-- 页面头部 -->
  <view class="page-header">
    <view class="header-left" bindtap="navigateBack">
    </view>
    <view class="header-title">确认订单</view>
    <view class="header-right"></view>
  </view>

  <!-- 地址选择区域 -->
  <view class="address-section" bindtap="selectAddress">
    <view class="address-icon">
    </view>
    <view class="address-info" wx:if="{{selectedAddress}}">
      <view class="consignee">
        <text class="name">{{selectedAddress.name}}</text>
        <text class="phone">{{selectedAddress.phone}}</text>
      </view>
      <view class="address-detail">
        <text class="full-address">{{selectedAddress.province}}{{selectedAddress.city}}{{selectedAddress.district}}{{selectedAddress.detail}}</text>
      </view>
    </view>
    <view class="no-address" wx:else>
      <text>请选择收货地址</text>
    </view>
    <view class="address-arrow">
      <image src="cloud://fuxididai8888-5g9tptvfb7056681.6675-fuxididai8888-5g9tptvfb7056681-1397228946/xiaotubiao/定位.png" mode="aspectFit"></image>
    </view>
  </view>

  <!-- 商品信息区域 -->
  <view class="products-section">
    <view class="section-title">商品信息</view>
    <block wx:for="{{orderItems}}" wx:key="productId">
      <view class="product-item" bindtap="navigateToDetail" data-product-id="{{item.productId}}">
        <image class="product-image" src="{{item.productImage}}" mode="aspectFit"></image>
        <view class="product-info">
          <view class="product-title">{{item.productTitle}}</view>
          <view class="product-spec">{{item.spec}}</view>
          <view class="product-bottom">
            <view class="product-price">
              <text class="price-symbol">¥</text>
              <text class="price-value">{{item.currentPrice}}</text>
            </view>
            <view class="product-quantity">
              x{{item.quantity}}
            </view>
          </view>
        </view>
      </view>
    </block>
  </view>

  <!-- 配送方式 -->
  <view class="delivery-section">
    <view class="section-title">配送方式</view>
    <view class="delivery-options">
      <radio-group bindchange="onDeliveryChange" data-type="express">
        <label class="delivery-option" wx:for="{{deliveryOptions}}" wx:key="id">
          <radio value="{{item.id}}" checked="{{item.id === selectedDelivery.id}}" color="#ff4d4f"></radio>
          <text class="option-name">{{item.name}}</text>
          <text class="option-fee" wx:if="{{item.fee > 0}}">+¥{{item.fee}}</text>
          <text class="option-fee free" wx:else>免费</text>
        </label>
      </radio-group>
    </view>
  </view>

  <!-- 支付方式 -->
  <view class="payment-section">
    <view class="section-title">支付方式</view>
    <view class="payment-options">
      <radio-group bindchange="onPaymentChange" data-type="payment">
        <label class="payment-option" wx:for="{{paymentOptions}}" wx:key="id">
          <radio value="{{item.id}}" checked="{{item.id === selectedPayment.id}}" color="#ff4d4f"></radio>
          <image class="payment-icon" src="{{item.icon}}" mode="aspectFit"></image>
          <text class="option-name">{{item.name}}</text>
        </label>
      </radio-group>
    </view>
  </view>

  <!-- 订单备注 -->
  <view class="remark-section">
    <view class="section-title">订单备注</view>
    <input class="remark-input" placeholder="选填，请输入订单备注" value="{{orderRemark}}" bindinput="onRemarkChange"></input>
  </view>

  <!-- 价格详情 -->
  <view class="price-section">
    <view class="price-item">
      <text class="price-label">商品总价</text>
      <text class="price-value">¥{{subtotalPrice}}</text>
    </view>
    <view class="price-item">
      <text class="price-label">配送费</text>
      <text class="price-value">{{deliveryFee > 0 ? '¥' + deliveryFee : '免费'}}</text>
    </view>
    <view class="price-item total">
      <text class="price-label">实付款</text>
      <text class="price-value total"><text class="price-symbol">¥</text>{{totalPrice}}</text>
    </view>
  </view>

  <!-- 底部提交区域 -->
  <view class="submit-section">
    <view class="total-price">
      <text class="price-label">合计：</text>
      <text class="price-value"><text class="price-symbol">¥</text>{{totalPrice}}</text>
    </view>
    <button class="submit-btn" bindtap="submitOrder" disabled="{{!selectedAddress || submitting}}">
      {{submitting ? '提交中...' : '提交订单'}}
    </button>
  </view>

  <!-- 加载遮罩 -->
  <view class="loading-mask" wx:if="{{submitting}}">
    <view class="loading-content">
      <image class="loading-icon" src="cloud://fuxididai8888-5g9tptvfb7056681.6675-fuxididai8888-5g9tptvfb7056681-1397228946/xiaotubiao/加载动画.gif" mode="aspectFit"></image>
      <view class="loading-text">提交中...</view>
    </view>
  </view>
</view>