<!-- è®¢å•åˆ—è¡¨é¡µé¢ - ä¿®å¤æ ·å¼ä¸åŠŸèƒ½ -->
<view class="container">
  <!-- æ ‡ç­¾åˆ‡æ¢æ  -->
  <view class="tab-bar">
    <view 
      class="tab-item {{activeTab === 'all' ? 'active' : ''}}" 
      data-tab="all" 
      bindtap="switchTab"
    >
      å…¨éƒ¨
    </view>
    <view 
      class="tab-item {{activeTab === 'pending' ? 'active' : ''}}" 
      data-tab="pending" 
      bindtap="switchTab"
    >
      å¾…æ”¯ä»˜
    </view>
    <view 
      class="tab-item {{activeTab === 'paid' ? 'active' : ''}}" 
      data-tab="paid" 
      bindtap="switchTab"
    >
      å·²æ”¯ä»˜
    </view>
    <view 
      class="tab-item {{activeTab === 'shipped' ? 'active' : ''}}" 
      data-tab="shipped" 
      bindtap="switchTab"
    >
      å·²å‘è´§
    </view>
    <view 
      class="tab-item {{activeTab === 'completed' ? 'active' : ''}}" 
      data-tab="completed" 
      bindtap="switchTab"
    >
      å·²å®Œæˆ
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading">
    <view class="loading-spinner"></view>
    <text>åŠ è½½ä¸­...</text>
  </view>

  <!-- é”™è¯¯æç¤º -->
  <view wx:if="{{errorMsg && errorMsg !== ''}}" class="error-tip">
    {{errorMsg}}
  </view>

  <!-- ç©ºè®¢å•æç¤º -->
  <view wx:if="{{!loading && orders.length === 0}}" class="empty">
    <view class="empty-icon">ğŸ“¦</view>
    <text class="empty-text">æš‚æ— ç›¸å…³è®¢å•</text>
    <button class="empty-btn" bindtap="goShopping">å»è´­ç‰©</button>
  </view>

  <!-- è®¢å•åˆ—è¡¨ - å›¾äºŒé£æ ¼çš„è®¢å•å¡ç‰‡ -->
  <view wx:else class="order-list">
    <view wx:for="{{orders}}" wx:key="orderId" class="order-card">
      <!-- åº—é“ºä¿¡æ¯ -->
      <view class="shop-info">
        <text class="shop-name">ç¡’å…»å±±æ³‰</text>
        <view class="order-status" style="color: {{item.statusColor}}">
          {{item.statusText}}
        </view>
      </view>

      <!-- è®¢å•ä¿¡æ¯ -->
      <view class="order-info">
        <view class="info-row">
          <text class="info-label">å–å•å·</text>
          <text class="info-value">{{item.orderId}}</text>
        </view>
        <view class="info-row">
          <text class="info-label">ä¸‹å•æ—¶é—´</text>
          <text class="info-value">{{item.createTime}}</text>
        </view>
      </view>

      <!-- å•†å“åˆ—è¡¨ -->
      <view class="product-list">
        <view wx:for="{{item.items}}" wx:for-item="product" wx:key="productId" class="product-item">
          <image 
            class="product-img" 
            src="{{product.cover_image}}" 
            mode="widthFix"
            bindtap="viewProductDetail"
            data-productId="{{product.productId}}"
          ></image>
          <view class="product-info">
            <text class="product-name">{{product.productName}}</text>
            <text class="product-spec">{{product.spec || 'é»˜è®¤è§„æ ¼'}}</text>
            <view class="product-price-count">
              <text class="product-price">{{item.formatPrice(product.price)}}</text>
              <text class="product-count">x{{product.quantity}}</text>
            </view>
          </view>
        </view>
        <view wx:if="{{item.items.length > 1}}" class="product-more">
          å…±{{item.productCount}}ä»¶å•†å“
        </view>
      </view>

      <!-- é‡‘é¢ä¿¡æ¯ -->
      <view class="amount-info">
        <view class="amount-row">
          <text class="amount-label">å•†å“é‡‘é¢</text>
          <text class="amount-value">{{item.formatPrice(item.totalPrice)}}</text>
        </view>
        <view class="amount-row">
          <text class="amount-label">é…é€è´¹</text>
          <text class="amount-value">{{item.formatPrice(item.deliveryFee || 0)}}</text>
        </view>
        <view class="amount-total">
          <text class="total-label">åˆè®¡</text>
          <text class="total-value">{{item.formatPrice(item.totalPrice + (item.deliveryFee || 0))}}</text>
        </view>
      </view>

      <!-- æ“ä½œæŒ‰é’® -->
      <view class="action-buttons">
        <!-- ç®¡ç†æŒ‰é’®ï¼ˆæ‰€æœ‰çŠ¶æ€éƒ½æ˜¾ç¤ºï¼‰ -->
        <button 
          class="btn-secondary" 
          bindtap="manageOrder"
          data-orderId="{{item.orderId}}"
        >
          ç®¡ç†
        </button>
        
        <!-- å¾…æ”¯ä»˜çŠ¶æ€ -->
        <button 
          wx:if="{{item.status === 'pending'}}" 
          class="btn-primary" 
          bindtap="payOrder"
          data-orderId="{{item.orderId}}"
        >
          å»æ”¯ä»˜
        </button>

        <!-- å·²æ”¯ä»˜å¾…å‘è´§ -->
        <button 
          wx:if="{{item.status === 'paid'}}" 
          class="btn-primary" 
          bindtap="viewOrderDetail"
          data-orderId="{{item.orderId}}"
        >
          æŸ¥çœ‹è¯¦æƒ…
        </button>

        <!-- å·²å‘è´§å¾…æ”¶è´§ -->
        <button 
          wx:if="{{item.status === 'shipped'}}" 
          class="btn-primary" 
          bindtap="confirmReceipt"
          data-orderId="{{item.orderId}}"
        >
          ç¡®è®¤æ”¶è´§
        </button>

        <!-- å·²å®Œæˆ/å·²å–æ¶ˆ -->
        <button 
          wx:if="{{item.status === 'completed' || item.status === 'cancelled'}}" 
          class="btn-primary" 
          bindtap="viewOrderDetail"
          data-orderId="{{item.orderId}}"
        >
          æŸ¥çœ‹è¯¦æƒ…
        </button>
      </view>
    </view>
  </view>
</view>