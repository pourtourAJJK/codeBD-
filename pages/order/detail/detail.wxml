<!-- 订单详情页面 -->
<view class="order-detail">
  <!-- 订单状态 -->
  <view class="order-status">
    <text class="status-text">{{statusText}}</text>
  </view>
  
  <!-- 收货地址 -->
  <view class="address-section">
    <view class="section-title">收货地址</view>
    <view class="address-content" wx:if="order.address">
      <view class="address-info">
        <view class="user-info">
          <text class="name">{{order.address.name}}</text>
          <text class="phone">{{order.address.phone}}</text>
        </view>
        <view class="address-detail">
          {{order.address.province}}{{order.address.city}}{{order.address.district}}{{order.address.detail}}
        </view>
      </view>
    </view>
  </view>
  
  <!-- 商品列表 -->
  <view class="goods-section">
    <view class="section-title">商品信息</view>
    <view class="goods-list">
      <view class="goods-item" wx:for="{{order.goods}}" wx:key="product_id" wx:for-item="item">
        <image class="goods-image" src="{{item.cover_image || '/assets/images/default-product.png'}}" mode="aspectFill"></image>
        <view class="goods-info">
          <text class="goods-name">{{item.product_name}}</text>
          <text class="goods-spec" wx:if="item.spec">{{item.spec}}</text>
          <view class="goods-price-count">
            <text class="price">¥{{item.priceYuan}}</text>
            <text class="count">x{{item.quantity}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>
  
  <!-- 订单信息 -->
  <view class="order-info-section">
    <view class="section-title">订单信息</view>
    <view class="order-info">
      <view class="info-item">
        <text class="label">订单编号</text>
        <text class="value">{{order._id}}</text>
      </view>
      <view class="info-item">
        <text class="label">下单时间</text>
        <text class="value">{{formatTime(order.createTime)}}</text>
      </view>
      <view class="info-item">
        <text class="label">支付方式</text>
        <text class="value">{{order.paymentMethod}}</text>
      </view>
      <view class="info-item" wx:if="order.paymentTime">
        <text class="label">支付时间</text>
        <text class="value">{{formatTime(order.paymentTime)}}</text>
      </view>
      <view class="info-item" wx:if="order.deliveryTime">
        <text class="label">发货时间</text>
        <text class="value">{{formatTime(order.deliveryTime)}}</text>
      </view>
      <view class="info-item" wx:if="order.deliveryCompany && order.trackingNumber">
        <text class="label">物流信息</text>
        <text class="value">
          {{order.deliveryCompany}} {{order.trackingNumber}}
        </text>
      </view>
    </view>
  </view>
  
  <!-- 价格明细 -->
  <view class="price-section">
    <view class="section-title">价格明细</view>
    <view class="price-info">
      <view class="price-item">
        <text class="label">商品总价</text>
        <text class="value">¥{{order.totalPriceYuan}}</text>
      </view>
      <view class="price-item">
        <text class="label">运费</text>
        <text class="value">¥{{order.shippingFeeYuan}}</text>
      </view>
      <view class="price-item" wx:if="order.discountAmount > 0">
        <text class="label">优惠</text>
        <text class="value discount">-¥{{order.discountAmountYuan}}</text>
      </view>
      <view class="price-item total">
        <text class="label">实付金额</text>
        <text class="value total-value">¥{{order.payAmountYuan}}</text>
      </view>
    </view>
  </view>
  
  <!-- 操作按钮 -->
  <view class="action-buttons" wx:if="order">
    <button class="btn" wx:if="order.status === 'pending'" bindtap="goToPay">去支付</button>
    <button class="btn btn-secondary" wx:if="order.status === 'pending'" bindtap="cancelOrder">取消订单</button>
    <button class="btn" wx:if="order.status === 'paid'">提醒发货</button>
    <button class="btn" wx:if="order.status === 'shipped'" bindtap="confirmReceipt">确认收货</button>
    <button class="btn" wx:if="order.status === 'delivered'" bindtap="viewOrder">查看订单</button>
    <!-- 添加订单查询按钮 -->
    <button class="btn btn-info" bindtap="queryWxOrder">查询订单</button>
    <!-- 添加申请退款按钮，仅在已支付或已发货状态显示 -->
    <button class="btn btn-warning" wx:if="order.status === 'paid' || order.status === 'shipped'" bindtap="applyRefund">申请退款</button>
  </view>
</view>