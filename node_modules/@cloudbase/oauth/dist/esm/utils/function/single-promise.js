let jsSdkFnPromiseMap = new Map();
export class SinglePromise {
    constructor(options) {
        this.clientId = options?.clientId || '';
        jsSdkFnPromiseMap = (jsSdkFnPromiseMap || new Map());
    }
    async run(key, fn) {
        key = `${this.clientId}_${key}`;
        let result = jsSdkFnPromiseMap.get(key);
        if (!result) {
            result = new Promise((resolve, reject) => {
                (async () => {
                    try {
                        await this.runIdlePromise();
                        const fnResult = fn();
                        resolve(await fnResult);
                    }
                    catch (error) {
                        reject(error);
                    }
                    finally {
                        jsSdkFnPromiseMap.delete(key);
                    }
                })();
            });
            jsSdkFnPromiseMap.set(key, result);
        }
        return result;
    }
    runIdlePromise() {
        return Promise.resolve();
    }
}
