"use strict";
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.CloudbaseOAuth = exports.AUTH_STATE_CHANGED_TYPE = exports.EVENTS = exports.LOGIN_STATE_CHANGED_TYPE = exports.weappJwtDecodeAll = exports.authModels = exports.AuthError = exports.OAUTH_TYPE = exports.AUTH_API_PREFIX = exports.Auth = void 0;
var oauth2client_1 = require("./oauth2client/oauth2client");
var apis_1 = require("./auth/apis");
var consts_1 = require("./auth/consts");
var apis_2 = require("./auth/apis");
Object.defineProperty(exports, "Auth", { enumerable: true, get: function () { return apis_2.Auth; } });
var consts_2 = require("./auth/consts");
Object.defineProperty(exports, "AUTH_API_PREFIX", { enumerable: true, get: function () { return consts_2.AUTH_API_PREFIX; } });
Object.defineProperty(exports, "OAUTH_TYPE", { enumerable: true, get: function () { return consts_2.OAUTH_TYPE; } });
var auth_error_1 = require("./auth/auth-error");
Object.defineProperty(exports, "AuthError", { enumerable: true, get: function () { return auth_error_1.AuthError; } });
exports.authModels = __importStar(require("./auth/models"));
var base64_1 = require("./utils/base64");
Object.defineProperty(exports, "weappJwtDecodeAll", { enumerable: true, get: function () { return base64_1.weappJwtDecodeAll; } });
var consts_3 = require("./auth/consts");
Object.defineProperty(exports, "LOGIN_STATE_CHANGED_TYPE", { enumerable: true, get: function () { return consts_3.LOGIN_STATE_CHANGED_TYPE; } });
Object.defineProperty(exports, "EVENTS", { enumerable: true, get: function () { return consts_3.EVENTS; } });
Object.defineProperty(exports, "AUTH_STATE_CHANGED_TYPE", { enumerable: true, get: function () { return consts_3.AUTH_STATE_CHANGED_TYPE; } });
var CloudbaseOAuth = (function () {
    function CloudbaseOAuth(authOptions) {
        var apiOrigin = authOptions.apiOrigin, _a = authOptions.apiPath, apiPath = _a === void 0 ? consts_1.AUTH_API_PREFIX : _a, clientId = authOptions.clientId, env = authOptions.env, storage = authOptions.storage, request = authOptions.request, baseRequest = authOptions.baseRequest, anonymousSignInFunc = authOptions.anonymousSignInFunc, wxCloud = authOptions.wxCloud, adapter = authOptions.adapter, onCredentialsError = authOptions.onCredentialsError, headers = authOptions.headers, i18n = authOptions.i18n, useWxCloud = authOptions.useWxCloud, eventBus = authOptions.eventBus, detectSessionInUrl = authOptions.detectSessionInUrl, debug = authOptions.debug;
        this.detectSessionInUrl = detectSessionInUrl !== null && detectSessionInUrl !== void 0 ? detectSessionInUrl : false;
        this.oauth2client = new oauth2client_1.OAuth2Client({
            apiOrigin: apiOrigin,
            apiPath: apiPath,
            clientId: clientId,
            env: env,
            storage: storage,
            baseRequest: baseRequest || request,
            anonymousSignInFunc: anonymousSignInFunc,
            wxCloud: wxCloud,
            onCredentialsError: onCredentialsError,
            headers: headers || {},
            i18n: i18n,
            useWxCloud: useWxCloud,
            eventBus: eventBus,
            debug: debug,
        });
        this.authApi = new apis_1.Auth(__assign(__assign({ credentialsClient: this.oauth2client }, authOptions), { request: request ? this.oauth2client.request.bind(this.oauth2client) : undefined, adapter: adapter }));
        if (detectSessionInUrl) {
            this.oauth2client.setGetInitialSession(this.authApi.getInitialSession.bind(this.authApi));
        }
    }
    CloudbaseOAuth.prototype.initializeSession = function (onUserObtained) {
        if (!this.detectSessionInUrl) {
            this.oauth2client.initialize(Promise.resolve({ error: null }));
            return;
        }
        this.oauth2client.setOnInitialSessionObtained(onUserObtained);
        this.oauth2client.initialize();
    };
    return CloudbaseOAuth;
}());
exports.CloudbaseOAuth = CloudbaseOAuth;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLDREQUEwRDtBQUMxRCxvQ0FBK0M7QUFDL0Msd0NBQStDO0FBRS9DLG9DQUFrQztBQUF6Qiw0RkFBQSxJQUFJLE9BQUE7QUFDYix3Q0FBMkQ7QUFBbEQseUdBQUEsZUFBZSxPQUFBO0FBQUUsb0dBQUEsVUFBVSxPQUFBO0FBQ3BDLGdEQUE2QztBQUFwQyx1R0FBQSxTQUFTLE9BQUE7QUFDbEIsNERBQTJDO0FBSTNDLHlDQUFrRDtBQUF6QywyR0FBQSxpQkFBaUIsT0FBQTtBQUMxQix3Q0FBeUY7QUFBaEYsa0hBQUEsd0JBQXdCLE9BQUE7QUFBRSxnR0FBQSxNQUFNLE9BQUE7QUFBRSxpSEFBQSx1QkFBdUIsT0FBQTtBQUVsRTtJQUtFLHdCQUFZLFdBQXdCO1FBR2hDLElBQUEsU0FBUyxHQWlCUCxXQUFXLFVBakJKLEVBQ1QsS0FnQkUsV0FBVyxRQWhCWSxFQUF6QixPQUFPLG1CQUFHLHdCQUFlLEtBQUEsRUFDekIsUUFBUSxHQWVOLFdBQVcsU0FmTCxFQUNSLEdBQUcsR0FjRCxXQUFXLElBZFYsRUFDSCxPQUFPLEdBYUwsV0FBVyxRQWJOLEVBQ1AsT0FBTyxHQVlMLFdBQVcsUUFaTixFQUNQLFdBQVcsR0FXVCxXQUFXLFlBWEYsRUFDWCxtQkFBbUIsR0FVakIsV0FBVyxvQkFWTSxFQUNuQixPQUFPLEdBU0wsV0FBVyxRQVROLEVBQ1AsT0FBTyxHQVFMLFdBQVcsUUFSTixFQUNQLGtCQUFrQixHQU9oQixXQUFXLG1CQVBLLEVBQ2xCLE9BQU8sR0FNTCxXQUFXLFFBTk4sRUFDUCxJQUFJLEdBS0YsV0FBVyxLQUxULEVBQ0osVUFBVSxHQUlSLFdBQVcsV0FKSCxFQUNWLFFBQVEsR0FHTixXQUFXLFNBSEwsRUFDUixrQkFBa0IsR0FFaEIsV0FBVyxtQkFGSyxFQUNsQixLQUFLLEdBQ0gsV0FBVyxNQURSLENBQ1E7UUFDZixJQUFJLENBQUMsa0JBQWtCLEdBQUcsa0JBQWtCLGFBQWxCLGtCQUFrQixjQUFsQixrQkFBa0IsR0FBSSxLQUFLLENBQUE7UUFDckQsSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLDJCQUFZLENBQUM7WUFDbkMsU0FBUyxXQUFBO1lBQ1QsT0FBTyxTQUFBO1lBQ1AsUUFBUSxVQUFBO1lBQ1IsR0FBRyxLQUFBO1lBQ0gsT0FBTyxTQUFBO1lBQ1AsV0FBVyxFQUFFLFdBQVcsSUFBSSxPQUFPO1lBQ25DLG1CQUFtQixxQkFBQTtZQUNuQixPQUFPLFNBQUE7WUFDUCxrQkFBa0Isb0JBQUE7WUFDbEIsT0FBTyxFQUFFLE9BQU8sSUFBSSxFQUFFO1lBQ3RCLElBQUksTUFBQTtZQUNKLFVBQVUsWUFBQTtZQUNWLFFBQVEsVUFBQTtZQUNSLEtBQUssT0FBQTtTQUNOLENBQUMsQ0FBQTtRQUVGLElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxXQUFJLHFCQUNyQixpQkFBaUIsRUFBRSxJQUFJLENBQUMsWUFBWSxJQUNqQyxXQUFXLEtBRWQsT0FBTyxFQUFFLE9BQU8sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUyxFQUNoRixPQUFPLFNBQUEsSUFDUCxDQUFBO1FBSUYsSUFBSSxrQkFBa0IsRUFBRTtZQUN0QixJQUFJLENBQUMsWUFBWSxDQUFDLG9CQUFvQixDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFBO1NBQzFGO0lBR0gsQ0FBQztJQU9NLDBDQUFpQixHQUF4QixVQUF5QixjQUFxRjtRQUM1RyxJQUFJLENBQUMsSUFBSSxDQUFDLGtCQUFrQixFQUFFO1lBQzVCLElBQUksQ0FBQyxZQUFZLENBQUMsVUFBVSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFBO1lBQzlELE9BQU07U0FDUDtRQUNELElBQUksQ0FBQyxZQUFZLENBQUMsMkJBQTJCLENBQUMsY0FBYyxDQUFDLENBQUE7UUFFN0QsSUFBSSxDQUFDLFlBQVksQ0FBQyxVQUFVLEVBQUUsQ0FBQTtJQUNoQyxDQUFDO0lBQ0gscUJBQUM7QUFBRCxDQUFDLEFBM0VELElBMkVDO0FBM0VZLHdDQUFjIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgT0F1dGgyQ2xpZW50IH0gZnJvbSAnLi9vYXV0aDJjbGllbnQvb2F1dGgyY2xpZW50J1xuaW1wb3J0IHsgQXV0aE9wdGlvbnMsIEF1dGggfSBmcm9tICcuL2F1dGgvYXBpcydcbmltcG9ydCB7IEFVVEhfQVBJX1BSRUZJWCB9IGZyb20gJy4vYXV0aC9jb25zdHMnXG5pbXBvcnQgeyBDcmVkZW50aWFscyB9IGZyb20gJy4vb2F1dGgyY2xpZW50L21vZGVscydcbmV4cG9ydCB7IEF1dGggfSBmcm9tICcuL2F1dGgvYXBpcydcbmV4cG9ydCB7IEFVVEhfQVBJX1BSRUZJWCwgT0FVVEhfVFlQRSB9IGZyb20gJy4vYXV0aC9jb25zdHMnXG5leHBvcnQgeyBBdXRoRXJyb3IgfSBmcm9tICcuL2F1dGgvYXV0aC1lcnJvcidcbmV4cG9ydCAqIGFzIGF1dGhNb2RlbHMgZnJvbSAnLi9hdXRoL21vZGVscydcbmV4cG9ydCB0eXBlIHsgUHJvdmlkZXJQcm9maWxlLCBVc2VySW5mbywgTW9kaWZ5VXNlckJhc2ljSW5mb1JlcXVlc3QgfSBmcm9tICcuL2F1dGgvbW9kZWxzJ1xuZXhwb3J0IHR5cGUgeyBDcmVkZW50aWFscywgT0F1dGgyQ2xpZW50T3B0aW9ucywgUmVzcG9uc2VFcnJvciwgQXV0aENsaWVudFJlcXVlc3RPcHRpb25zIH0gZnJvbSAnLi9vYXV0aDJjbGllbnQvbW9kZWxzJ1xuZXhwb3J0IHR5cGUgeyBBdXRoT3B0aW9ucyB9IGZyb20gJy4vYXV0aC9hcGlzJ1xuZXhwb3J0IHsgd2VhcHBKd3REZWNvZGVBbGwgfSBmcm9tICcuL3V0aWxzL2Jhc2U2NCdcbmV4cG9ydCB7IExPR0lOX1NUQVRFX0NIQU5HRURfVFlQRSwgRVZFTlRTLCBBVVRIX1NUQVRFX0NIQU5HRURfVFlQRSB9IGZyb20gJy4vYXV0aC9jb25zdHMnXG5cbmV4cG9ydCBjbGFzcyBDbG91ZGJhc2VPQXV0aCB7XG4gIHB1YmxpYyBvYXV0aDJjbGllbnQ6IE9BdXRoMkNsaWVudFxuICBwdWJsaWMgYXV0aEFwaTogQXV0aFxuICBwcml2YXRlIGRldGVjdFNlc3Npb25JblVybDogYm9vbGVhblxuXG4gIGNvbnN0cnVjdG9yKGF1dGhPcHRpb25zOiBBdXRoT3B0aW9ucykge1xuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBtYXgtbGVuXG4gICAgY29uc3Qge1xuICAgICAgYXBpT3JpZ2luLFxuICAgICAgYXBpUGF0aCA9IEFVVEhfQVBJX1BSRUZJWCxcbiAgICAgIGNsaWVudElkLFxuICAgICAgZW52LFxuICAgICAgc3RvcmFnZSxcbiAgICAgIHJlcXVlc3QsXG4gICAgICBiYXNlUmVxdWVzdCxcbiAgICAgIGFub255bW91c1NpZ25JbkZ1bmMsXG4gICAgICB3eENsb3VkLFxuICAgICAgYWRhcHRlcixcbiAgICAgIG9uQ3JlZGVudGlhbHNFcnJvcixcbiAgICAgIGhlYWRlcnMsXG4gICAgICBpMThuLFxuICAgICAgdXNlV3hDbG91ZCxcbiAgICAgIGV2ZW50QnVzLFxuICAgICAgZGV0ZWN0U2Vzc2lvbkluVXJsLFxuICAgICAgZGVidWcsXG4gICAgfSA9IGF1dGhPcHRpb25zXG4gICAgdGhpcy5kZXRlY3RTZXNzaW9uSW5VcmwgPSBkZXRlY3RTZXNzaW9uSW5VcmwgPz8gZmFsc2VcbiAgICB0aGlzLm9hdXRoMmNsaWVudCA9IG5ldyBPQXV0aDJDbGllbnQoe1xuICAgICAgYXBpT3JpZ2luLFxuICAgICAgYXBpUGF0aCxcbiAgICAgIGNsaWVudElkLFxuICAgICAgZW52LFxuICAgICAgc3RvcmFnZSxcbiAgICAgIGJhc2VSZXF1ZXN0OiBiYXNlUmVxdWVzdCB8fCByZXF1ZXN0LFxuICAgICAgYW5vbnltb3VzU2lnbkluRnVuYyxcbiAgICAgIHd4Q2xvdWQsXG4gICAgICBvbkNyZWRlbnRpYWxzRXJyb3IsXG4gICAgICBoZWFkZXJzOiBoZWFkZXJzIHx8IHt9LFxuICAgICAgaTE4bixcbiAgICAgIHVzZVd4Q2xvdWQsXG4gICAgICBldmVudEJ1cyxcbiAgICAgIGRlYnVnLFxuICAgIH0pXG5cbiAgICB0aGlzLmF1dGhBcGkgPSBuZXcgQXV0aCh7XG4gICAgICBjcmVkZW50aWFsc0NsaWVudDogdGhpcy5vYXV0aDJjbGllbnQsXG4gICAgICAuLi5hdXRoT3B0aW9ucyxcbiAgICAgIC8vIOWFvOWuueiAgemAu+i+ke+8jOacieWAvOS8oOWFpeWImeS4jei1sEF1dGjlhoXnmoTpqozor4HnoIHor7fmsYLpgLvovpFcbiAgICAgIHJlcXVlc3Q6IHJlcXVlc3QgPyB0aGlzLm9hdXRoMmNsaWVudC5yZXF1ZXN0LmJpbmQodGhpcy5vYXV0aDJjbGllbnQpIDogdW5kZWZpbmVkLFxuICAgICAgYWRhcHRlcixcbiAgICB9KVxuXG4gICAgLy8gU2V0IHRoZSBnZXRJbml0aWFsU2Vzc2lvbiBjYWxsYmFjayBhZnRlciBBdXRoIGlzIGNyZWF0ZWRcbiAgICAvLyBUaGlzIGFsbG93cyBBdXRoLmdldEluaXRpYWxTZXNzaW9uIHRvIGhhbmRsZSBVUkwgZGV0ZWN0aW9uIGFuZCBPQXV0aCB2ZXJpZmljYXRpb25cbiAgICBpZiAoZGV0ZWN0U2Vzc2lvbkluVXJsKSB7XG4gICAgICB0aGlzLm9hdXRoMmNsaWVudC5zZXRHZXRJbml0aWFsU2Vzc2lvbih0aGlzLmF1dGhBcGkuZ2V0SW5pdGlhbFNlc3Npb24uYmluZCh0aGlzLmF1dGhBcGkpKVxuICAgIH1cbiAgICAvLyBOb3RlOiBEbyBOT1QgYXV0by1jYWxsIGluaXRpYWxpemUoKSBoZXJlLlxuICAgIC8vIFVwcGVyIGxheWVyIChwYWNrYWdlcy9hdXRoKSBzaG91bGQgY2FsbCBpbml0aWFsaXplU2Vzc2lvbigpIGFmdGVyIHNldHRpbmcgdXAgb25Jbml0aWFsU2Vzc2lvbk9idGFpbmVkIGNhbGxiYWNrXG4gIH1cblxuICAvKipcbiAgICogU2V0dXAgdGhlIG9uSW5pdGlhbFNlc3Npb25PYnRhaW5lZCBjYWxsYmFjayBhbmQgdHJpZ2dlciBpbml0aWFsaXphdGlvbi5cbiAgICogVGhpcyBzaG91bGQgYmUgY2FsbGVkIGJ5IHVwcGVyIGxheWVyIChwYWNrYWdlcy9hdXRoKSBhZnRlciBjcmVhdGluZyBBdXRoIGluc3RhbmNlLlxuICAgKiBAcGFyYW0gb25Vc2VyT2J0YWluZWQgQ2FsbGJhY2sgdG8gaGFuZGxlIHVzZXIgaW5mbyBzdG9yYWdlIGFmdGVyIHNlc3Npb24gaXMgb2J0YWluZWRcbiAgICovXG4gIHB1YmxpYyBpbml0aWFsaXplU2Vzc2lvbihvblVzZXJPYnRhaW5lZD86IChkYXRhOiB7IHNlc3Npb246IENyZWRlbnRpYWxzOyB1c2VyPzogYW55IH0pID0+IHZvaWQgfCBQcm9taXNlPHZvaWQ+KTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLmRldGVjdFNlc3Npb25JblVybCkge1xuICAgICAgdGhpcy5vYXV0aDJjbGllbnQuaW5pdGlhbGl6ZShQcm9taXNlLnJlc29sdmUoeyBlcnJvcjogbnVsbCB9KSlcbiAgICAgIHJldHVyblxuICAgIH1cbiAgICB0aGlzLm9hdXRoMmNsaWVudC5zZXRPbkluaXRpYWxTZXNzaW9uT2J0YWluZWQob25Vc2VyT2J0YWluZWQpXG4gICAgLy8gUGFzcyBjYWxsYmFjayBkaXJlY3RseSB0byBpbml0aWFsaXplKCkgdG8gZW5zdXJlIGl0J3Mgc2V0IGJlZm9yZSBpbml0aWFsaXphdGlvbiBzdGFydHNcbiAgICB0aGlzLm9hdXRoMmNsaWVudC5pbml0aWFsaXplKClcbiAgfVxufVxuIl19