import { CloudbaseAdapter, SDKAdapterInterface } from '@cloudbase/adapter-interface'
import { ICloudbaseComponent, ICloudbaseHook } from './component'
import { ICloudbaseRequest } from './request'
import { ICloudbaseCache } from './cache'
import { ICloudbaseAuth } from './auth'

export enum LANGS {
  ZH = 'zh-CN',
  EN = 'en-US',
}

export type Persistence = 'local' | 'session' | 'none'

export interface KV<T> {
  [key: string]: T
}

export interface KVstring {
  [key: string]: string
}

export interface ICloudbaseConfig {
  env: string
  region?: string
  timeout?: number
  persistence?: Persistence
  oauthClient?: any
  debug?: boolean
  _fromApp?: ICloudbase
  clientId?: string
  oauthInstance?: any
  wxCloud?: any
  i18n?: {
    t: (text: string) => string;
    LANG_HEADER_KEY: string;
    lang: LANGS;
  }
  accessKey?: string
}
// 可更新的配置字段
export type ICloudbaseUpgradedConfig = Pick<ICloudbaseConfig, 'persistence' | 'region' | 'debug'>

export interface ICloudbaseExtension {
  name: string
  invoke: (opts: any, app: ICloudbase) => Promise<any>
}

export interface ICloudbase {
  config: ICloudbaseConfig
  platform: ICloudbasePlatformInfo
  cache: ICloudbaseCache
  request: ICloudbaseRequest
  oauthClient: any
  localCache: ICloudbaseCache
  authInstance?: ICloudbaseAuth
  oauthInstance?: any
  init: (config: ICloudbaseConfig) => ICloudbase
  updateConfig: (config: ICloudbaseUpgradedConfig) => void
  registerExtension: (ext: ICloudbaseExtension) => void
  invokeExtension: (name: string, opts: any) => Promise<any>
  useAdapters: (adapters: CloudbaseAdapter | CloudbaseAdapter[], options?: any) => void
  registerComponent: (component: ICloudbaseComponent) => void
  registerHook: (hook: ICloudbaseHook) => void
  registerVersion: (version: string) => void
  fire?: (...args: any[]) => void
}
export interface ICloudbasePlatformInfo {
  adapter?: SDKAdapterInterface
  runtime?: string
}

export interface IGenericError<T extends string, P = any> extends Error {
  type: T
  payload: P
  generic: boolean
}

export interface ICallApiOptions {
  /** api标识 */
  name: string
  /** 请求的path */
  path?: string
  method?: string
  headers?: KV<any>
  /** 请求体，根据content-type可以是不同类型 */
  body?: KV<any> | string
  token?: string;
}
