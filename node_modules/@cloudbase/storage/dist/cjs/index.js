"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.registerStorage = void 0;
var storage_1 = require("./storage");
var supabase_1 = require("./supabase");
var storage = new storage_1.CloudbaseStorage();
var component = {
    name: storage_1.COMPONENT_NAME,
    entity: {
        uploadFile: storage.uploadFile,
        deleteFile: storage.deleteFile,
        getTempFileURL: storage.getTempFileURL,
        downloadFile: storage.downloadFile,
        getUploadMetadata: storage.getUploadMetadata,
        copyFile: storage.copyFile,
        getFileInfo: storage.getFileInfo,
        isGateWay: storage.isGateWay,
    },
};
var supabaseComponent = {
    name: "".concat(storage_1.COMPONENT_NAME, "/supabase"),
    IIFE: true,
    entity: function () {
        var storageCache = new WeakMap();
        Object.defineProperty(this.prototype, 'storage', {
            get: function () {
                if (storageCache.has(this)) {
                    return storageCache.get(this);
                }
                var instance = this;
                var context = new Proxy({}, {
                    get: function (_target, prop) {
                        if (prop === 'config') {
                            return instance.config;
                        }
                        if (prop === 'request') {
                            return instance.request;
                        }
                        return undefined;
                    },
                });
                var storage = new supabase_1.SupabaseFileAPILikeStorage(context);
                storageCache.set(this, storage);
                return storage;
            },
            configurable: true,
            enumerable: true,
        });
    },
};
try {
    cloudbase.registerComponent(component);
    cloudbase.registerComponent(supabaseComponent);
}
catch (e) { }
function registerStorage(app) {
    try {
        app.registerComponent(component);
        app.registerComponent(supabaseComponent);
    }
    catch (e) {
        console.warn(e);
    }
}
exports.registerStorage = registerStorage;
try {
    window.registerStorage = registerStorage;
}
catch (e) { }
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBRUEscUNBQStFO0FBQy9FLHVDQUF1RDtBQUl2RCxJQUFNLE9BQU8sR0FBRyxJQUFJLDBCQUFnQixFQUFFLENBQUE7QUFDdEMsSUFBTSxTQUFTLEdBQXdCO0lBQ3JDLElBQUksRUFBRSx3QkFBYztJQUNwQixNQUFNLEVBQUU7UUFDTixVQUFVLEVBQUUsT0FBTyxDQUFDLFVBQVU7UUFDOUIsVUFBVSxFQUFFLE9BQU8sQ0FBQyxVQUFVO1FBQzlCLGNBQWMsRUFBRSxPQUFPLENBQUMsY0FBYztRQUN0QyxZQUFZLEVBQUUsT0FBTyxDQUFDLFlBQVk7UUFDbEMsaUJBQWlCLEVBQUUsT0FBTyxDQUFDLGlCQUFpQjtRQUM1QyxRQUFRLEVBQUUsT0FBTyxDQUFDLFFBQVE7UUFDMUIsV0FBVyxFQUFFLE9BQU8sQ0FBQyxXQUFXO1FBQ2hDLFNBQVMsRUFBRSxPQUFPLENBQUMsU0FBUztLQUM3QjtDQUNGLENBQUE7QUFFRCxJQUFNLGlCQUFpQixHQUF3QjtJQUM3QyxJQUFJLEVBQUUsVUFBRyx3QkFBYyxjQUFXO0lBQ2xDLElBQUksRUFBRSxJQUFJO0lBQ1YsTUFBTTtRQUtKLElBQU0sWUFBWSxHQUFHLElBQUksT0FBTyxFQUFtQyxDQUFBO1FBR25FLE1BQU0sQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSxTQUFTLEVBQUU7WUFDL0MsR0FBRztnQkFJRCxJQUFJLFlBQVksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLEVBQUU7b0JBQzFCLE9BQU8sWUFBWSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQTtpQkFDOUI7Z0JBSUQsSUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFBO2dCQUVyQixJQUFNLE9BQU8sR0FBRyxJQUFJLEtBQUssQ0FBb0IsRUFBdUIsRUFBRTtvQkFDcEUsR0FBRyxFQUFFLFVBQUMsT0FBTyxFQUFFLElBQUk7d0JBQ2pCLElBQUksSUFBSSxLQUFLLFFBQVEsRUFBRTs0QkFDckIsT0FBTyxRQUFRLENBQUMsTUFBTSxDQUFBO3lCQUN2Qjt3QkFDRCxJQUFJLElBQUksS0FBSyxTQUFTLEVBQUU7NEJBQ3RCLE9BQU8sUUFBUSxDQUFDLE9BQU8sQ0FBQTt5QkFDeEI7d0JBQ0QsT0FBTyxTQUFTLENBQUE7b0JBQ2xCLENBQUM7aUJBQ0YsQ0FBQyxDQUFBO2dCQUdGLElBQU0sT0FBTyxHQUFHLElBQUkscUNBQTBCLENBQUMsT0FBTyxDQUFDLENBQUE7Z0JBQ3ZELFlBQVksQ0FBQyxHQUFHLENBQUMsSUFBSSxFQUFFLE9BQU8sQ0FBQyxDQUFBO2dCQUMvQixPQUFPLE9BQU8sQ0FBQTtZQUNoQixDQUFDO1lBQ0QsWUFBWSxFQUFFLElBQUk7WUFDbEIsVUFBVSxFQUFFLElBQUk7U0FDakIsQ0FBQyxDQUFBO0lBQ0osQ0FBQztDQUNGLENBQUE7QUFFRCxJQUFJO0lBQ0YsU0FBUyxDQUFDLGlCQUFpQixDQUFDLFNBQVMsQ0FBQyxDQUFBO0lBQ3RDLFNBQVMsQ0FBQyxpQkFBaUIsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFBO0NBQy9DO0FBQUMsT0FBTyxDQUFDLEVBQUUsR0FBRTtBQUVkLFNBQWdCLGVBQWUsQ0FBQyxHQUEwQztJQUN4RSxJQUFJO1FBQ0YsR0FBRyxDQUFDLGlCQUFpQixDQUFDLFNBQVMsQ0FBQyxDQUFBO1FBQ2hDLEdBQUcsQ0FBQyxpQkFBaUIsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFBO0tBQ3pDO0lBQUMsT0FBTyxDQUFDLEVBQUU7UUFDVixPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFBO0tBQ2hCO0FBQ0gsQ0FBQztBQVBELDBDQU9DO0FBRUQsSUFBSTtJQUNELE1BQWMsQ0FBQyxlQUFlLEdBQUcsZUFBZSxDQUFBO0NBQ2xEO0FBQUMsT0FBTyxDQUFDLEVBQUUsR0FBRSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IElDbG91ZGJhc2UgfSBmcm9tICdAY2xvdWRiYXNlL3R5cGVzJ1xuaW1wb3J0IHsgSUNsb3VkYmFzZUNvbXBvbmVudCB9IGZyb20gJ0BjbG91ZGJhc2UvdHlwZXMvY29tcG9uZW50J1xuaW1wb3J0IHsgQ2xvdWRiYXNlU3RvcmFnZSwgQ09NUE9ORU5UX05BTUUsIElDbG91ZGJhc2VDb250ZXh0IH0gZnJvbSAnLi9zdG9yYWdlJ1xuaW1wb3J0IHsgU3VwYWJhc2VGaWxlQVBJTGlrZVN0b3JhZ2UgfSBmcm9tICcuL3N1cGFiYXNlJ1xuXG5kZWNsYXJlIGNvbnN0IGNsb3VkYmFzZTogSUNsb3VkYmFzZVxuXG5jb25zdCBzdG9yYWdlID0gbmV3IENsb3VkYmFzZVN0b3JhZ2UoKVxuY29uc3QgY29tcG9uZW50OiBJQ2xvdWRiYXNlQ29tcG9uZW50ID0ge1xuICBuYW1lOiBDT01QT05FTlRfTkFNRSxcbiAgZW50aXR5OiB7XG4gICAgdXBsb2FkRmlsZTogc3RvcmFnZS51cGxvYWRGaWxlLFxuICAgIGRlbGV0ZUZpbGU6IHN0b3JhZ2UuZGVsZXRlRmlsZSxcbiAgICBnZXRUZW1wRmlsZVVSTDogc3RvcmFnZS5nZXRUZW1wRmlsZVVSTCxcbiAgICBkb3dubG9hZEZpbGU6IHN0b3JhZ2UuZG93bmxvYWRGaWxlLFxuICAgIGdldFVwbG9hZE1ldGFkYXRhOiBzdG9yYWdlLmdldFVwbG9hZE1ldGFkYXRhLFxuICAgIGNvcHlGaWxlOiBzdG9yYWdlLmNvcHlGaWxlLFxuICAgIGdldEZpbGVJbmZvOiBzdG9yYWdlLmdldEZpbGVJbmZvLFxuICAgIGlzR2F0ZVdheTogc3RvcmFnZS5pc0dhdGVXYXksXG4gIH0sXG59XG5cbmNvbnN0IHN1cGFiYXNlQ29tcG9uZW50OiBJQ2xvdWRiYXNlQ29tcG9uZW50ID0ge1xuICBuYW1lOiBgJHtDT01QT05FTlRfTkFNRX0vc3VwYWJhc2VgLFxuICBJSUZFOiB0cnVlLFxuICBlbnRpdHkoKSB7XG4gICAgLy8g5ZyoIElJRkUg5Lit77yMdGhpcyDmmK8gQ2xvdWRiYXNlIOexu++8iOaehOmAoOWHveaVsO+8ie+8jOS4jeaYr+WunuS+i1xuICAgIC8vIOaJgOS7peaIkeS7rOmcgOimgeS9v+eUqCBnZXR0ZXIg5p2l5bu26L+f6I635Y+W5a6e5L6L55qEIGNvbmZpZyDlkowgcmVxdWVzdFxuXG4gICAgLy8g5L2/55SoIFdlYWtNYXAg57yT5a2Y5q+P5Liq5a6e5L6L55qEIHN0b3JhZ2Ug5a+56LGhXG4gICAgY29uc3Qgc3RvcmFnZUNhY2hlID0gbmV3IFdlYWtNYXA8YW55LCBTdXBhYmFzZUZpbGVBUElMaWtlU3RvcmFnZT4oKVxuXG4gICAgLy8g5a6a5LmJIHN0b3JhZ2Ug5bGe5oCn55qEIGdldHRlcu+8jOavj+S4quWunuS+i+WPquWIm+W7uuS4gOasoVxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLnByb3RvdHlwZSwgJ3N0b3JhZ2UnLCB7XG4gICAgICBnZXQoKSB7XG4gICAgICAgIC8vIOi/memHjOeahCB0aGlzIOaYryBjbG91ZGJhc2Ug5a6e5L6LXG5cbiAgICAgICAgLy8g5aaC5p6c5bey57uP5Yib5bu66L+H77yM55u05o6l6L+U5Zue57yT5a2Y55qE5a6e5L6LXG4gICAgICAgIGlmIChzdG9yYWdlQ2FjaGUuaGFzKHRoaXMpKSB7XG4gICAgICAgICAgcmV0dXJuIHN0b3JhZ2VDYWNoZS5nZXQodGhpcylcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIOWIm+W7uuWKqOaAgSBjb250ZXh077yM5LuO5b2T5YmN5a6e5L6L6I635Y+WIGNvbmZpZyDlkowgcmVxdWVzdFxuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLXRoaXMtYWxpYXNcbiAgICAgICAgY29uc3QgaW5zdGFuY2UgPSB0aGlzXG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvY29uc2lzdGVudC10eXBlLWFzc2VydGlvbnNcbiAgICAgICAgY29uc3QgY29udGV4dCA9IG5ldyBQcm94eTxJQ2xvdWRiYXNlQ29udGV4dD4oe30gYXMgSUNsb3VkYmFzZUNvbnRleHQsIHtcbiAgICAgICAgICBnZXQ6IChfdGFyZ2V0LCBwcm9wKSA9PiB7XG4gICAgICAgICAgICBpZiAocHJvcCA9PT0gJ2NvbmZpZycpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGluc3RhbmNlLmNvbmZpZ1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHByb3AgPT09ICdyZXF1ZXN0Jykge1xuICAgICAgICAgICAgICByZXR1cm4gaW5zdGFuY2UucmVxdWVzdFxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pXG5cbiAgICAgICAgLy8g5Yib5bu65paw55qEIHN0b3JhZ2Ug5a6e5L6L5bm257yT5a2YXG4gICAgICAgIGNvbnN0IHN0b3JhZ2UgPSBuZXcgU3VwYWJhc2VGaWxlQVBJTGlrZVN0b3JhZ2UoY29udGV4dClcbiAgICAgICAgc3RvcmFnZUNhY2hlLnNldCh0aGlzLCBzdG9yYWdlKVxuICAgICAgICByZXR1cm4gc3RvcmFnZVxuICAgICAgfSxcbiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgfSlcbiAgfSxcbn1cblxudHJ5IHtcbiAgY2xvdWRiYXNlLnJlZ2lzdGVyQ29tcG9uZW50KGNvbXBvbmVudClcbiAgY2xvdWRiYXNlLnJlZ2lzdGVyQ29tcG9uZW50KHN1cGFiYXNlQ29tcG9uZW50KVxufSBjYXRjaCAoZSkge31cblxuZXhwb3J0IGZ1bmN0aW9uIHJlZ2lzdGVyU3RvcmFnZShhcHA6IFBpY2s8SUNsb3VkYmFzZSwgJ3JlZ2lzdGVyQ29tcG9uZW50Jz4pIHtcbiAgdHJ5IHtcbiAgICBhcHAucmVnaXN0ZXJDb21wb25lbnQoY29tcG9uZW50KVxuICAgIGFwcC5yZWdpc3RlckNvbXBvbmVudChzdXBhYmFzZUNvbXBvbmVudClcbiAgfSBjYXRjaCAoZSkge1xuICAgIGNvbnNvbGUud2FybihlKVxuICB9XG59XG5cbnRyeSB7XG4gICh3aW5kb3cgYXMgYW55KS5yZWdpc3RlclN0b3JhZ2UgPSByZWdpc3RlclN0b3JhZ2Vcbn0gY2F0Y2ggKGUpIHt9XG4iXX0=