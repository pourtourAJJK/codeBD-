import { CloudbaseStorage, COMPONENT_NAME } from './storage';
import { SupabaseFileAPILikeStorage } from './supabase';
var storage = new CloudbaseStorage();
var component = {
    name: COMPONENT_NAME,
    entity: {
        uploadFile: storage.uploadFile,
        deleteFile: storage.deleteFile,
        getTempFileURL: storage.getTempFileURL,
        downloadFile: storage.downloadFile,
        getUploadMetadata: storage.getUploadMetadata,
        copyFile: storage.copyFile,
        getFileInfo: storage.getFileInfo,
        isGateWay: storage.isGateWay,
    },
};
var supabaseComponent = {
    name: "".concat(COMPONENT_NAME, "/supabase"),
    IIFE: true,
    entity: function () {
        var storageCache = new WeakMap();
        Object.defineProperty(this.prototype, 'storage', {
            get: function () {
                if (storageCache.has(this)) {
                    return storageCache.get(this);
                }
                var instance = this;
                var context = new Proxy({}, {
                    get: function (_target, prop) {
                        if (prop === 'config') {
                            return instance.config;
                        }
                        if (prop === 'request') {
                            return instance.request;
                        }
                        return undefined;
                    },
                });
                var storage = new SupabaseFileAPILikeStorage(context);
                storageCache.set(this, storage);
                return storage;
            },
            configurable: true,
            enumerable: true,
        });
    },
};
try {
    cloudbase.registerComponent(component);
    cloudbase.registerComponent(supabaseComponent);
}
catch (e) { }
export function registerStorage(app) {
    try {
        app.registerComponent(component);
        app.registerComponent(supabaseComponent);
    }
    catch (e) {
        console.warn(e);
    }
}
try {
    window.registerStorage = registerStorage;
}
catch (e) { }
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBRUEsT0FBTyxFQUFFLGdCQUFnQixFQUFFLGNBQWMsRUFBcUIsTUFBTSxXQUFXLENBQUE7QUFDL0UsT0FBTyxFQUFFLDBCQUEwQixFQUFFLE1BQU0sWUFBWSxDQUFBO0FBSXZELElBQU0sT0FBTyxHQUFHLElBQUksZ0JBQWdCLEVBQUUsQ0FBQTtBQUN0QyxJQUFNLFNBQVMsR0FBd0I7SUFDckMsSUFBSSxFQUFFLGNBQWM7SUFDcEIsTUFBTSxFQUFFO1FBQ04sVUFBVSxFQUFFLE9BQU8sQ0FBQyxVQUFVO1FBQzlCLFVBQVUsRUFBRSxPQUFPLENBQUMsVUFBVTtRQUM5QixjQUFjLEVBQUUsT0FBTyxDQUFDLGNBQWM7UUFDdEMsWUFBWSxFQUFFLE9BQU8sQ0FBQyxZQUFZO1FBQ2xDLGlCQUFpQixFQUFFLE9BQU8sQ0FBQyxpQkFBaUI7UUFDNUMsUUFBUSxFQUFFLE9BQU8sQ0FBQyxRQUFRO1FBQzFCLFdBQVcsRUFBRSxPQUFPLENBQUMsV0FBVztRQUNoQyxTQUFTLEVBQUUsT0FBTyxDQUFDLFNBQVM7S0FDN0I7Q0FDRixDQUFBO0FBRUQsSUFBTSxpQkFBaUIsR0FBd0I7SUFDN0MsSUFBSSxFQUFFLFVBQUcsY0FBYyxjQUFXO0lBQ2xDLElBQUksRUFBRSxJQUFJO0lBQ1YsTUFBTTtRQUtKLElBQU0sWUFBWSxHQUFHLElBQUksT0FBTyxFQUFtQyxDQUFBO1FBR25FLE1BQU0sQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSxTQUFTLEVBQUU7WUFDL0MsR0FBRztnQkFJRCxJQUFJLFlBQVksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLEVBQUU7b0JBQzFCLE9BQU8sWUFBWSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQTtpQkFDOUI7Z0JBSUQsSUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFBO2dCQUVyQixJQUFNLE9BQU8sR0FBRyxJQUFJLEtBQUssQ0FBb0IsRUFBdUIsRUFBRTtvQkFDcEUsR0FBRyxFQUFFLFVBQUMsT0FBTyxFQUFFLElBQUk7d0JBQ2pCLElBQUksSUFBSSxLQUFLLFFBQVEsRUFBRTs0QkFDckIsT0FBTyxRQUFRLENBQUMsTUFBTSxDQUFBO3lCQUN2Qjt3QkFDRCxJQUFJLElBQUksS0FBSyxTQUFTLEVBQUU7NEJBQ3RCLE9BQU8sUUFBUSxDQUFDLE9BQU8sQ0FBQTt5QkFDeEI7d0JBQ0QsT0FBTyxTQUFTLENBQUE7b0JBQ2xCLENBQUM7aUJBQ0YsQ0FBQyxDQUFBO2dCQUdGLElBQU0sT0FBTyxHQUFHLElBQUksMEJBQTBCLENBQUMsT0FBTyxDQUFDLENBQUE7Z0JBQ3ZELFlBQVksQ0FBQyxHQUFHLENBQUMsSUFBSSxFQUFFLE9BQU8sQ0FBQyxDQUFBO2dCQUMvQixPQUFPLE9BQU8sQ0FBQTtZQUNoQixDQUFDO1lBQ0QsWUFBWSxFQUFFLElBQUk7WUFDbEIsVUFBVSxFQUFFLElBQUk7U0FDakIsQ0FBQyxDQUFBO0lBQ0osQ0FBQztDQUNGLENBQUE7QUFFRCxJQUFJO0lBQ0YsU0FBUyxDQUFDLGlCQUFpQixDQUFDLFNBQVMsQ0FBQyxDQUFBO0lBQ3RDLFNBQVMsQ0FBQyxpQkFBaUIsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFBO0NBQy9DO0FBQUMsT0FBTyxDQUFDLEVBQUUsR0FBRTtBQUVkLE1BQU0sVUFBVSxlQUFlLENBQUMsR0FBMEM7SUFDeEUsSUFBSTtRQUNGLEdBQUcsQ0FBQyxpQkFBaUIsQ0FBQyxTQUFTLENBQUMsQ0FBQTtRQUNoQyxHQUFHLENBQUMsaUJBQWlCLENBQUMsaUJBQWlCLENBQUMsQ0FBQTtLQUN6QztJQUFDLE9BQU8sQ0FBQyxFQUFFO1FBQ1YsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQTtLQUNoQjtBQUNILENBQUM7QUFFRCxJQUFJO0lBQ0QsTUFBYyxDQUFDLGVBQWUsR0FBRyxlQUFlLENBQUE7Q0FDbEQ7QUFBQyxPQUFPLENBQUMsRUFBRSxHQUFFIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSUNsb3VkYmFzZSB9IGZyb20gJ0BjbG91ZGJhc2UvdHlwZXMnXG5pbXBvcnQgeyBJQ2xvdWRiYXNlQ29tcG9uZW50IH0gZnJvbSAnQGNsb3VkYmFzZS90eXBlcy9jb21wb25lbnQnXG5pbXBvcnQgeyBDbG91ZGJhc2VTdG9yYWdlLCBDT01QT05FTlRfTkFNRSwgSUNsb3VkYmFzZUNvbnRleHQgfSBmcm9tICcuL3N0b3JhZ2UnXG5pbXBvcnQgeyBTdXBhYmFzZUZpbGVBUElMaWtlU3RvcmFnZSB9IGZyb20gJy4vc3VwYWJhc2UnXG5cbmRlY2xhcmUgY29uc3QgY2xvdWRiYXNlOiBJQ2xvdWRiYXNlXG5cbmNvbnN0IHN0b3JhZ2UgPSBuZXcgQ2xvdWRiYXNlU3RvcmFnZSgpXG5jb25zdCBjb21wb25lbnQ6IElDbG91ZGJhc2VDb21wb25lbnQgPSB7XG4gIG5hbWU6IENPTVBPTkVOVF9OQU1FLFxuICBlbnRpdHk6IHtcbiAgICB1cGxvYWRGaWxlOiBzdG9yYWdlLnVwbG9hZEZpbGUsXG4gICAgZGVsZXRlRmlsZTogc3RvcmFnZS5kZWxldGVGaWxlLFxuICAgIGdldFRlbXBGaWxlVVJMOiBzdG9yYWdlLmdldFRlbXBGaWxlVVJMLFxuICAgIGRvd25sb2FkRmlsZTogc3RvcmFnZS5kb3dubG9hZEZpbGUsXG4gICAgZ2V0VXBsb2FkTWV0YWRhdGE6IHN0b3JhZ2UuZ2V0VXBsb2FkTWV0YWRhdGEsXG4gICAgY29weUZpbGU6IHN0b3JhZ2UuY29weUZpbGUsXG4gICAgZ2V0RmlsZUluZm86IHN0b3JhZ2UuZ2V0RmlsZUluZm8sXG4gICAgaXNHYXRlV2F5OiBzdG9yYWdlLmlzR2F0ZVdheSxcbiAgfSxcbn1cblxuY29uc3Qgc3VwYWJhc2VDb21wb25lbnQ6IElDbG91ZGJhc2VDb21wb25lbnQgPSB7XG4gIG5hbWU6IGAke0NPTVBPTkVOVF9OQU1FfS9zdXBhYmFzZWAsXG4gIElJRkU6IHRydWUsXG4gIGVudGl0eSgpIHtcbiAgICAvLyDlnKggSUlGRSDkuK3vvIx0aGlzIOaYryBDbG91ZGJhc2Ug57G777yI5p6E6YCg5Ye95pWw77yJ77yM5LiN5piv5a6e5L6LXG4gICAgLy8g5omA5Lul5oiR5Lus6ZyA6KaB5L2/55SoIGdldHRlciDmnaXlu7bov5/ojrflj5blrp7kvovnmoQgY29uZmlnIOWSjCByZXF1ZXN0XG5cbiAgICAvLyDkvb/nlKggV2Vha01hcCDnvJPlrZjmr4/kuKrlrp7kvovnmoQgc3RvcmFnZSDlr7nosaFcbiAgICBjb25zdCBzdG9yYWdlQ2FjaGUgPSBuZXcgV2Vha01hcDxhbnksIFN1cGFiYXNlRmlsZUFQSUxpa2VTdG9yYWdlPigpXG5cbiAgICAvLyDlrprkuYkgc3RvcmFnZSDlsZ7mgKfnmoQgZ2V0dGVy77yM5q+P5Liq5a6e5L6L5Y+q5Yib5bu65LiA5qyhXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMucHJvdG90eXBlLCAnc3RvcmFnZScsIHtcbiAgICAgIGdldCgpIHtcbiAgICAgICAgLy8g6L+Z6YeM55qEIHRoaXMg5pivIGNsb3VkYmFzZSDlrp7kvotcblxuICAgICAgICAvLyDlpoLmnpzlt7Lnu4/liJvlu7rov4fvvIznm7TmjqXov5Tlm57nvJPlrZjnmoTlrp7kvotcbiAgICAgICAgaWYgKHN0b3JhZ2VDYWNoZS5oYXModGhpcykpIHtcbiAgICAgICAgICByZXR1cm4gc3RvcmFnZUNhY2hlLmdldCh0aGlzKVxuICAgICAgICB9XG5cbiAgICAgICAgLy8g5Yib5bu65Yqo5oCBIGNvbnRleHTvvIzku47lvZPliY3lrp7kvovojrflj5YgY29uZmlnIOWSjCByZXF1ZXN0XG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tdGhpcy1hbGlhc1xuICAgICAgICBjb25zdCBpbnN0YW5jZSA9IHRoaXNcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9jb25zaXN0ZW50LXR5cGUtYXNzZXJ0aW9uc1xuICAgICAgICBjb25zdCBjb250ZXh0ID0gbmV3IFByb3h5PElDbG91ZGJhc2VDb250ZXh0Pih7fSBhcyBJQ2xvdWRiYXNlQ29udGV4dCwge1xuICAgICAgICAgIGdldDogKF90YXJnZXQsIHByb3ApID0+IHtcbiAgICAgICAgICAgIGlmIChwcm9wID09PSAnY29uZmlnJykge1xuICAgICAgICAgICAgICByZXR1cm4gaW5zdGFuY2UuY29uZmlnXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAocHJvcCA9PT0gJ3JlcXVlc3QnKSB7XG4gICAgICAgICAgICAgIHJldHVybiBpbnN0YW5jZS5yZXF1ZXN0XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkXG4gICAgICAgICAgfSxcbiAgICAgICAgfSlcblxuICAgICAgICAvLyDliJvlu7rmlrDnmoQgc3RvcmFnZSDlrp7kvovlubbnvJPlrZhcbiAgICAgICAgY29uc3Qgc3RvcmFnZSA9IG5ldyBTdXBhYmFzZUZpbGVBUElMaWtlU3RvcmFnZShjb250ZXh0KVxuICAgICAgICBzdG9yYWdlQ2FjaGUuc2V0KHRoaXMsIHN0b3JhZ2UpXG4gICAgICAgIHJldHVybiBzdG9yYWdlXG4gICAgICB9LFxuICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICB9KVxuICB9LFxufVxuXG50cnkge1xuICBjbG91ZGJhc2UucmVnaXN0ZXJDb21wb25lbnQoY29tcG9uZW50KVxuICBjbG91ZGJhc2UucmVnaXN0ZXJDb21wb25lbnQoc3VwYWJhc2VDb21wb25lbnQpXG59IGNhdGNoIChlKSB7fVxuXG5leHBvcnQgZnVuY3Rpb24gcmVnaXN0ZXJTdG9yYWdlKGFwcDogUGljazxJQ2xvdWRiYXNlLCAncmVnaXN0ZXJDb21wb25lbnQnPikge1xuICB0cnkge1xuICAgIGFwcC5yZWdpc3RlckNvbXBvbmVudChjb21wb25lbnQpXG4gICAgYXBwLnJlZ2lzdGVyQ29tcG9uZW50KHN1cGFiYXNlQ29tcG9uZW50KVxuICB9IGNhdGNoIChlKSB7XG4gICAgY29uc29sZS53YXJuKGUpXG4gIH1cbn1cblxudHJ5IHtcbiAgKHdpbmRvdyBhcyBhbnkpLnJlZ2lzdGVyU3RvcmFnZSA9IHJlZ2lzdGVyU3RvcmFnZVxufSBjYXRjaCAoZSkge31cbiJdfQ==