"use strict";
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (g && (g = 0, op[0] && (_ = 0)), _) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))
                t[p[i]] = s[p[i]];
        }
    return t;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.SbaseApi = exports.isBrowser = void 0;
var oauth_1 = require("@cloudbase/oauth");
var utils_1 = require("./utils");
var utilities_1 = require("@cloudbase/utilities");
var utilities_2 = require("./utilities");
var isBrowser = function () { return typeof window !== 'undefined' && typeof document !== 'undefined'; };
exports.isBrowser = isBrowser;
var SbaseApi = (function () {
    function SbaseApi(config) {
        this.listeners = new Map();
        this.hasListenerSetUp = false;
        this.config = config;
        this.oauthInstance = config.oauthInstance;
        this.cache = config.cache;
        this.init();
    }
    Object.defineProperty(SbaseApi.prototype, "currentUser", {
        get: function () {
            var loginState = this.hasLoginState();
            if (loginState) {
                return loginState.user || null;
            }
            return null;
        },
        enumerable: false,
        configurable: true
    });
    SbaseApi.prototype.hasLoginState = function () {
        throw new Error('Auth.hasLoginState() is not implemented');
    };
    SbaseApi.prototype.setAccessKey = function () {
        return __awaiter(this, void 0, void 0, function () {
            return __generator(this, function (_a) {
                throw new Error('Auth.setAccessKey() is not implemented');
            });
        });
    };
    SbaseApi.prototype.signIn = function (_params) {
        return __awaiter(this, void 0, void 0, function () {
            return __generator(this, function (_a) {
                throw new Error('Auth.signIn() is not implemented');
            });
        });
    };
    SbaseApi.prototype.signInWithProvider = function (_params) {
        return __awaiter(this, void 0, void 0, function () {
            return __generator(this, function (_a) {
                throw new Error('Auth.signInWithProvider() is not implemented');
            });
        });
    };
    SbaseApi.prototype.genProviderRedirectUri = function (_params) {
        return __awaiter(this, void 0, void 0, function () {
            return __generator(this, function (_a) {
                throw new Error('Auth.genProviderRedirectUri() is not implemented');
            });
        });
    };
    SbaseApi.prototype.getAccessToken = function () {
        return __awaiter(this, void 0, void 0, function () {
            return __generator(this, function (_a) {
                throw new Error('Auth.getAccessToken() is not implemented');
            });
        });
    };
    SbaseApi.prototype.getUserInfo = function () {
        return __awaiter(this, void 0, void 0, function () {
            return __generator(this, function (_a) {
                throw new Error('Auth.getUserInfo() is not implemented');
            });
        });
    };
    SbaseApi.prototype.updateUserBasicInfo = function (_params) {
        return __awaiter(this, void 0, void 0, function () {
            return __generator(this, function (_a) {
                throw new Error('Auth.updateUserBasicInfo() is not implemented');
            });
        });
    };
    SbaseApi.prototype.setCustomSignFunc = function (_getTickFn) {
        throw new Error('Auth.setCustomSignFunc() is not implemented');
    };
    SbaseApi.prototype.grantProviderToken = function (_params) {
        return __awaiter(this, void 0, void 0, function () {
            return __generator(this, function (_a) {
                throw new Error('Auth.grantProviderToken() is not implemented');
            });
        });
    };
    SbaseApi.prototype.bindWithProvider = function (_params) {
        return __awaiter(this, void 0, void 0, function () {
            return __generator(this, function (_a) {
                throw new Error('Auth.bindWithProvider() is not implemented');
            });
        });
    };
    SbaseApi.prototype.signInWithUsername = function (_params) {
        return __awaiter(this, void 0, void 0, function () {
            return __generator(this, function (_a) {
                throw new Error('Auth.signInWithUsername() is not implemented');
            });
        });
    };
    SbaseApi.prototype.getVerification = function (_params, _options) {
        return __awaiter(this, void 0, void 0, function () {
            return __generator(this, function (_a) {
                throw new Error('Auth.getVerification() is not implemented');
            });
        });
    };
    SbaseApi.prototype.createLoginState = function (_params, _options) {
        return __awaiter(this, void 0, void 0, function () {
            return __generator(this, function (_a) {
                throw new Error('Auth.createLoginState() is not implemented');
            });
        });
    };
    SbaseApi.prototype.verify = function (_params) {
        return __awaiter(this, void 0, void 0, function () {
            return __generator(this, function (_a) {
                throw new Error('Auth.verify() is not implemented');
            });
        });
    };
    SbaseApi.prototype.signInAnonymously = function (params) {
        return __awaiter(this, void 0, void 0, function () {
            var loginState, _a, _b, session, error_1;
            return __generator(this, function (_c) {
                switch (_c.label) {
                    case 0:
                        _c.trys.push([0, 4, , 5]);
                        return [4, this.oauthInstance.authApi.signInAnonymously(params)];
                    case 1:
                        _c.sent();
                        return [4, this.createLoginState()];
                    case 2:
                        loginState = _c.sent();
                        return [4, this.getSession()];
                    case 3:
                        _a = (_c.sent()).data, _b = _a === void 0 ? {} : _a, session = _b.session;
                        return [2, __assign(__assign({}, loginState), { data: { user: session.user, session: session }, error: null })];
                    case 4:
                        error_1 = _c.sent();
                        return [2, { data: {}, error: new oauth_1.AuthError(error_1) }];
                    case 5: return [2];
                }
            });
        });
    };
    SbaseApi.prototype.signUp = function (params) {
        return __awaiter(this, void 0, void 0, function () {
            var verificationInfo_1, error_2;
            var _this = this;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        if (!(params.phone_number || params.verification_code || params.verification_token || params.provider_token)) return [3, 2];
                        return [4, this.oauthInstance.authApi.signUp(params)];
                    case 1:
                        _a.sent();
                        return [2, this.createLoginState()];
                    case 2:
                        _a.trys.push([2, 4, , 5]);
                        this.validateAtLeastOne(params, [['email'], ['phone']], 'You must provide either an email or phone number');
                        return [4, this.getVerification(params.email ? { email: params.email } : { phone_number: this.formatPhone(params.phone) })];
                    case 3:
                        verificationInfo_1 = _a.sent();
                        return [2, {
                                data: {
                                    verifyOtp: function (_a) {
                                        var token = _a.token, _b = _a.messageId, messageId = _b === void 0 ? verificationInfo_1.verification_id : _b;
                                        return __awaiter(_this, void 0, void 0, function () {
                                            var verificationTokenRes, data, _c, _d, session, error_3;
                                            return __generator(this, function (_e) {
                                                switch (_e.label) {
                                                    case 0:
                                                        _e.trys.push([0, 8, , 9]);
                                                        return [4, this.verify({
                                                                verification_id: messageId || verificationInfo_1.verification_id,
                                                                verification_code: token,
                                                            })];
                                                    case 1:
                                                        verificationTokenRes = _e.sent();
                                                        if (!verificationInfo_1.is_user) return [3, 3];
                                                        return [4, this.signIn({
                                                                username: params.email || this.formatPhone(params.phone),
                                                                verification_token: verificationTokenRes.verification_token,
                                                            })];
                                                    case 2:
                                                        _e.sent();
                                                        return [3, 6];
                                                    case 3:
                                                        data = JSON.parse(JSON.stringify(params));
                                                        delete data.email;
                                                        delete data.phone;
                                                        return [4, this.oauthInstance.authApi.signUp(__assign(__assign(__assign({}, data), (params.email ? { email: params.email } : { phone_number: this.formatPhone(params.phone) })), { verification_token: verificationTokenRes.verification_token, verification_code: token }))];
                                                    case 4:
                                                        _e.sent();
                                                        return [4, this.createLoginState()];
                                                    case 5:
                                                        _e.sent();
                                                        _e.label = 6;
                                                    case 6: return [4, this.getSession()];
                                                    case 7:
                                                        _c = (_e.sent()).data, _d = _c === void 0 ? {} : _c, session = _d.session;
                                                        return [2, { data: { user: session.user, session: session }, error: null }];
                                                    case 8:
                                                        error_3 = _e.sent();
                                                        return [2, { data: {}, error: new oauth_1.AuthError(error_3) }];
                                                    case 9: return [2];
                                                }
                                            });
                                        });
                                    },
                                },
                                error: null,
                            }];
                    case 4:
                        error_2 = _a.sent();
                        return [2, { data: {}, error: new oauth_1.AuthError(error_2) }];
                    case 5: return [2];
                }
            });
        });
    };
    SbaseApi.prototype.signOut = function (params) {
        var _a, _b;
        return __awaiter(this, void 0, void 0, function () {
            var userInfoKey, res, error_4;
            return __generator(this, function (_c) {
                switch (_c.label) {
                    case 0:
                        _c.trys.push([0, 3, , 4]);
                        userInfoKey = this.cache.keys.userInfoKey;
                        return [4, this.oauthInstance.authApi.signOut(params)];
                    case 1:
                        res = _c.sent();
                        return [4, this.cache.removeStoreAsync(userInfoKey)];
                    case 2:
                        _c.sent();
                        this.setAccessKey();
                        (_a = this.config.eventBus) === null || _a === void 0 ? void 0 : _a.fire(oauth_1.EVENTS.LOGIN_STATE_CHANGED, { eventType: oauth_1.LOGIN_STATE_CHANGED_TYPE.SIGN_OUT });
                        (_b = this.config.eventBus) === null || _b === void 0 ? void 0 : _b.fire(oauth_1.EVENTS.AUTH_STATE_CHANGED, { event: oauth_1.AUTH_STATE_CHANGED_TYPE.SIGNED_OUT });
                        return [2, __assign(__assign({}, res), { data: {}, error: null })];
                    case 3:
                        error_4 = _c.sent();
                        return [2, { data: {}, error: new oauth_1.AuthError(error_4) }];
                    case 4: return [2];
                }
            });
        });
    };
    SbaseApi.prototype.onAuthStateChange = function (callback) {
        var _this = this;
        if (!this.hasListenerSetUp) {
            this.setupListeners();
            this.hasListenerSetUp = true;
        }
        var id = Math.random().toString(36);
        if (!this.listeners.has(id)) {
            this.listeners.set(id, new Set());
        }
        this.listeners.get(id).add(callback);
        var subscription = {
            id: id,
            callback: callback,
            unsubscribe: function () {
                var callbacks = _this.listeners.get(id);
                if (callbacks) {
                    callbacks.delete(callback);
                    if (callbacks.size === 0) {
                        _this.listeners.delete(id);
                    }
                }
            },
        };
        return {
            data: { subscription: subscription },
        };
    };
    SbaseApi.prototype.signInWithPassword = function (params) {
        return __awaiter(this, void 0, void 0, function () {
            var _a, _b, session, error_5;
            return __generator(this, function (_c) {
                switch (_c.label) {
                    case 0:
                        _c.trys.push([0, 3, , 4]);
                        this.validateAtLeastOne(params, [['username'], ['email'], ['phone']], 'You must provide either username, email, or phone');
                        this.validateParams(params, {
                            password: { required: true, message: 'Password is required' },
                        });
                        return [4, this.signIn(__assign({ username: params.username || params.email || this.formatPhone(params.phone), password: params.password }, (params.is_encrypt ? { isEncrypt: true, version: 'v2' } : {})))];
                    case 1:
                        _c.sent();
                        return [4, this.getSession()];
                    case 2:
                        _a = (_c.sent()).data, _b = _a === void 0 ? {} : _a, session = _b.session;
                        return [2, { data: { user: session.user, session: session }, error: null }];
                    case 3:
                        error_5 = _c.sent();
                        return [2, { data: {}, error: new oauth_1.AuthError(error_5) }];
                    case 4: return [2];
                }
            });
        });
    };
    SbaseApi.prototype.signInWithIdToken = function (params) {
        return __awaiter(this, void 0, void 0, function () {
            var _a, _b, session, error_6;
            return __generator(this, function (_c) {
                switch (_c.label) {
                    case 0:
                        _c.trys.push([0, 3, , 4]);
                        this.validateParams(params, {
                            token: { required: true, message: 'Token is required' },
                        });
                        return [4, this.signInWithProvider({
                                provider_token: params.token,
                            })];
                    case 1:
                        _c.sent();
                        return [4, this.getSession()];
                    case 2:
                        _a = (_c.sent()).data, _b = _a === void 0 ? {} : _a, session = _b.session;
                        return [2, { data: { user: session.user, session: session }, error: null }];
                    case 3:
                        error_6 = _c.sent();
                        return [2, { data: {}, error: new oauth_1.AuthError(error_6) }];
                    case 4: return [2];
                }
            });
        });
    };
    SbaseApi.prototype.signInWithOtp = function (params) {
        return __awaiter(this, void 0, void 0, function () {
            var verificationInfo_2, error_7;
            var _this = this;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        _a.trys.push([0, 2, , 3]);
                        this.validateAtLeastOne(params, [['email'], ['phone']], 'You must provide either an email or phone number');
                        return [4, this.getVerification(params.email ? { email: params.email } : { phone_number: this.formatPhone(params.phone) })];
                    case 1:
                        verificationInfo_2 = _a.sent();
                        return [2, {
                                data: {
                                    user: null,
                                    session: null,
                                    verifyOtp: function (_a) {
                                        var token = _a.token, _b = _a.messageId, messageId = _b === void 0 ? verificationInfo_2.verification_id : _b;
                                        return __awaiter(_this, void 0, void 0, function () {
                                            return __generator(this, function (_c) {
                                                return [2, this.verifyOtp({
                                                        email: params.email,
                                                        phone: params.phone,
                                                        token: token,
                                                        messageId: messageId,
                                                    })];
                                            });
                                        });
                                    },
                                },
                                error: null,
                            }];
                    case 2:
                        error_7 = _a.sent();
                        return [2, { data: {}, error: new oauth_1.AuthError(error_7) }];
                    case 3: return [2];
                }
            });
        });
    };
    SbaseApi.prototype.verifyOAuth = function (params) {
        return __awaiter(this, void 0, void 0, function () {
            var data, code, state, cacheData, provider, token, res, localSearch, error_8;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        data = {};
                        _a.label = 1;
                    case 1:
                        _a.trys.push([1, 7, , 8]);
                        code = (params === null || params === void 0 ? void 0 : params.code) || utilities_1.utils.getQuery('code');
                        state = (params === null || params === void 0 ? void 0 : params.state) || utilities_1.utils.getQuery('state');
                        if (!code) {
                            return [2, { data: {}, error: new oauth_1.AuthError({ message: 'Code is required' }) }];
                        }
                        if (!state) {
                            return [2, { data: {}, error: new oauth_1.AuthError({ message: 'State is required' }) }];
                        }
                        cacheData = (0, utils_1.getBrowserSession)(state);
                        data.type = cacheData === null || cacheData === void 0 ? void 0 : cacheData.type;
                        provider = (params === null || params === void 0 ? void 0 : params.provider) || (cacheData === null || cacheData === void 0 ? void 0 : cacheData.provider) || utilities_1.utils.getQuery('provider');
                        if (!provider) {
                            return [2, { data: data, error: new oauth_1.AuthError({ message: 'Provider is required' }) }];
                        }
                        return [4, this.grantProviderToken({
                                provider_id: provider,
                                provider_redirect_uri: location.origin + location.pathname,
                                provider_code: code,
                            })];
                    case 2:
                        token = (_a.sent()).provider_token;
                        res = void 0;
                        if (!(cacheData.type === oauth_1.OAUTH_TYPE.BIND_IDENTITY)) return [3, 4];
                        return [4, this.oauthInstance.authApi.toBindIdentity({ provider_token: token, provider: provider, fireEvent: true })];
                    case 3:
                        res = _a.sent();
                        return [3, 6];
                    case 4: return [4, this.signInWithIdToken({
                            token: token,
                        })];
                    case 5:
                        res = _a.sent();
                        res.data = __assign(__assign({}, data), res.data);
                        _a.label = 6;
                    case 6:
                        localSearch = new URLSearchParams(location === null || location === void 0 ? void 0 : location.search);
                        localSearch.delete('code');
                        localSearch.delete('state');
                        (0, utils_1.addUrlSearch)((cacheData === null || cacheData === void 0 ? void 0 : cacheData.search) === undefined ? "?".concat(localSearch.toString()) : cacheData === null || cacheData === void 0 ? void 0 : cacheData.search, (cacheData === null || cacheData === void 0 ? void 0 : cacheData.hash) || location.hash);
                        (0, utils_1.removeBrowserSession)(state);
                        return [2, res];
                    case 7:
                        error_8 = _a.sent();
                        return [2, { data: data, error: new oauth_1.AuthError(error_8) }];
                    case 8: return [2];
                }
            });
        });
    };
    SbaseApi.prototype.signInWithOAuth = function (params) {
        var _a, _b, _c, _d, _e;
        return __awaiter(this, void 0, void 0, function () {
            var href, urlObject, provider_redirect_uri, state, uri, decodedUri, finalUri, url_1, error_9;
            return __generator(this, function (_f) {
                switch (_f.label) {
                    case 0:
                        _f.trys.push([0, 2, , 3]);
                        this.validateParams(params, {
                            provider: { required: true, message: 'Provider is required' },
                        });
                        href = ((_a = params.options) === null || _a === void 0 ? void 0 : _a.redirectTo) || location.href;
                        urlObject = new URL(href);
                        provider_redirect_uri = urlObject.origin + urlObject.pathname;
                        state = ((_b = params.options) === null || _b === void 0 ? void 0 : _b.state) || "prd-".concat(params.provider, "-").concat(Math.random().toString(36)
                            .slice(2));
                        return [4, this.genProviderRedirectUri({
                                provider_id: params.provider,
                                provider_redirect_uri: provider_redirect_uri,
                                state: state,
                            })];
                    case 1:
                        uri = (_f.sent()).uri;
                        decodedUri = decodeURIComponent(uri);
                        finalUri = decodedUri;
                        if ((_c = params.options) === null || _c === void 0 ? void 0 : _c.queryParams) {
                            url_1 = new URL(decodedUri);
                            Object.entries(params.options.queryParams).forEach(function (_a) {
                                var key = _a[0], value = _a[1];
                                url_1.searchParams.set(key, value);
                            });
                            finalUri = url_1.toString();
                        }
                        (0, utils_1.saveToBrowserSession)(state, {
                            provider: params.provider,
                            search: urlObject.search,
                            hash: urlObject.hash,
                            type: ((_d = params.options) === null || _d === void 0 ? void 0 : _d.type) || oauth_1.OAUTH_TYPE.SIGN_IN,
                        });
                        if ((0, exports.isBrowser)() && !((_e = params.options) === null || _e === void 0 ? void 0 : _e.skipBrowserRedirect)) {
                            window.location.assign(finalUri);
                        }
                        return [2, { data: { url: finalUri, provider: params.provider }, error: null }];
                    case 2:
                        error_9 = _f.sent();
                        return [2, { data: {}, error: new oauth_1.AuthError(error_9) }];
                    case 3: return [2];
                }
            });
        });
    };
    SbaseApi.prototype.signInWithSSO = function () {
        return __awaiter(this, void 0, void 0, function () {
            return __generator(this, function (_a) {
                return [2];
            });
        });
    };
    SbaseApi.prototype.signInWithWeb3 = function () {
        return __awaiter(this, void 0, void 0, function () {
            return __generator(this, function (_a) {
                return [2];
            });
        });
    };
    SbaseApi.prototype.getClaims = function () {
        return __awaiter(this, void 0, void 0, function () {
            var accessToken, parsedToken, error_10;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        _a.trys.push([0, 2, , 3]);
                        return [4, this.getAccessToken()];
                    case 1:
                        accessToken = (_a.sent()).accessToken;
                        parsedToken = (0, oauth_1.weappJwtDecodeAll)(accessToken);
                        return [2, { data: parsedToken, error: null }];
                    case 2:
                        error_10 = _a.sent();
                        return [2, { data: {}, error: new oauth_1.AuthError(error_10) }];
                    case 3: return [2];
                }
            });
        });
    };
    SbaseApi.prototype.resetPasswordForEmail = function (emailOrPhone, options) {
        return __awaiter(this, void 0, void 0, function () {
            var redirectTo_1, isEmail_1, verificationParams, formattedPhone, verificationInfo_3, error_11;
            var _this = this;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        _a.trys.push([0, 2, , 3]);
                        this.validateParams({ emailOrPhone: emailOrPhone }, {
                            emailOrPhone: { required: true, message: 'Email or phone is required' },
                        });
                        redirectTo_1 = (options || {}).redirectTo;
                        isEmail_1 = emailOrPhone.includes('@');
                        verificationParams = void 0;
                        if (isEmail_1) {
                            verificationParams = { email: emailOrPhone };
                        }
                        else {
                            formattedPhone = this.formatPhone(emailOrPhone);
                            verificationParams = { phone_number: formattedPhone };
                        }
                        return [4, this.getVerification(verificationParams)];
                    case 1:
                        verificationInfo_3 = _a.sent();
                        return [2, {
                                data: {
                                    updateUser: function (attributes) { return __awaiter(_this, void 0, void 0, function () {
                                        var verificationTokenRes, res, error_12;
                                        var _a;
                                        return __generator(this, function (_b) {
                                            switch (_b.label) {
                                                case 0:
                                                    this.validateParams(attributes, {
                                                        nonce: { required: true, message: 'Nonce is required' },
                                                        password: { required: true, message: 'Password is required' },
                                                    });
                                                    _b.label = 1;
                                                case 1:
                                                    _b.trys.push([1, 5, , 6]);
                                                    return [4, this.verify({
                                                            verification_id: verificationInfo_3.verification_id,
                                                            verification_code: attributes.nonce,
                                                        })];
                                                case 2:
                                                    verificationTokenRes = _b.sent();
                                                    return [4, this.oauthInstance.authApi.resetPassword({
                                                            email: isEmail_1 ? emailOrPhone : undefined,
                                                            phone: !isEmail_1 ? emailOrPhone : undefined,
                                                            new_password: attributes.password,
                                                            verification_token: verificationTokenRes.verification_token,
                                                        })];
                                                case 3:
                                                    _b.sent();
                                                    (_a = this.config.eventBus) === null || _a === void 0 ? void 0 : _a.fire(oauth_1.EVENTS.AUTH_STATE_CHANGED, { event: oauth_1.AUTH_STATE_CHANGED_TYPE.PASSWORD_RECOVERY });
                                                    return [4, this.signInWithPassword({
                                                            email: isEmail_1 ? emailOrPhone : undefined,
                                                            phone: !isEmail_1 ? emailOrPhone : undefined,
                                                            password: attributes.password,
                                                        })];
                                                case 4:
                                                    res = _b.sent();
                                                    if (redirectTo_1 && (0, exports.isBrowser)()) {
                                                        window.location.assign(redirectTo_1);
                                                    }
                                                    return [2, res];
                                                case 5:
                                                    error_12 = _b.sent();
                                                    return [2, { data: {}, error: new oauth_1.AuthError(error_12) }];
                                                case 6: return [2];
                                            }
                                        });
                                    }); },
                                },
                                error: null,
                            }];
                    case 2:
                        error_11 = _a.sent();
                        return [2, { data: {}, error: new oauth_1.AuthError(error_11) }];
                    case 3: return [2];
                }
            });
        });
    };
    SbaseApi.prototype.resetPasswordForOld = function (params) {
        return __awaiter(this, void 0, void 0, function () {
            var _a, _b, session, error_13;
            return __generator(this, function (_c) {
                switch (_c.label) {
                    case 0:
                        _c.trys.push([0, 3, , 4]);
                        return [4, this.oauthInstance.authApi.updatePasswordByOld({
                                old_password: params.old_password,
                                new_password: params.new_password,
                            })];
                    case 1:
                        _c.sent();
                        return [4, this.getSession()];
                    case 2:
                        _a = (_c.sent()).data, _b = _a === void 0 ? {} : _a, session = _b.session;
                        return [2, { data: { user: session.user, session: session }, error: null }];
                    case 3:
                        error_13 = _c.sent();
                        return [2, { data: {}, error: new oauth_1.AuthError(error_13) }];
                    case 4: return [2];
                }
            });
        });
    };
    SbaseApi.prototype.verifyOtp = function (params) {
        return __awaiter(this, void 0, void 0, function () {
            var type, _a, _b, session, error_14;
            return __generator(this, function (_c) {
                switch (_c.label) {
                    case 0:
                        _c.trys.push([0, 6, , 7]);
                        type = params.type;
                        this.validateParams(params, {
                            token: { required: true, message: 'Token is required' },
                            messageId: { required: true, message: 'messageId is required' },
                        });
                        if (!['phone_change', 'email_change'].includes(type)) return [3, 2];
                        return [4, this.verify({
                                verification_id: params.messageId,
                                verification_code: params.token,
                            })];
                    case 1:
                        _c.sent();
                        return [3, 4];
                    case 2: return [4, this.signInWithUsername({
                            verificationInfo: { verification_id: params.messageId, is_user: true },
                            verificationCode: params.token,
                            username: params.email || this.formatPhone(params.phone) || '',
                            loginType: params.email ? 'email' : 'phone',
                        })];
                    case 3:
                        _c.sent();
                        _c.label = 4;
                    case 4: return [4, this.getSession()];
                    case 5:
                        _a = (_c.sent()).data, _b = _a === void 0 ? {} : _a, session = _b.session;
                        return [2, { data: { user: session.user, session: session }, error: null }];
                    case 6:
                        error_14 = _c.sent();
                        return [2, { data: {}, error: new oauth_1.AuthError(error_14) }];
                    case 7: return [2];
                }
            });
        });
    };
    SbaseApi.prototype.getSession = function () {
        return __awaiter(this, void 0, void 0, function () {
            var credentials, _a, _b, user, error_15;
            return __generator(this, function (_c) {
                switch (_c.label) {
                    case 0:
                        _c.trys.push([0, 3, , 4]);
                        return [4, this.oauthInstance.oauth2client.getCredentials()];
                    case 1:
                        credentials = _c.sent();
                        if (!credentials || credentials.scope === 'accessKey') {
                            return [2, { data: { session: null }, error: null }];
                        }
                        return [4, this.getUser()];
                    case 2:
                        _a = (_c.sent()).data, _b = _a === void 0 ? {} : _a, user = _b.user;
                        return [2, { data: { session: __assign(__assign({}, credentials), { user: user }) }, error: null }];
                    case 3:
                        error_15 = _c.sent();
                        return [2, { data: {}, error: new oauth_1.AuthError(error_15) }];
                    case 4: return [2];
                }
            });
        });
    };
    SbaseApi.prototype.refreshSession = function (refresh_token) {
        return __awaiter(this, void 0, void 0, function () {
            var credentials, newTokens, _a, _b, user, error_16;
            return __generator(this, function (_c) {
                switch (_c.label) {
                    case 0:
                        _c.trys.push([0, 4, , 5]);
                        return [4, this.oauthInstance.oauth2client.localCredentials.getCredentials()];
                    case 1:
                        credentials = _c.sent();
                        credentials.refresh_token = refresh_token || credentials.refresh_token;
                        return [4, this.oauthInstance.oauth2client.refreshToken(credentials)];
                    case 2:
                        newTokens = _c.sent();
                        return [4, this.getUser()];
                    case 3:
                        _a = (_c.sent()).data, _b = _a === void 0 ? {} : _a, user = _b.user;
                        return [2, { data: { user: user, session: __assign(__assign({}, newTokens), { user: user }) }, error: null }];
                    case 4:
                        error_16 = _c.sent();
                        return [2, { data: {}, error: new oauth_1.AuthError(error_16) }];
                    case 5: return [2];
                }
            });
        });
    };
    SbaseApi.prototype.getUser = function () {
        return __awaiter(this, void 0, void 0, function () {
            var user, _a, error_17;
            return __generator(this, function (_b) {
                switch (_b.label) {
                    case 0:
                        _b.trys.push([0, 2, , 3]);
                        _a = this.convertToUser;
                        return [4, this.getUserInfo()];
                    case 1:
                        user = _a.apply(this, [_b.sent()]);
                        return [2, { data: { user: user }, error: null }];
                    case 2:
                        error_17 = _b.sent();
                        return [2, { data: {}, error: new oauth_1.AuthError(error_17) }];
                    case 3: return [2];
                }
            });
        });
    };
    SbaseApi.prototype.refreshUser = function () {
        return __awaiter(this, void 0, void 0, function () {
            var _a, _b, session, error_18;
            return __generator(this, function (_c) {
                switch (_c.label) {
                    case 0:
                        _c.trys.push([0, 3, , 4]);
                        return [4, this.currentUser.refresh()];
                    case 1:
                        _c.sent();
                        return [4, this.getSession()];
                    case 2:
                        _a = (_c.sent()).data, _b = _a === void 0 ? {} : _a, session = _b.session;
                        return [2, { data: { user: session.user, session: session }, error: null }];
                    case 3:
                        error_18 = _c.sent();
                        return [2, { data: {}, error: new oauth_1.AuthError(error_18) }];
                    case 4: return [2];
                }
            });
        });
    };
    SbaseApi.prototype.updateUser = function (params) {
        var _a;
        return __awaiter(this, void 0, void 0, function () {
            var hasValue, email, phone, restParams, needsEmailVerification_1, needsPhoneVerification, extraRes, verificationParams, verificationType_1, formattedPhone, verificationInfo_4, _b, user, error_19;
            var _this = this;
            return __generator(this, function (_c) {
                switch (_c.label) {
                    case 0:
                        _c.trys.push([0, 8, , 9]);
                        hasValue = Object.keys(params).some(function (key) { return params[key] !== undefined && params[key] !== null && params[key] !== ''; });
                        if (!hasValue) {
                            throw new oauth_1.AuthError({ message: 'At least one field must be provided for update' });
                        }
                        email = params.email, phone = params.phone, restParams = __rest(params, ["email", "phone"]);
                        needsEmailVerification_1 = email !== undefined;
                        needsPhoneVerification = phone !== undefined;
                        extraRes = {};
                        if (!(needsEmailVerification_1 || needsPhoneVerification)) return [3, 4];
                        verificationParams = void 0;
                        if (needsEmailVerification_1) {
                            verificationParams = { email: params.email };
                            verificationType_1 = 'email_change';
                        }
                        else {
                            formattedPhone = this.formatPhone(params.phone);
                            verificationParams = { phone_number: formattedPhone };
                            verificationType_1 = 'phone_change';
                        }
                        return [4, this.getVerification(verificationParams)];
                    case 1:
                        verificationInfo_4 = _c.sent();
                        _b = Object.keys(restParams).length > 0;
                        if (!_b) return [3, 3];
                        return [4, this.updateUserBasicInfo(restParams)];
                    case 2:
                        _b = (_c.sent());
                        _c.label = 3;
                    case 3:
                        _b;
                        extraRes = {
                            messageId: verificationInfo_4.verification_id,
                            verifyOtp: function (verifyParams) { return __awaiter(_this, void 0, void 0, function () {
                                var user_1, error_20;
                                var _a;
                                return __generator(this, function (_b) {
                                    switch (_b.label) {
                                        case 0:
                                            _b.trys.push([0, 11, , 12]);
                                            if (!(verifyParams.email && params.email === verifyParams.email)) return [3, 3];
                                            return [4, this.verifyOtp({
                                                    type: 'email_change',
                                                    email: params.email,
                                                    token: verifyParams.token,
                                                    messageId: verificationInfo_4.verification_id,
                                                })];
                                        case 1:
                                            _b.sent();
                                            return [4, this.updateUserBasicInfo({ email: params.email })];
                                        case 2:
                                            _b.sent();
                                            return [3, 9];
                                        case 3:
                                            if (!(verifyParams.phone && params.phone === verifyParams.phone)) return [3, 6];
                                            return [4, this.verifyOtp({
                                                    type: 'phone_change',
                                                    phone: params.phone,
                                                    token: verifyParams.token,
                                                    messageId: verificationInfo_4.verification_id,
                                                })];
                                        case 4:
                                            _b.sent();
                                            return [4, this.updateUserBasicInfo({ phone: this.formatPhone(params.phone) })];
                                        case 5:
                                            _b.sent();
                                            return [3, 9];
                                        case 6: return [4, this.verifyOtp({
                                                type: verificationType_1,
                                                email: needsEmailVerification_1 ? params.email : undefined,
                                                phone: !needsEmailVerification_1 ? params.phone : undefined,
                                                token: verifyParams.token,
                                                messageId: verificationInfo_4.verification_id,
                                            })];
                                        case 7:
                                            _b.sent();
                                            return [4, this.updateUserBasicInfo(params)];
                                        case 8:
                                            _b.sent();
                                            _b.label = 9;
                                        case 9: return [4, this.getUser()];
                                        case 10:
                                            user_1 = (_b.sent()).data.user;
                                            (_a = this.config.eventBus) === null || _a === void 0 ? void 0 : _a.fire(oauth_1.EVENTS.AUTH_STATE_CHANGED, { event: oauth_1.AUTH_STATE_CHANGED_TYPE.USER_UPDATED });
                                            return [2, { data: { user: user_1 }, error: null }];
                                        case 11:
                                            error_20 = _b.sent();
                                            return [2, { data: {}, error: new oauth_1.AuthError(error_20) }];
                                        case 12: return [2];
                                    }
                                });
                            }); },
                        };
                        return [3, 6];
                    case 4: return [4, this.updateUserBasicInfo(params)];
                    case 5:
                        _c.sent();
                        _c.label = 6;
                    case 6: return [4, this.getUser()];
                    case 7:
                        user = (_c.sent()).data.user;
                        (_a = this.config.eventBus) === null || _a === void 0 ? void 0 : _a.fire(oauth_1.EVENTS.AUTH_STATE_CHANGED, { event: oauth_1.AUTH_STATE_CHANGED_TYPE.USER_UPDATED });
                        return [2, { data: __assign({ user: user }, extraRes), error: null }];
                    case 8:
                        error_19 = _c.sent();
                        return [2, { data: {}, error: new oauth_1.AuthError(error_19) }];
                    case 9: return [2];
                }
            });
        });
    };
    SbaseApi.prototype.getUserIdentities = function () {
        var _a;
        return __awaiter(this, void 0, void 0, function () {
            var providers, error_21;
            return __generator(this, function (_b) {
                switch (_b.label) {
                    case 0:
                        _b.trys.push([0, 2, , 3]);
                        return [4, this.oauthInstance.authApi.getProviders()];
                    case 1:
                        providers = _b.sent();
                        return [2, { data: { identities: (_a = providers === null || providers === void 0 ? void 0 : providers.data) === null || _a === void 0 ? void 0 : _a.filter(function (v) { return !!v.bind; }) }, error: null }];
                    case 2:
                        error_21 = _b.sent();
                        return [2, { data: {}, error: new oauth_1.AuthError(error_21) }];
                    case 3: return [2];
                }
            });
        });
    };
    SbaseApi.prototype.linkIdentity = function (params) {
        return __awaiter(this, void 0, void 0, function () {
            var error_22;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        _a.trys.push([0, 2, , 3]);
                        this.validateParams(params, {
                            provider: { required: true, message: 'Provider is required' },
                        });
                        return [4, this.signInWithOAuth({
                                provider: params.provider,
                                options: {
                                    type: oauth_1.OAUTH_TYPE.BIND_IDENTITY,
                                },
                            })];
                    case 1:
                        _a.sent();
                        return [2, { data: { provider: params.provider }, error: null }];
                    case 2:
                        error_22 = _a.sent();
                        return [2, { data: {}, error: new oauth_1.AuthError(error_22) }];
                    case 3: return [2];
                }
            });
        });
    };
    SbaseApi.prototype.unlinkIdentity = function (params) {
        return __awaiter(this, void 0, void 0, function () {
            var error_23;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        _a.trys.push([0, 2, , 3]);
                        this.validateParams(params, {
                            provider: { required: true, message: 'Provider is required' },
                        });
                        return [4, this.oauthInstance.authApi.unbindProvider({ provider_id: params.provider })];
                    case 1:
                        _a.sent();
                        return [2, { data: {}, error: null }];
                    case 2:
                        error_23 = _a.sent();
                        return [2, { data: {}, error: new oauth_1.AuthError(error_23) }];
                    case 3: return [2];
                }
            });
        });
    };
    SbaseApi.prototype.reauthenticate = function () {
        return __awaiter(this, void 0, void 0, function () {
            var user, userInfo_1, verificationInfo_5, error_24;
            var _this = this;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        _a.trys.push([0, 3, , 4]);
                        return [4, this.getUser()];
                    case 1:
                        user = (_a.sent()).data.user;
                        this.validateAtLeastOne(user, [['email', 'phone']], 'You must provide either an email or phone number');
                        userInfo_1 = user.email ? { email: user.email } : { phone_number: this.formatPhone(user.phone) };
                        return [4, this.getVerification(userInfo_1)];
                    case 2:
                        verificationInfo_5 = _a.sent();
                        return [2, {
                                data: {
                                    updateUser: function (attributes) { return __awaiter(_this, void 0, void 0, function () {
                                        var verificationTokenRes, sudoRes, _a, _b, session, error_25;
                                        return __generator(this, function (_c) {
                                            switch (_c.label) {
                                                case 0:
                                                    this.validateParams(attributes, {
                                                        nonce: { required: true, message: 'Nonce is required' },
                                                    });
                                                    _c.label = 1;
                                                case 1:
                                                    _c.trys.push([1, 9, , 10]);
                                                    if (!attributes.password) return [3, 5];
                                                    return [4, this.verify({
                                                            verification_id: verificationInfo_5.verification_id,
                                                            verification_code: attributes.nonce,
                                                        })];
                                                case 2:
                                                    verificationTokenRes = _c.sent();
                                                    return [4, this.oauthInstance.authApi.sudo({
                                                            verification_token: verificationTokenRes.verification_token,
                                                        })];
                                                case 3:
                                                    sudoRes = _c.sent();
                                                    return [4, this.oauthInstance.authApi.setPassword({
                                                            new_password: attributes.password,
                                                            sudo_token: sudoRes.sudo_token,
                                                        })];
                                                case 4:
                                                    _c.sent();
                                                    return [3, 7];
                                                case 5: return [4, this.signInWithUsername(__assign(__assign({ verificationInfo: verificationInfo_5, verificationCode: attributes.nonce }, userInfo_1), { loginType: userInfo_1.email ? 'email' : 'phone' }))];
                                                case 6:
                                                    _c.sent();
                                                    _c.label = 7;
                                                case 7: return [4, this.getSession()];
                                                case 8:
                                                    _a = (_c.sent()).data, _b = _a === void 0 ? {} : _a, session = _b.session;
                                                    return [2, { data: { user: session.user, session: session }, error: null }];
                                                case 9:
                                                    error_25 = _c.sent();
                                                    return [2, { data: {}, error: new oauth_1.AuthError(error_25) }];
                                                case 10: return [2];
                                            }
                                        });
                                    }); },
                                },
                                error: null,
                            }];
                    case 3:
                        error_24 = _a.sent();
                        return [2, { data: {}, error: new oauth_1.AuthError(error_24) }];
                    case 4: return [2];
                }
            });
        });
    };
    SbaseApi.prototype.resend = function (params) {
        return __awaiter(this, void 0, void 0, function () {
            var target, data, verificationId, error_26;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        _a.trys.push([0, 2, , 3]);
                        this.validateAtLeastOne(params, [['email'], ['phone']], 'You must provide either an email or phone number');
                        target = params.type === 'signup' ? 'ANY' : 'USER';
                        data = { target: target };
                        if ('email' in params) {
                            data.email = params.email;
                        }
                        if ('phone' in params) {
                            data.phone_number = this.formatPhone(params.phone);
                        }
                        return [4, this.oauthInstance.authApi.getVerification(data)];
                    case 1:
                        verificationId = (_a.sent()).verification_id;
                        return [2, {
                                data: { messageId: verificationId },
                                error: null,
                            }];
                    case 2:
                        error_26 = _a.sent();
                        return [2, {
                                data: {},
                                error: new oauth_1.AuthError(error_26),
                            }];
                    case 3: return [2];
                }
            });
        });
    };
    SbaseApi.prototype.setSession = function (params) {
        var _a;
        return __awaiter(this, void 0, void 0, function () {
            var _b, _c, session, error_27;
            return __generator(this, function (_d) {
                switch (_d.label) {
                    case 0:
                        _d.trys.push([0, 3, , 4]);
                        this.validateParams(params, {
                            access_token: { required: true, message: 'Access token is required' },
                            refresh_token: { required: true, message: 'Refresh token is required' },
                        });
                        return [4, this.oauthInstance.oauth2client.refreshToken(params, { throwOnError: true })];
                    case 1:
                        _d.sent();
                        return [4, this.getSession()];
                    case 2:
                        _b = (_d.sent()).data, _c = _b === void 0 ? {} : _b, session = _c.session;
                        (_a = this.config.eventBus) === null || _a === void 0 ? void 0 : _a.fire(oauth_1.EVENTS.AUTH_STATE_CHANGED, { event: oauth_1.AUTH_STATE_CHANGED_TYPE.SIGNED_IN });
                        return [2, { data: { user: session.user, session: session }, error: null }];
                    case 3:
                        error_27 = _d.sent();
                        return [2, { data: {}, error: new oauth_1.AuthError(error_27) }];
                    case 4: return [2];
                }
            });
        });
    };
    SbaseApi.prototype.exchangeCodeForSession = function () {
        return __awaiter(this, void 0, void 0, function () {
            return __generator(this, function (_a) {
                return [2];
            });
        });
    };
    SbaseApi.prototype.deleteUser = function (params) {
        return __awaiter(this, void 0, void 0, function () {
            var sudo_token, error_28;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        _a.trys.push([0, 3, , 4]);
                        this.validateParams(params, {
                            password: { required: true, message: 'Password is required' },
                        });
                        return [4, this.oauthInstance.authApi.sudo(params)];
                    case 1:
                        sudo_token = (_a.sent()).sudo_token;
                        return [4, this.oauthInstance.authApi.deleteMe({ sudo_token: sudo_token })];
                    case 2:
                        _a.sent();
                        return [2, { data: {}, error: null }];
                    case 3:
                        error_28 = _a.sent();
                        return [2, { data: {}, error: new oauth_1.AuthError(error_28) }];
                    case 4: return [2];
                }
            });
        });
    };
    SbaseApi.prototype.toDefaultLoginPage = function (params) {
        if (params === void 0) { params = {}; }
        return __awaiter(this, void 0, void 0, function () {
            var configVersion, query, redirectUri, urlObj, loginPage;
            return __generator(this, function (_a) {
                try {
                    configVersion = params.config_version || 'env';
                    query = Object.keys(params.query || {})
                        .map(function (key) { return "".concat(key, "=").concat(params.query[key]); })
                        .join('&');
                    if (utilities_2.adapterForWxMp.isMatch()) {
                        wx.navigateTo({ url: "/packages/$wd_system/pages/login/index".concat(query ? "?".concat(query) : '') });
                    }
                    else {
                        redirectUri = params.redirect_uri || window.location.href;
                        urlObj = new URL(redirectUri);
                        loginPage = "".concat(urlObj.origin, "/__auth/?app_id=").concat(params.app_id || '', "&env_id=").concat(this.config.env, "&client_id=").concat(this.config.clientId || this.config.env, "&config_version=").concat(configVersion, "&redirect_uri=").concat(encodeURIComponent(redirectUri)).concat(query ? "&".concat(query) : '');
                        window.location.href = loginPage;
                    }
                    return [2, { data: {}, error: null }];
                }
                catch (error) {
                    return [2, { data: {}, error: new oauth_1.AuthError(error) }];
                }
                return [2];
            });
        });
    };
    SbaseApi.prototype.signInWithCustomTicket = function (getTickFn) {
        return __awaiter(this, void 0, void 0, function () {
            var loginState, _a, _b, session, error_29;
            return __generator(this, function (_c) {
                switch (_c.label) {
                    case 0:
                        if (getTickFn) {
                            this.setCustomSignFunc(getTickFn);
                        }
                        _c.label = 1;
                    case 1:
                        _c.trys.push([1, 5, , 6]);
                        return [4, this.oauthInstance.authApi.signInWithCustomTicket()];
                    case 2:
                        _c.sent();
                        return [4, this.createLoginState()];
                    case 3:
                        loginState = _c.sent();
                        return [4, this.getSession()];
                    case 4:
                        _a = (_c.sent()).data, _b = _a === void 0 ? {} : _a, session = _b.session;
                        return [2, __assign(__assign({}, loginState), { data: { user: session.user, session: session }, error: null })];
                    case 5:
                        error_29 = _c.sent();
                        return [2, { data: {}, error: new oauth_1.AuthError(error_29) }];
                    case 6: return [2];
                }
            });
        });
    };
    SbaseApi.prototype.signInWithOpenId = function (_a) {
        var _b = _a === void 0 ? {} : _a, _c = _b.useWxCloud, useWxCloud = _c === void 0 ? true : _c;
        return __awaiter(this, void 0, void 0, function () {
            var wxInfo, mainFunc, loginState, _d, _e, session, error_30;
            var _this = this;
            return __generator(this, function (_f) {
                switch (_f.label) {
                    case 0:
                        if (!utilities_2.adapterForWxMp.isMatch()) {
                            throw Error('wx api undefined');
                        }
                        wxInfo = wx.getAccountInfoSync().miniProgram;
                        mainFunc = function (code) { return __awaiter(_this, void 0, void 0, function () {
                            var result, credentials, error_31;
                            return __generator(this, function (_a) {
                                switch (_a.label) {
                                    case 0:
                                        result = undefined;
                                        credentials = undefined;
                                        _a.label = 1;
                                    case 1:
                                        _a.trys.push([1, 4, , 5]);
                                        return [4, this.oauthInstance.authApi.grantProviderToken({
                                                provider_id: wxInfo === null || wxInfo === void 0 ? void 0 : wxInfo.appId,
                                                provider_code: code,
                                                provider_params: {
                                                    provider_code_type: 'open_id',
                                                    appid: wxInfo === null || wxInfo === void 0 ? void 0 : wxInfo.appId,
                                                },
                                            }, useWxCloud)];
                                    case 2:
                                        result = _a.sent();
                                        if ((result === null || result === void 0 ? void 0 : result.error_code) || !result.provider_token) {
                                            throw result;
                                        }
                                        return [4, this.oauthInstance.authApi.signInWithProvider({ provider_token: result.provider_token }, useWxCloud)];
                                    case 3:
                                        credentials = _a.sent();
                                        if (credentials === null || credentials === void 0 ? void 0 : credentials.error_code) {
                                            throw credentials;
                                        }
                                        return [3, 5];
                                    case 4:
                                        error_31 = _a.sent();
                                        throw error_31;
                                    case 5: return [4, this.oauthInstance.oauth2client.setCredentials(credentials)];
                                    case 6:
                                        _a.sent();
                                        return [2];
                                }
                            });
                        }); };
                        _f.label = 1;
                    case 1:
                        _f.trys.push([1, 5, , 6]);
                        return [4, new Promise(function (resolve, reject) {
                                wx.login({
                                    success: function (res) { return __awaiter(_this, void 0, void 0, function () {
                                        var error_32;
                                        return __generator(this, function (_a) {
                                            switch (_a.label) {
                                                case 0:
                                                    _a.trys.push([0, 2, , 3]);
                                                    return [4, mainFunc(res.code)];
                                                case 1:
                                                    _a.sent();
                                                    resolve(true);
                                                    return [3, 3];
                                                case 2:
                                                    error_32 = _a.sent();
                                                    reject(error_32);
                                                    return [3, 3];
                                                case 3: return [2];
                                            }
                                        });
                                    }); },
                                    fail: function (res) {
                                        var error = new Error(res === null || res === void 0 ? void 0 : res.errMsg);
                                        error.code = res === null || res === void 0 ? void 0 : res.errno;
                                        reject(error);
                                    },
                                });
                            })];
                    case 2:
                        _f.sent();
                        return [4, this.createLoginState()];
                    case 3:
                        loginState = _f.sent();
                        return [4, this.getSession()];
                    case 4:
                        _d = (_f.sent()).data, _e = _d === void 0 ? {} : _d, session = _e.session;
                        return [2, __assign(__assign({}, loginState), { data: { user: session.user, session: session }, error: null })];
                    case 5:
                        error_30 = _f.sent();
                        return [2, { data: {}, error: new oauth_1.AuthError(error_30) }];
                    case 6: return [2];
                }
            });
        });
    };
    SbaseApi.prototype.signInWithPhoneAuth = function (_a) {
        var _b = _a.phoneCode, phoneCode = _b === void 0 ? '' : _b;
        return __awaiter(this, void 0, void 0, function () {
            var wxInfo, providerInfo, code, providerToken, signInRes, error_33, loginState, _c, _d, session;
            return __generator(this, function (_e) {
                switch (_e.label) {
                    case 0:
                        if (!utilities_2.adapterForWxMp.isMatch()) {
                            return [2, { data: {}, error: new oauth_1.AuthError({ message: 'wx api undefined' }) }];
                        }
                        wxInfo = wx.getAccountInfoSync().miniProgram;
                        providerInfo = {
                            provider_params: { provider_code_type: 'phone' },
                            provider_id: wxInfo.appId,
                        };
                        return [4, wx.login()];
                    case 1:
                        code = (_e.sent()).code;
                        providerInfo.provider_code = code;
                        _e.label = 2;
                    case 2:
                        _e.trys.push([2, 6, , 7]);
                        return [4, this.oauthInstance.authApi.grantProviderToken(providerInfo)];
                    case 3:
                        providerToken = _e.sent();
                        if (providerToken.error_code) {
                            throw providerToken;
                        }
                        return [4, this.oauthInstance.authApi.patchProviderToken({
                                provider_token: providerToken.provider_token,
                                provider_id: wxInfo.appId,
                                provider_params: {
                                    code: phoneCode,
                                    provider_code_type: 'phone',
                                },
                            })];
                    case 4:
                        providerToken = _e.sent();
                        if (providerToken.error_code) {
                            throw providerToken;
                        }
                        return [4, this.oauthInstance.authApi.signInWithProvider({
                                provider_token: providerToken.provider_token,
                            })];
                    case 5:
                        signInRes = _e.sent();
                        if (signInRes === null || signInRes === void 0 ? void 0 : signInRes.error_code) {
                            throw signInRes;
                        }
                        return [3, 7];
                    case 6:
                        error_33 = _e.sent();
                        return [2, { data: {}, error: new oauth_1.AuthError(error_33) }];
                    case 7: return [4, this.createLoginState()];
                    case 8:
                        loginState = _e.sent();
                        return [4, this.getSession()];
                    case 9:
                        _c = (_e.sent()).data, _d = _c === void 0 ? {} : _c, session = _d.session;
                        return [2, __assign(__assign({}, loginState), { data: { user: session.user, session: session }, error: null })];
                }
            });
        });
    };
    SbaseApi.prototype.formatPhone = function (phone) {
        if (!/\s+/.test(phone) && /^\+\d{1,3}\d+/.test(phone)) {
            return phone.replace(/^(\+\d{1,2})(\d+)$/, '$1 $2');
        }
        return /^\+\d{1,3}\s+/.test(phone) ? phone : "+86 ".concat(phone);
    };
    SbaseApi.prototype.notifyListeners = function (event, session, info) {
        this.listeners.forEach(function (callbacks) {
            callbacks.forEach(function (callback) {
                try {
                    callback(event, session, info);
                }
                catch (error) {
                    console.error('Error in auth state change callback:', error);
                }
            });
        });
        return;
    };
    SbaseApi.prototype.init = function () {
        var _a;
        return __awaiter(this, void 0, void 0, function () {
            var credentials, error_34;
            return __generator(this, function (_b) {
                switch (_b.label) {
                    case 0:
                        _b.trys.push([0, 2, , 3]);
                        return [4, this.oauthInstance.oauth2client.localCredentials.getCredentials()];
                    case 1:
                        credentials = _b.sent();
                        if (credentials) {
                            (_a = this.config.eventBus) === null || _a === void 0 ? void 0 : _a.fire(oauth_1.EVENTS.AUTH_STATE_CHANGED, { event: oauth_1.AUTH_STATE_CHANGED_TYPE.INITIAL_SESSION });
                        }
                        return [3, 3];
                    case 2:
                        error_34 = _b.sent();
                        return [3, 3];
                    case 3: return [2, { error: null }];
                }
            });
        });
    };
    SbaseApi.prototype.setupListeners = function () {
        var _this = this;
        var _a;
        (_a = this.config.eventBus) === null || _a === void 0 ? void 0 : _a.on(oauth_1.EVENTS.AUTH_STATE_CHANGED, function (params) { return __awaiter(_this, void 0, void 0, function () {
            var event, info, session;
            var _a, _b;
            return __generator(this, function (_c) {
                switch (_c.label) {
                    case 0:
                        event = (_a = params === null || params === void 0 ? void 0 : params.data) === null || _a === void 0 ? void 0 : _a.event;
                        info = (_b = params === null || params === void 0 ? void 0 : params.data) === null || _b === void 0 ? void 0 : _b.info;
                        return [4, this.getSession()];
                    case 1:
                        session = (_c.sent()).data.session;
                        this.notifyListeners(event, session, info);
                        return [2];
                }
            });
        }); });
    };
    SbaseApi.prototype.convertToUser = function (userInfo) {
        var _a, _b, _c;
        if (!userInfo)
            return null;
        var email = (userInfo === null || userInfo === void 0 ? void 0 : userInfo.email) || (userInfo === null || userInfo === void 0 ? void 0 : userInfo.username);
        var phone = userInfo === null || userInfo === void 0 ? void 0 : userInfo.phone_number;
        var userId = (userInfo === null || userInfo === void 0 ? void 0 : userInfo.sub) || (userInfo === null || userInfo === void 0 ? void 0 : userInfo.uid) || '';
        return {
            id: userId,
            aud: 'authenticated',
            role: userInfo.groups,
            email: email || '',
            email_confirmed_at: (userInfo === null || userInfo === void 0 ? void 0 : userInfo.email_verified) ? userInfo.created_at : userInfo.created_at,
            phone: phone,
            phone_confirmed_at: phone ? userInfo.created_at : undefined,
            confirmed_at: userInfo.created_at,
            last_sign_in_at: userInfo.last_sign_in_at,
            app_metadata: {
                provider: ((_a = userInfo.loginType) === null || _a === void 0 ? void 0 : _a.toLowerCase()) || 'cloudbase',
                providers: [((_b = userInfo.loginType) === null || _b === void 0 ? void 0 : _b.toLowerCase()) || 'cloudbase'],
            },
            user_metadata: {
                name: userInfo === null || userInfo === void 0 ? void 0 : userInfo.name,
                picture: userInfo === null || userInfo === void 0 ? void 0 : userInfo.picture,
                username: userInfo === null || userInfo === void 0 ? void 0 : userInfo.username,
                gender: userInfo === null || userInfo === void 0 ? void 0 : userInfo.gender,
                locale: userInfo === null || userInfo === void 0 ? void 0 : userInfo.locale,
                uid: userInfo.uid,
                nickName: userInfo.nickName,
                avatarUrl: userInfo.avatarUrl || userInfo.picture,
                location: userInfo.location,
                hasPassword: userInfo.hasPassword,
            },
            identities: ((_c = userInfo === null || userInfo === void 0 ? void 0 : userInfo.providers) === null || _c === void 0 ? void 0 : _c.map(function (p) { return ({
                id: p.id || '',
                identity_id: p.id || '',
                user_id: userId,
                identity_data: {
                    provider_id: p.id,
                    provider_user_id: p.provider_user_id,
                    name: p.name,
                },
                provider: p.id || 'cloudbase',
                created_at: userInfo.created_at,
                updated_at: userInfo.updated_at,
                last_sign_in_at: userInfo.last_sign_in_at,
            }); })) || [],
            created_at: userInfo.created_at,
            updated_at: userInfo.updated_at,
            is_anonymous: userInfo.name === 'anonymous',
        };
    };
    SbaseApi.prototype.validateParams = function (params, rules) {
        for (var _i = 0, _a = Object.entries(rules); _i < _a.length; _i++) {
            var _b = _a[_i], key = _b[0], rule = _b[1];
            if (rule.required && ((params === null || params === void 0 ? void 0 : params[key]) === undefined || (params === null || params === void 0 ? void 0 : params[key]) === null || (params === null || params === void 0 ? void 0 : params[key]) === '')) {
                throw new oauth_1.AuthError({ message: rule.message });
            }
        }
    };
    SbaseApi.prototype.validateAtLeastOne = function (params, fieldGroups, message) {
        var hasValue = fieldGroups.some(function (group) { return group.some(function (field) { return (params === null || params === void 0 ? void 0 : params[field]) !== undefined && (params === null || params === void 0 ? void 0 : params[field]) !== null && (params === null || params === void 0 ? void 0 : params[field]) !== ''; }); });
        if (!hasValue) {
            throw new oauth_1.AuthError({ message: message });
        }
    };
    return SbaseApi;
}());
exports.SbaseApi = SbaseApi;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2Jhc2VBcGkuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvc2Jhc2VBcGkudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUdBLDBDQU95QjtBQWlDekIsaUNBQXFHO0FBQ3JHLGtEQUE0QztBQUM1Qyx5Q0FBNEM7QUFDckMsSUFBTSxTQUFTLEdBQUcsY0FBTSxPQUFBLE9BQU8sTUFBTSxLQUFLLFdBQVcsSUFBSSxPQUFPLFFBQVEsS0FBSyxXQUFXLEVBQWhFLENBQWdFLENBQUE7QUFBbEYsUUFBQSxTQUFTLGFBQXlFO0FBSS9GO0lBT0Usa0JBQVksTUFBeUQ7UUFIN0QsY0FBUyxHQUFnRCxJQUFJLEdBQUcsRUFBRSxDQUFBO1FBQ2xFLHFCQUFnQixHQUFHLEtBQUssQ0FBQTtRQUc5QixJQUFJLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQTtRQUNwQixJQUFJLENBQUMsYUFBYSxHQUFHLE1BQU0sQ0FBQyxhQUFhLENBQUE7UUFDekMsSUFBSSxDQUFDLEtBQUssR0FBRyxNQUFNLENBQUMsS0FBSyxDQUFBO1FBQ3pCLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQTtJQUNiLENBQUM7SUFLRCxzQkFBSSxpQ0FBVzthQUFmO1lBQ0UsSUFBTSxVQUFVLEdBQUcsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFBO1lBRXZDLElBQUksVUFBVSxFQUFFO2dCQUNkLE9BQU8sVUFBVSxDQUFDLElBQUksSUFBSSxJQUFJLENBQUE7YUFDL0I7WUFDRCxPQUFPLElBQUksQ0FBQTtRQUNiLENBQUM7OztPQUFBO0lBRUQsZ0NBQWEsR0FBYjtRQUNFLE1BQU0sSUFBSSxLQUFLLENBQUMseUNBQXlDLENBQUMsQ0FBQTtJQUM1RCxDQUFDO0lBRUssK0JBQVksR0FBbEI7OztnQkFDRSxNQUFNLElBQUksS0FBSyxDQUFDLHdDQUF3QyxDQUFDLENBQUE7OztL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QUMsVUFBQSxLQUFLLElBQUksT0FBQSxLQUFLLENBQUMsSUFBSSxDQUFDLFVBQUEsS0FBSyxJQUFJLE9BQUEsQ0FBQSxNQUFNLGFBQU4sTUFBTSx1QkFBTixNQUFNLENBQUcsS0FBSyxDQUFDLE1BQUssU0FBUyxJQUFJLENBQUEsTUFBTSxhQUFOLE1BQU0sdUJBQU4sTUFBTSxDQUFHLEtBQUssQ0FBQyxNQUFLLElBQUksSUFBSSxDQUFBLE1BQU0sYUFBTixNQUFNLHVCQUFOLE1BQU0sQ0FBRyxLQUFLLENBQUMsTUFBSyxFQUFFLEVBQW5GLENBQW1GLENBQUMsRUFBeEcsQ0FBd0csQ0FBRSxDQUFBO1FBRXJKLElBQUksQ0FBQyxRQUFRLEVBQUU7WUFDYixNQUFNLElBQUksaUJBQVMsQ0FBQyxFQUFFLE9BQU8sU0FBQSxFQUFFLENBQUMsQ0FBQTtTQUNqQztJQUNILENBQUM7SUFDSCxlQUFDO0FBQUQsQ0FBQyxBQXo2Q0QsSUF5NkNDO0FBejZDWSw0QkFBUSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHsgSUNsb3VkYmFzZUF1dGhDb25maWcgfSBmcm9tICdAY2xvdWRiYXNlL3R5cGVzL2F1dGgnXG5pbXBvcnQgdHlwZSB7IGF1dGhNb2RlbHMsIENsb3VkYmFzZU9BdXRoLCBDcmVkZW50aWFscyB9IGZyb20gJ0BjbG91ZGJhc2Uvb2F1dGgnXG5pbXBvcnQgdHlwZSB7IElDbG91ZGJhc2VDYWNoZSB9IGZyb20gJ0BjbG91ZGJhc2UvdHlwZXMvY2FjaGUnXG5pbXBvcnQge1xuICB3ZWFwcEp3dERlY29kZUFsbCxcbiAgRVZFTlRTLFxuICBBVVRIX1NUQVRFX0NIQU5HRURfVFlQRSxcbiAgQXV0aEVycm9yLFxuICBPQVVUSF9UWVBFLFxuICBMT0dJTl9TVEFURV9DSEFOR0VEX1RZUEUsXG59IGZyb20gJ0BjbG91ZGJhc2Uvb2F1dGgnXG5pbXBvcnQge1xuICBDb21tb25SZXMsXG4gIERlbGV0ZU1lUmVxLFxuICBHZXRDbGFpbXNSZXMsXG4gIEdldFVzZXJJZGVudGl0aWVzUmVzLFxuICBHZXRVc2VyUmVzLFxuICBMaW5rSWRlbnRpdHlSZXEsXG4gIExpbmtJZGVudGl0eVJlcyxcbiAgT25BdXRoU3RhdGVDaGFuZ2VDYWxsYmFjayxcbiAgUmVhdXRoZW50aWNhdGVSZXMsXG4gIFJlc2VuZFJlcSxcbiAgUmVzZW5kUmVzLFxuICBSZXNldFBhc3N3b3JkRm9yRW1haWxSZXMsXG4gIFJlc2V0UGFzc3dvcmRGb3JPbGRSZXEsXG4gIFNldFNlc3Npb25SZXEsXG4gIFNpZ25JbkFub255bW91c2x5UmVxLFxuICBTaWduSW5PQXV0aFJlcyxcbiAgU2lnbkluUmVzLFxuICBTaWduSW5XaXRoSWRUb2tlblJlcSxcbiAgU2lnbkluV2l0aE9BdXRoUmVxLFxuICBTaWduSW5XaXRoT3RwUmVxLFxuICBTaWduSW5XaXRoT3RwUmVzLFxuICBTaWduSW5XaXRoUGFzc3dvcmRSZXEsXG4gIFNpZ25VcFJlcyxcbiAgVW5saW5rSWRlbnRpdHlSZXEsXG4gIFVwZGF0ZVVzZXJBdHRyaWJ1dGVzLFxuICBVcGRhdGVVc2VyUmVxLFxuICBVcGRhdGVVc2VyV2l0aFZlcmlmaWNhdGlvblJlcyxcbiAgVmVyaWZ5T0F1dGhSZXEsXG4gIFZlcmlmeU90cFJlcSxcbn0gZnJvbSAnLi90eXBlJ1xuaW1wb3J0IHsgTG9naW5TdGF0ZSwgVXNlciB9IGZyb20gJy4nXG5pbXBvcnQgeyBzYXZlVG9Ccm93c2VyU2Vzc2lvbiwgZ2V0QnJvd3NlclNlc3Npb24sIHJlbW92ZUJyb3dzZXJTZXNzaW9uLCBhZGRVcmxTZWFyY2ggfSBmcm9tICcuL3V0aWxzJ1xuaW1wb3J0IHsgdXRpbHMgfSBmcm9tICdAY2xvdWRiYXNlL3V0aWxpdGllcydcbmltcG9ydCB7IGFkYXB0ZXJGb3JXeE1wIH0gZnJvbSAnLi91dGlsaXRpZXMnXG5leHBvcnQgY29uc3QgaXNCcm93c2VyID0gKCkgPT4gdHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgJiYgdHlwZW9mIGRvY3VtZW50ICE9PSAndW5kZWZpbmVkJ1xuXG5kZWNsYXJlIGNvbnN0IHd4OiBhbnlcblxuZXhwb3J0IGNsYXNzIFNiYXNlQXBpIHtcbiAgcmVhZG9ubHkgY29uZmlnOiBJQ2xvdWRiYXNlQXV0aENvbmZpZ1xuICBvYXV0aEluc3RhbmNlOiBDbG91ZGJhc2VPQXV0aFxuICByZWFkb25seSBjYWNoZTogSUNsb3VkYmFzZUNhY2hlXG4gIHByaXZhdGUgbGlzdGVuZXJzOiBNYXA8c3RyaW5nLCBTZXQ8T25BdXRoU3RhdGVDaGFuZ2VDYWxsYmFjaz4+ID0gbmV3IE1hcCgpXG4gIHByaXZhdGUgaGFzTGlzdGVuZXJTZXRVcCA9IGZhbHNlXG5cbiAgY29uc3RydWN0b3IoY29uZmlnOiBJQ2xvdWRiYXNlQXV0aENvbmZpZyAmIHsgY2FjaGU6IElDbG91ZGJhc2VDYWNoZSB9KSB7XG4gICAgdGhpcy5jb25maWcgPSBjb25maWdcbiAgICB0aGlzLm9hdXRoSW5zdGFuY2UgPSBjb25maWcub2F1dGhJbnN0YW5jZVxuICAgIHRoaXMuY2FjaGUgPSBjb25maWcuY2FjaGVcbiAgICB0aGlzLmluaXQoKVxuICB9XG5cbiAgLyoqXG4gICAqIOiOt+WPluW9k+WJjeeZu+W9leeahOeUqOaIt+S/oeaBry3lkIzmraVcbiAgICovXG4gIGdldCBjdXJyZW50VXNlcigpIHtcbiAgICBjb25zdCBsb2dpblN0YXRlID0gdGhpcy5oYXNMb2dpblN0YXRlKClcblxuICAgIGlmIChsb2dpblN0YXRlKSB7XG4gICAgICByZXR1cm4gbG9naW5TdGF0ZS51c2VyIHx8IG51bGxcbiAgICB9XG4gICAgcmV0dXJuIG51bGxcbiAgfVxuXG4gIGhhc0xvZ2luU3RhdGUoKTogTG9naW5TdGF0ZSB8IG51bGwge1xuICAgIHRocm93IG5ldyBFcnJvcignQXV0aC5oYXNMb2dpblN0YXRlKCkgaXMgbm90IGltcGxlbWVudGVkJylcbiAgfVxuXG4gIGFzeW5jIHNldEFjY2Vzc0tleSgpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0F1dGguc2V0QWNjZXNzS2V5KCkgaXMgbm90IGltcGxlbWVudGVkJylcbiAgfVxuXG4gIGFzeW5jIHNpZ25JbihfcGFyYW1zOiBhdXRoTW9kZWxzLlNpZ25JblJlcXVlc3QpOiBQcm9taXNlPExvZ2luU3RhdGU+IHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0F1dGguc2lnbkluKCkgaXMgbm90IGltcGxlbWVudGVkJylcbiAgfVxuXG4gIGFzeW5jIHNpZ25JbldpdGhQcm92aWRlcihfcGFyYW1zOiBhdXRoTW9kZWxzLlNpZ25JbldpdGhQcm92aWRlclJlcXVlc3QpOiBQcm9taXNlPExvZ2luU3RhdGU+IHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0F1dGguc2lnbkluV2l0aFByb3ZpZGVyKCkgaXMgbm90IGltcGxlbWVudGVkJylcbiAgfVxuXG4gIGFzeW5jIGdlblByb3ZpZGVyUmVkaXJlY3RVcmkoX3BhcmFtczogYXV0aE1vZGVscy5HZW5Qcm92aWRlclJlZGlyZWN0VXJpUmVxdWVzdCwpOiBQcm9taXNlPGF1dGhNb2RlbHMuR2VuUHJvdmlkZXJSZWRpcmVjdFVyaVJlc3BvbnNlPiB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdBdXRoLmdlblByb3ZpZGVyUmVkaXJlY3RVcmkoKSBpcyBub3QgaW1wbGVtZW50ZWQnKVxuICB9XG5cbiAgYXN5bmMgZ2V0QWNjZXNzVG9rZW4oKTogUHJvbWlzZTx7XG4gICAgYWNjZXNzVG9rZW46IGFueVxuICAgIGVudjogc3RyaW5nXG4gIH0+IHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0F1dGguZ2V0QWNjZXNzVG9rZW4oKSBpcyBub3QgaW1wbGVtZW50ZWQnKVxuICB9XG5cbiAgYXN5bmMgZ2V0VXNlckluZm8oKTogUHJvbWlzZTwoYXV0aE1vZGVscy5Vc2VySW5mbyAmIFBhcnRpYWw8VXNlcj4pIHwgbnVsbD4ge1xuICAgIHRocm93IG5ldyBFcnJvcignQXV0aC5nZXRVc2VySW5mbygpIGlzIG5vdCBpbXBsZW1lbnRlZCcpXG4gIH1cblxuICBhc3luYyB1cGRhdGVVc2VyQmFzaWNJbmZvKF9wYXJhbXM6IGF1dGhNb2RlbHMuTW9kaWZ5VXNlckJhc2ljSW5mb1JlcXVlc3QpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0F1dGgudXBkYXRlVXNlckJhc2ljSW5mbygpIGlzIG5vdCBpbXBsZW1lbnRlZCcpXG4gIH1cblxuICBzZXRDdXN0b21TaWduRnVuYyhfZ2V0VGlja0ZuOiBhdXRoTW9kZWxzLkdldEN1c3RvbVNpZ25UaWNrZXRGbik6IHZvaWQge1xuICAgIHRocm93IG5ldyBFcnJvcignQXV0aC5zZXRDdXN0b21TaWduRnVuYygpIGlzIG5vdCBpbXBsZW1lbnRlZCcpXG4gIH1cblxuICBhc3luYyBncmFudFByb3ZpZGVyVG9rZW4oX3BhcmFtczogYXV0aE1vZGVscy5HcmFudFByb3ZpZGVyVG9rZW5SZXF1ZXN0LCk6IFByb21pc2U8YXV0aE1vZGVscy5HcmFudFByb3ZpZGVyVG9rZW5SZXNwb25zZT4ge1xuICAgIHRocm93IG5ldyBFcnJvcignQXV0aC5ncmFudFByb3ZpZGVyVG9rZW4oKSBpcyBub3QgaW1wbGVtZW50ZWQnKVxuICB9XG5cbiAgYXN5bmMgYmluZFdpdGhQcm92aWRlcihfcGFyYW1zOiBhdXRoTW9kZWxzLkJpbmRXaXRoUHJvdmlkZXJSZXF1ZXN0KTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdBdXRoLmJpbmRXaXRoUHJvdmlkZXIoKSBpcyBub3QgaW1wbGVtZW50ZWQnKVxuICB9XG5cbiAgYXN5bmMgc2lnbkluV2l0aFVzZXJuYW1lKF9wYXJhbXM6IHtcbiAgICB2ZXJpZmljYXRpb25JbmZvPzogeyB2ZXJpZmljYXRpb25faWQ6IHN0cmluZzsgaXNfdXNlcjogYm9vbGVhbiB9XG4gICAgdmVyaWZpY2F0aW9uQ29kZT86IHN0cmluZ1xuICAgIHVzZXJuYW1lPzogc3RyaW5nIC8vIOeUqOaIt+WQjeensO+8jOmVv+W6piA1LTI0IOS9je+8jOaUr+aMgeWtl+espuS4reiLseaWh+OAgeaVsOWtl+OAgeeJueauiuWtl+espu+8iOS7heaUr+aMgV8t77yJ77yM5LiN5pSv5oyB5Lit5paHXG4gICAgYmluZEluZm8/OiBhbnlcbiAgICBsb2dpblR5cGU/OiBzdHJpbmdcbiAgICBhdXRvU2lnblVwPzogYm9vbGVhblxuICB9KTogUHJvbWlzZTxMb2dpblN0YXRlPiB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdBdXRoLnNpZ25JbldpdGhVc2VybmFtZSgpIGlzIG5vdCBpbXBsZW1lbnRlZCcpXG4gIH1cblxuICBhc3luYyBnZXRWZXJpZmljYXRpb24oXG4gICAgX3BhcmFtczogYXV0aE1vZGVscy5HZXRWZXJpZmljYXRpb25SZXF1ZXN0LFxuICAgIF9vcHRpb25zPzogeyB3aXRoQ2FwdGNoYTogYm9vbGVhbiB9LFxuICApOiBQcm9taXNlPGF1dGhNb2RlbHMuR2V0VmVyaWZpY2F0aW9uUmVzcG9uc2U+IHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0F1dGguZ2V0VmVyaWZpY2F0aW9uKCkgaXMgbm90IGltcGxlbWVudGVkJylcbiAgfVxuXG4gIGFzeW5jIGNyZWF0ZUxvZ2luU3RhdGUoXG4gICAgX3BhcmFtcz86IHsgdmVyc2lvbj86IHN0cmluZzsgcXVlcnk/OiBhbnkgfSxcbiAgICBfb3B0aW9ucz86IHsgYXN5bmNSZWZyZXNoVXNlcj86IGJvb2xlYW4gfSxcbiAgKTogUHJvbWlzZTxMb2dpblN0YXRlPiB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdBdXRoLmNyZWF0ZUxvZ2luU3RhdGUoKSBpcyBub3QgaW1wbGVtZW50ZWQnKVxuICB9XG5cbiAgYXN5bmMgdmVyaWZ5KF9wYXJhbXM6IGF1dGhNb2RlbHMuVmVyaWZ5UmVxdWVzdCk6IFByb21pc2U8YXV0aE1vZGVscy5WZXJpZnlSZXNwb25zZT4ge1xuICAgIHRocm93IG5ldyBFcnJvcignQXV0aC52ZXJpZnkoKSBpcyBub3QgaW1wbGVtZW50ZWQnKVxuICB9XG5cbiAgLyoqXG4gICAqIGh0dHBzOi8vc3VwYWJhc2UuY29tL2RvY3MvcmVmZXJlbmNlL2phdmFzY3JpcHQvYXV0aC1zaWduaW5hbm9ueW1vdXNseVxuICAgKiBTaWduIGluIGEgdXNlciBhbm9ueW1vdXNseS5cbiAgICogY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgYXV0aC5zaWduSW5Bbm9ueW1vdXNseSgpO1xuICAgKiBAcGFyYW0gcGFyYW1zXG4gICAqIEByZXR1cm5zICBQcm9taXNlPFNpZ25JblJlcz5cbiAgICovXG4gIGFzeW5jIHNpZ25JbkFub255bW91c2x5KHBhcmFtczogU2lnbkluQW5vbnltb3VzbHlSZXEpOiBQcm9taXNlPFNpZ25JblJlcz4ge1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCB0aGlzLm9hdXRoSW5zdGFuY2UuYXV0aEFwaS5zaWduSW5Bbm9ueW1vdXNseShwYXJhbXMpXG4gICAgICBjb25zdCBsb2dpblN0YXRlID0gYXdhaXQgdGhpcy5jcmVhdGVMb2dpblN0YXRlKClcblxuICAgICAgY29uc3QgeyBkYXRhOiB7IHNlc3Npb24gfSA9IHt9IH0gPSBhd2FpdCB0aGlzLmdldFNlc3Npb24oKVxuXG4gICAgICAvLyBsb2dpblN0YXRl6L+U5Zue5piv5Li65LqG5YW85a65djLniYjmnKxcbiAgICAgIHJldHVybiB7IC4uLihsb2dpblN0YXRlIGFzIGFueSksIGRhdGE6IHsgdXNlcjogc2Vzc2lvbi51c2VyLCBzZXNzaW9uIH0sIGVycm9yOiBudWxsIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgcmV0dXJuIHsgZGF0YToge30sIGVycm9yOiBuZXcgQXV0aEVycm9yKGVycm9yKSB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIGh0dHBzOi8vc3VwYWJhc2UuY29tL2RvY3MvcmVmZXJlbmNlL2phdmFzY3JpcHQvYXV0aC1zaWdudXBcbiAgICogU2lnbiB1cCBhIG5ldyB1c2VyIHdpdGggZW1haWwgb3IgcGhvbmUgdXNpbmcgYSBvbmUtdGltZSBwYXNzd29yZCAoT1RQKS4gSWYgdGhlIGFjY291bnQgbm90IGV4aXN0LCBhIG5ldyBhY2NvdW50IHdpbGwgYmUgY3JlYXRlZC5cbiAgICogbGV0IHNpZ25VcFJlc29sdmUgPSBudWxsO1xuICAgIGNvbnN0IHJlcyA9IGF3YWl0IGFwcC5hdXRoLnNpZ25VcCh7XG4gICAgICBwaG9uZTogXCJ4eHh4eHhcIixcbiAgICB9KTtcblxuICAgIHNpZ25VcFJlc29sdmUgPSByZXMuZGF0YS52ZXJpZnlcblxuICAgIGNvbnN0IHJlcyA9IGF3YWl0IHNpZ25VcFJlc29sdmUoY29kZSk7XG5cbiAgICAvLyByZXMuZGF0YS5jYWxsYmFja+aUr+aMgSBtZXNzYWdlSWQg5Y+C5pWw55So5LqO6YeN5paw5Y+R6YCB6aqM6K+B56CB6L+b6KGM6aqM6K+B77yMbWVzc2FnZUlkIOWPr+S7peS7jiByZXNlbmQoKSDmlrnms5XkuK3ojrflj5ZcbiAgICBjb25zdCB7IGRhdGEgfSA9IGF3YWl0IGFwcC5hdXRoLnJlc2VuZCh7XG4gICAgICB0eXBlOiBcInNpZ251cFwiLFxuICAgICAgcGhvbmU6IFwieHh4eHh4XCIsXG4gICAgfSlcbiAgICBjb25zdCByZXMgPSBhd2FpdCBzaWduVXBSZXNvbHZlKGNvZGUsIGRhdGEubWVzc2FnZUlkKTtcbiAgICogQHBhcmFtIHBhcmFtc1xuICAgKiBAcmV0dXJucyBQcm9taXNlPFNpZ25VcFJlcz5cbiAgICovXG4gIGFzeW5jIHNpZ25VcChwYXJhbXM6IGF1dGhNb2RlbHMuU2lnblVwUmVxdWVzdCk6IFByb21pc2U8U2lnblVwUmVzPiB7XG4gICAgaWYgKHBhcmFtcy5waG9uZV9udW1iZXIgfHwgcGFyYW1zLnZlcmlmaWNhdGlvbl9jb2RlIHx8IHBhcmFtcy52ZXJpZmljYXRpb25fdG9rZW4gfHwgcGFyYW1zLnByb3ZpZGVyX3Rva2VuKSB7XG4gICAgICBhd2FpdCB0aGlzLm9hdXRoSW5zdGFuY2UuYXV0aEFwaS5zaWduVXAocGFyYW1zKVxuICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlTG9naW5TdGF0ZSgpIGFzIGFueVxuICAgIH1cbiAgICB0cnkge1xuICAgICAgLy8g5Y+C5pWw5qCh6aqM77yaZW1haWzmiJZwaG9uZeW/heWhq+WFtuS4gFxuICAgICAgdGhpcy52YWxpZGF0ZUF0TGVhc3RPbmUocGFyYW1zLCBbWydlbWFpbCddLCBbJ3Bob25lJ11dLCAnWW91IG11c3QgcHJvdmlkZSBlaXRoZXIgYW4gZW1haWwgb3IgcGhvbmUgbnVtYmVyJylcblxuICAgICAgLy8g56ys5LiA5q2l77ya5Y+R6YCB6aqM6K+B56CB5bm25a2Y5YKoIHZlcmlmaWNhdGlvbkluZm9cbiAgICAgIGNvbnN0IHZlcmlmaWNhdGlvbkluZm8gPSBhd2FpdCB0aGlzLmdldFZlcmlmaWNhdGlvbihwYXJhbXMuZW1haWwgPyB7IGVtYWlsOiBwYXJhbXMuZW1haWwgfSA6IHsgcGhvbmVfbnVtYmVyOiB0aGlzLmZvcm1hdFBob25lKHBhcmFtcy5waG9uZSkgfSwpXG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAvLyDnrKzkuozmraXvvJrnrYnlvoXnlKjmiLfovpPlhaXpqozor4HnoIHvvIjpgJrov4cgUHJvbWlzZSDljIXoo4XnlKjmiLfovpPlhaXkuovku7bvvIlcbiAgICAgICAgICB2ZXJpZnlPdHA6IGFzeW5jICh7IHRva2VuLCBtZXNzYWdlSWQgPSB2ZXJpZmljYXRpb25JbmZvLnZlcmlmaWNhdGlvbl9pZCB9KTogUHJvbWlzZTxTaWduSW5SZXM+ID0+IHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgIC8vIOesrOS4ieatpe+8muW+heeUqOaIt+i+k+WFpeWujOmqjOivgeeggeS5i+WQju+8jOmqjOivgeefreS/oemqjOivgeeggVxuICAgICAgICAgICAgICBjb25zdCB2ZXJpZmljYXRpb25Ub2tlblJlcyA9IGF3YWl0IHRoaXMudmVyaWZ5KHtcbiAgICAgICAgICAgICAgICB2ZXJpZmljYXRpb25faWQ6IG1lc3NhZ2VJZCB8fCB2ZXJpZmljYXRpb25JbmZvLnZlcmlmaWNhdGlvbl9pZCxcbiAgICAgICAgICAgICAgICB2ZXJpZmljYXRpb25fY29kZTogdG9rZW4sXG4gICAgICAgICAgICAgIH0pXG5cbiAgICAgICAgICAgICAgLy8g56ys5Zub5q2l77ya5rOo5YaM5bm255m75b2V5oiW55u05o6l55m75b2VXG4gICAgICAgICAgICAgIC8vIOWmguaenOeUqOaIt+W3sue7j+WtmOWcqO+8jOebtOaOpeeZu+W9lVxuICAgICAgICAgICAgICBpZiAodmVyaWZpY2F0aW9uSW5mby5pc191c2VyKSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5zaWduSW4oe1xuICAgICAgICAgICAgICAgICAgdXNlcm5hbWU6IHBhcmFtcy5lbWFpbCB8fCB0aGlzLmZvcm1hdFBob25lKHBhcmFtcy5waG9uZSksXG4gICAgICAgICAgICAgICAgICB2ZXJpZmljYXRpb25fdG9rZW46IHZlcmlmaWNhdGlvblRva2VuUmVzLnZlcmlmaWNhdGlvbl90b2tlbixcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIOWmguaenOeUqOaIt+S4jeWtmOWcqO+8jOazqOWGjOeUqOaIt1xuICAgICAgICAgICAgICAgIGNvbnN0IGRhdGEgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHBhcmFtcykpXG4gICAgICAgICAgICAgICAgZGVsZXRlIGRhdGEuZW1haWxcbiAgICAgICAgICAgICAgICBkZWxldGUgZGF0YS5waG9uZVxuXG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5vYXV0aEluc3RhbmNlLmF1dGhBcGkuc2lnblVwKHtcbiAgICAgICAgICAgICAgICAgIC4uLmRhdGEsXG4gICAgICAgICAgICAgICAgICAuLi4ocGFyYW1zLmVtYWlsID8geyBlbWFpbDogcGFyYW1zLmVtYWlsIH0gOiB7IHBob25lX251bWJlcjogdGhpcy5mb3JtYXRQaG9uZShwYXJhbXMucGhvbmUpIH0pLFxuICAgICAgICAgICAgICAgICAgdmVyaWZpY2F0aW9uX3Rva2VuOiB2ZXJpZmljYXRpb25Ub2tlblJlcy52ZXJpZmljYXRpb25fdG9rZW4sXG4gICAgICAgICAgICAgICAgICB2ZXJpZmljYXRpb25fY29kZTogdG9rZW4sXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLmNyZWF0ZUxvZ2luU3RhdGUoKVxuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgY29uc3QgeyBkYXRhOiB7IHNlc3Npb24gfSA9IHt9IH0gPSBhd2FpdCB0aGlzLmdldFNlc3Npb24oKVxuXG4gICAgICAgICAgICAgIHJldHVybiB7IGRhdGE6IHsgdXNlcjogc2Vzc2lvbi51c2VyLCBzZXNzaW9uIH0sIGVycm9yOiBudWxsIH1cbiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgIHJldHVybiB7IGRhdGE6IHt9LCBlcnJvcjogbmV3IEF1dGhFcnJvcihlcnJvcikgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIGVycm9yOiBudWxsLFxuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICByZXR1cm4geyBkYXRhOiB7fSwgZXJyb3I6IG5ldyBBdXRoRXJyb3IoZXJyb3IpIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogaHR0cHM6Ly9zdXBhYmFzZS5jb20vZG9jcy9yZWZlcmVuY2UvamF2YXNjcmlwdC9hdXRoLXNpZ25vdXRcbiAgICogY29uc3QgcmVzdWx0ID0gYXdhaXQgYXV0aC5zaWduT3V0KCk7XG4gICAqXG4gICAqIEBwYXJhbSBwYXJhbXNcbiAgICovXG4gIGFzeW5jIHNpZ25PdXQocGFyYW1zPzogYXV0aE1vZGVscy5TaWdub3V0UmVxdWVzdCk6IFByb21pc2U8dm9pZCB8IGF1dGhNb2RlbHMuU2lnbm91dFJlcG9uc2U+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgeyB1c2VySW5mb0tleSB9ID0gdGhpcy5jYWNoZS5rZXlzXG4gICAgICBjb25zdCByZXMgPSBhd2FpdCB0aGlzLm9hdXRoSW5zdGFuY2UuYXV0aEFwaS5zaWduT3V0KHBhcmFtcylcbiAgICAgIGF3YWl0IHRoaXMuY2FjaGUucmVtb3ZlU3RvcmVBc3luYyh1c2VySW5mb0tleSlcbiAgICAgIHRoaXMuc2V0QWNjZXNzS2V5KClcblxuICAgICAgdGhpcy5jb25maWcuZXZlbnRCdXM/LmZpcmUoRVZFTlRTLkxPR0lOX1NUQVRFX0NIQU5HRUQsIHsgZXZlbnRUeXBlOiBMT0dJTl9TVEFURV9DSEFOR0VEX1RZUEUuU0lHTl9PVVQgfSlcblxuICAgICAgdGhpcy5jb25maWcuZXZlbnRCdXM/LmZpcmUoRVZFTlRTLkFVVEhfU1RBVEVfQ0hBTkdFRCwgeyBldmVudDogQVVUSF9TVEFURV9DSEFOR0VEX1RZUEUuU0lHTkVEX09VVCB9KVxuXG4gICAgICAvLyByZXPov5Tlm57mmK/kuLrkuoblhbzlrrl2MueJiOacrFxuICAgICAgcmV0dXJuIHsgLi4ucmVzLCBkYXRhOiB7fSwgZXJyb3I6IG51bGwgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICByZXR1cm4geyBkYXRhOiB7fSwgZXJyb3I6IG5ldyBBdXRoRXJyb3IoZXJyb3IpIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogaHR0cHM6Ly9zdXBhYmFzZS5jb20vZG9jcy9yZWZlcmVuY2UvamF2YXNjcmlwdC9hdXRoLW9uYXV0aHN0YXRlY2hhbmdlXG4gICAqIFJlY2VpdmUgYSBub3RpZmljYXRpb24gZXZlcnkgdGltZSBhbiBhdXRoIGV2ZW50IGhhcHBlbnMuIFNhZmUgdG8gdXNlIHdpdGhvdXQgYW4gYXN5bmMgZnVuY3Rpb24gYXMgY2FsbGJhY2suXG4gICAqIGNvbnN0IHsgZGF0YSB9ID0gYXBwLmF1dGgub25BdXRoU3RhdGVDaGFuZ2UoKGV2ZW50LCBzZXNzaW9uKSA9PiB7XG4gICAgICBjb25zb2xlLmxvZyhldmVudCwgc2Vzc2lvbik7XG4gICAgICBpZiAoZXZlbnQgPT09IFwiSU5JVElBTF9TRVNTSU9OXCIpIHtcbiAgICAgICAgLy8gaGFuZGxlIGluaXRpYWwgc2Vzc2lvblxuICAgICAgfSBlbHNlIGlmIChldmVudCA9PT0gXCJTSUdORURfSU5cIikge1xuICAgICAgICAvLyBoYW5kbGUgc2lnbiBpbiBldmVudFxuICAgICAgfSBlbHNlIGlmIChldmVudCA9PT0gXCJTSUdORURfT1VUXCIpIHtcbiAgICAgICAgLy8gaGFuZGxlIHNpZ24gb3V0IGV2ZW50XG4gICAgICB9IGVsc2UgaWYgKGV2ZW50ID09PSBcIlBBU1NXT1JEX1JFQ09WRVJZXCIpIHtcbiAgICAgICAgLy8gaGFuZGxlIHBhc3N3b3JkIHJlY292ZXJ5IGV2ZW50XG4gICAgICB9IGVsc2UgaWYgKGV2ZW50ID09PSBcIlRPS0VOX1JFRlJFU0hFRFwiKSB7XG4gICAgICAgIC8vIGhhbmRsZSB0b2tlbiByZWZyZXNoZWQgZXZlbnRcbiAgICAgIH0gZWxzZSBpZiAoZXZlbnQgPT09IFwiVVNFUl9VUERBVEVEXCIpIHtcbiAgICAgICAgLy8gaGFuZGxlIHVzZXIgdXBkYXRlZCBldmVudFxuICAgICAgfVxuICAgIH0pO1xuICAgIC8vIGNhbGwgdW5zdWJzY3JpYmUgdG8gcmVtb3ZlIHRoZSBjYWxsYmFja1xuICAgIGRhdGEuc3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAqIEBwYXJhbSBjYWxsYmFja1xuICAgKiBAcmV0dXJucyBQcm9taXNlPHsgZGF0YTogeyBzdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbiB9LCBlcnJvcjogRXJyb3IgfCBudWxsIH0+XG4gICAqL1xuICBvbkF1dGhTdGF0ZUNoYW5nZShjYWxsYmFjazogT25BdXRoU3RhdGVDaGFuZ2VDYWxsYmFjaykge1xuICAgIGlmICghdGhpcy5oYXNMaXN0ZW5lclNldFVwKSB7XG4gICAgICB0aGlzLnNldHVwTGlzdGVuZXJzKClcbiAgICAgIHRoaXMuaGFzTGlzdGVuZXJTZXRVcCA9IHRydWVcbiAgICB9XG5cbiAgICBjb25zdCBpZCA9IE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpXG5cbiAgICBpZiAoIXRoaXMubGlzdGVuZXJzLmhhcyhpZCkpIHtcbiAgICAgIHRoaXMubGlzdGVuZXJzLnNldChpZCwgbmV3IFNldCgpKVxuICAgIH1cblxuICAgIHRoaXMubGlzdGVuZXJzLmdldChpZCkhLmFkZChjYWxsYmFjaylcblxuICAgIC8vIOi/lOWbniBTdWJzY3JpcHRpb24g5a+56LGhXG4gICAgY29uc3Qgc3Vic2NyaXB0aW9uID0ge1xuICAgICAgaWQsXG4gICAgICBjYWxsYmFjayxcbiAgICAgIHVuc3Vic2NyaWJlOiAoKSA9PiB7XG4gICAgICAgIGNvbnN0IGNhbGxiYWNrcyA9IHRoaXMubGlzdGVuZXJzLmdldChpZClcbiAgICAgICAgaWYgKGNhbGxiYWNrcykge1xuICAgICAgICAgIGNhbGxiYWNrcy5kZWxldGUoY2FsbGJhY2spXG4gICAgICAgICAgaWYgKGNhbGxiYWNrcy5zaXplID09PSAwKSB7XG4gICAgICAgICAgICB0aGlzLmxpc3RlbmVycy5kZWxldGUoaWQpXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9LFxuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICBkYXRhOiB7IHN1YnNjcmlwdGlvbiB9LFxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBodHRwczovL3N1cGFiYXNlLmNvbS9kb2NzL3JlZmVyZW5jZS9qYXZhc2NyaXB0L2F1dGgtc2lnbmlud2l0aHBhc3N3b3JkXG4gICAqIExvZyBpbiBhbiBleGlzdGluZyB1c2VyIHdpdGggYW4gZW1haWwgYW5kIHBhc3N3b3JkIG9yIHBob25lIGFuZCBwYXNzd29yZCBvciB1c2VybmFtZSBhbmQgcGFzc3dvcmQuXG4gICAqIGNvbnN0IHsgZGF0YSB9ID0gYXdhaXQgYXBwLmF1dGguc2lnbkluV2l0aFBhc3N3b3JkKHtcbiAgICAgIHVzZXJuYW1lOiBcInh4eFwiLFxuICAgICAgcGFzc3dvcmQ6IFwieHh4XCIsXG4gICAgfSlcbiAgICogQHBhcmFtIHBhcmFtc1xuICAgKiBAcmV0dXJucyBQcm9taXNlPFNpZ25JblJlcz5cbiAgICovXG4gIGFzeW5jIHNpZ25JbldpdGhQYXNzd29yZChwYXJhbXM6IFNpZ25JbldpdGhQYXNzd29yZFJlcSk6IFByb21pc2U8U2lnbkluUmVzPiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIOWPguaVsOagoemqjO+8mnVzZXJuYW1lL2VtYWlsL3Bob25l5LiJ6YCJ5LiA77yMcGFzc3dvcmTlv4XloatcbiAgICAgIHRoaXMudmFsaWRhdGVBdExlYXN0T25lKFxuICAgICAgICBwYXJhbXMsXG4gICAgICAgIFtbJ3VzZXJuYW1lJ10sIFsnZW1haWwnXSwgWydwaG9uZSddXSxcbiAgICAgICAgJ1lvdSBtdXN0IHByb3ZpZGUgZWl0aGVyIHVzZXJuYW1lLCBlbWFpbCwgb3IgcGhvbmUnLFxuICAgICAgKVxuICAgICAgdGhpcy52YWxpZGF0ZVBhcmFtcyhwYXJhbXMsIHtcbiAgICAgICAgcGFzc3dvcmQ6IHsgcmVxdWlyZWQ6IHRydWUsIG1lc3NhZ2U6ICdQYXNzd29yZCBpcyByZXF1aXJlZCcgfSxcbiAgICAgIH0pXG5cbiAgICAgIGF3YWl0IHRoaXMuc2lnbkluKHtcbiAgICAgICAgdXNlcm5hbWU6IHBhcmFtcy51c2VybmFtZSB8fCBwYXJhbXMuZW1haWwgfHwgdGhpcy5mb3JtYXRQaG9uZShwYXJhbXMucGhvbmUpLFxuICAgICAgICBwYXNzd29yZDogcGFyYW1zLnBhc3N3b3JkLFxuICAgICAgICAuLi4ocGFyYW1zLmlzX2VuY3J5cHQgPyB7IGlzRW5jcnlwdDogdHJ1ZSwgdmVyc2lvbjogJ3YyJyB9IDoge30pLFxuICAgICAgfSlcbiAgICAgIGNvbnN0IHsgZGF0YTogeyBzZXNzaW9uIH0gPSB7fSB9ID0gYXdhaXQgdGhpcy5nZXRTZXNzaW9uKClcblxuICAgICAgcmV0dXJuIHsgZGF0YTogeyB1c2VyOiBzZXNzaW9uLnVzZXIsIHNlc3Npb24gfSwgZXJyb3I6IG51bGwgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICByZXR1cm4geyBkYXRhOiB7fSwgZXJyb3I6IG5ldyBBdXRoRXJyb3IoZXJyb3IpIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogaHR0cHM6Ly9zdXBhYmFzZS5jb20vZG9jcy9yZWZlcmVuY2UvamF2YXNjcmlwdC9hdXRoLXNpZ25pbndpdGhpZHRva2VuXG4gICAqIOesrOS4ieaWueW5s+WPsOeZu+W9leOAguWmguaenOeUqOaIt+S4jeWtmOWcqO+8jOS8muagueaNruS6keW8gOWPkeW5s+WPsC3nmbvlvZXmlrnlvI/kuK3lr7nlupTouqvku73mupDnmoTnmbvlvZXmqKHlvI/phY3nva7vvIzliKTmlq3mmK/lkKboh6rliqjms6jlhoxcbiAgICogQHBhcmFtIHBhcmFtc1xuICAgKiBAcmV0dXJucyBQcm9taXNlPFNpZ25JblJlcz5cbiAgICovXG4gIGFzeW5jIHNpZ25JbldpdGhJZFRva2VuKHBhcmFtczogU2lnbkluV2l0aElkVG9rZW5SZXEpOiBQcm9taXNlPFNpZ25JblJlcz4ge1xuICAgIHRyeSB7XG4gICAgICAvLyDlj4LmlbDmoKHpqozvvJp0b2tlbuW/heWhq1xuICAgICAgdGhpcy52YWxpZGF0ZVBhcmFtcyhwYXJhbXMsIHtcbiAgICAgICAgdG9rZW46IHsgcmVxdWlyZWQ6IHRydWUsIG1lc3NhZ2U6ICdUb2tlbiBpcyByZXF1aXJlZCcgfSxcbiAgICAgIH0pXG5cbiAgICAgIGF3YWl0IHRoaXMuc2lnbkluV2l0aFByb3ZpZGVyKHtcbiAgICAgICAgcHJvdmlkZXJfdG9rZW46IHBhcmFtcy50b2tlbixcbiAgICAgIH0pXG4gICAgICBjb25zdCB7IGRhdGE6IHsgc2Vzc2lvbiB9ID0ge30gfSA9IGF3YWl0IHRoaXMuZ2V0U2Vzc2lvbigpXG5cbiAgICAgIHJldHVybiB7IGRhdGE6IHsgdXNlcjogc2Vzc2lvbi51c2VyLCBzZXNzaW9uIH0sIGVycm9yOiBudWxsIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgcmV0dXJuIHsgZGF0YToge30sIGVycm9yOiBuZXcgQXV0aEVycm9yKGVycm9yKSB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIGh0dHBzOi8vc3VwYWJhc2UuY29tL2RvY3MvcmVmZXJlbmNlL2phdmFzY3JpcHQvYXV0aC1zaWduaW53aXRob3RwXG4gICAqIExvZyBpbiBhIHVzZXIgdXNpbmcgYSBvbmUtdGltZSBwYXNzd29yZCAoT1RQKS5cbiAgICogbGV0IHNpZ25SZXNvbHZlID0gbnVsbDtcbiAgICBjb25zdCByZXMgPSBhd2FpdCBhcHAuYXV0aC5zaWduSW5XaXRoT3RwKHtcbiAgICAgIHBob25lOiBcInh4eHh4eFwiLFxuICAgIH0pO1xuXG4gICAgc2lnblJlc29sdmUgPSByZXMuZGF0YS52ZXJpZnlcblxuICAgIGNvbnN0IHJlcyA9IGF3YWl0IHNpZ25SZXNvbHZlKGNvZGUpO1xuXG4gICAgLy8gcmVzLmRhdGEuY2FsbGJhY2vmlK/mjIEgbWVzc2FnZUlkIOWPguaVsOeUqOS6jumHjeaWsOWPkemAgemqjOivgeeggei/m+ihjOmqjOivge+8jG1lc3NhZ2VJZCDlj6/ku6Xku44gcmVzZW5kKCkg5pa55rOV5Lit6I635Y+WXG4gICAgY29uc3QgeyBkYXRhIH0gPSBhd2FpdCBhcHAuYXV0aC5yZXNlbmQoe1xuICAgICAgdHlwZTogXCJzaWdudXBcIixcbiAgICAgIHBob25lOiBcInh4eHh4eFwiLFxuICAgIH0pXG4gICAgY29uc3QgcmVzID0gYXdhaXQgc2lnblVwUmVzb2x2ZShjb2RlLCBkYXRhLm1lc3NhZ2VJZCk7XG4gICAqIEBwYXJhbSBwYXJhbXNcbiAgICogQHJldHVybnMgUHJvbWlzZTxTaWduSW5XaXRoT3RwUmVzPlxuICAgKi9cbiAgYXN5bmMgc2lnbkluV2l0aE90cChwYXJhbXM6IFNpZ25JbldpdGhPdHBSZXEpOiBQcm9taXNlPFNpZ25JbldpdGhPdHBSZXM+IHtcbiAgICB0cnkge1xuICAgICAgLy8g5Y+C5pWw5qCh6aqM77yaZW1haWzmiJZwaG9uZeW/heWhq+WFtuS4gFxuICAgICAgdGhpcy52YWxpZGF0ZUF0TGVhc3RPbmUocGFyYW1zLCBbWydlbWFpbCddLCBbJ3Bob25lJ11dLCAnWW91IG11c3QgcHJvdmlkZSBlaXRoZXIgYW4gZW1haWwgb3IgcGhvbmUgbnVtYmVyJylcblxuICAgICAgLy8g56ys5LiA5q2l77ya5Y+R6YCB6aqM6K+B56CB5bm25a2Y5YKoIHZlcmlmaWNhdGlvbkluZm9cbiAgICAgIGNvbnN0IHZlcmlmaWNhdGlvbkluZm8gPSBhd2FpdCB0aGlzLmdldFZlcmlmaWNhdGlvbihwYXJhbXMuZW1haWwgPyB7IGVtYWlsOiBwYXJhbXMuZW1haWwgfSA6IHsgcGhvbmVfbnVtYmVyOiB0aGlzLmZvcm1hdFBob25lKHBhcmFtcy5waG9uZSkgfSwpXG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICB1c2VyOiBudWxsLFxuICAgICAgICAgIHNlc3Npb246IG51bGwsXG4gICAgICAgICAgLy8g56ys5LqM5q2l77ya562J5b6F55So5oi36L6T5YWl6aqM6K+B56CB77yI6YCa6L+HIFByb21pc2Ug5YyF6KOF55So5oi36L6T5YWl5LqL5Lu277yJXG4gICAgICAgICAgdmVyaWZ5T3RwOiBhc3luYyAoeyB0b2tlbiwgbWVzc2FnZUlkID0gdmVyaWZpY2F0aW9uSW5mby52ZXJpZmljYXRpb25faWQgfSk6IFByb21pc2U8U2lnbkluUmVzPiA9PiB0aGlzLnZlcmlmeU90cCh7XG4gICAgICAgICAgICBlbWFpbDogcGFyYW1zLmVtYWlsLFxuICAgICAgICAgICAgcGhvbmU6IHBhcmFtcy5waG9uZSxcbiAgICAgICAgICAgIHRva2VuLFxuICAgICAgICAgICAgbWVzc2FnZUlkLFxuICAgICAgICAgIH0pLFxuICAgICAgICB9LFxuICAgICAgICBlcnJvcjogbnVsbCxcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgcmV0dXJuIHsgZGF0YToge30sIGVycm9yOiBuZXcgQXV0aEVycm9yKGVycm9yKSB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIOagoemqjOesrOS4ieaWueW5s+WPsOaOiOadg+eZu+W9leWbnuiwg++8jOmcgOWFiOiwg+eUqCBzaWduSW5XaXRoT0F1dGgg55Sf5oiQ56ys5LiJ5pa55bmz5Y+w5o6I5p2DIFVyae+8jOiuv+mXruivpSBVcmkg5ZCO77yM5Lya6Lez6L2s5Yiw56ys5LiJ5pa55bmz5Y+w5o6I5p2D6aG16Z2i77yM5o6I5p2D5a6M5oiQ5ZCO5Zue6LCD5Zue5p2l5YaN6LCD55So6K+l5pa55rOV77yM5LiN5Lyg5Y+C5pWw5YiZ5LuOIHVybCBxdWVyeSDlkowgc2Vzc2lvblN0b3JhZ2Ug5Lit6I635Y+WXG4gICAqIC8vIDEuIOiOt+WPluesrOS4ieaWueW5s+WPsOaOiOadg+mhteWcsOWdgFxuICAgIGNvbnN0IHsgZGF0YSB9ID0gYXBwLmF1dGguc2lnbkluV2l0aE9BdXRoKHtcbiAgICAgIHByb3ZpZGVyOiAnc3RyaW5nJ1xuICAgICAgb3B0aW9uczoge1xuICAgICAgICByZWRpcmVjdFRvOiAnaHR0cHM6Ly9leGFtcGxlLmNvbS9jYWxsYmFjaydcbiAgICAgICAgc3RhdGU6ICdzdHJpbmcnXG4gICAgICB9XG4gICAgfSlcblxuICAgIC8vIDIuIOiuv+mXrnVyaSDvvIjlpoIgbG9jYXRpb24uaHJlZiA9IHVyae+8iVxuXG4gICAgLy8gMy4g5qCh6aqM56ys5LiJ5pa55bmz5Y+w5o6I5p2D5Zue6LCDXG4gICAgY29uc3QgeyBkYXRhIH0gPSBhd2FpdCBhcHAuYXV0aC52ZXJpZnlPQXV0aCgpXG4gICAqIEBwYXJhbSBwYXJhbXNcbiAgICogQHJldHVybnMgUHJvbWlzZTxTaWduSW5SZXM+XG4gICAqL1xuICBhc3luYyB2ZXJpZnlPQXV0aChwYXJhbXM/OiBWZXJpZnlPQXV0aFJlcSk6IFByb21pc2U8U2lnbkluUmVzIHwgTGlua0lkZW50aXR5UmVzPiB7XG4gICAgY29uc3QgZGF0YTogYW55ID0ge31cbiAgICB0cnkge1xuICAgICAgLy8g5Zue6LCD6IezIHByb3ZpZGVyX3JlZGlyZWN0X3VyaSDlnLDlnYDvvIh1cmwgcXVlcnnkuK3mkLrluKYg5o6I5p2DY29kZe+8jHN0YXRl562J5Y+C5pWw77yJ77yM5q2k5pe25qOA5p+lIHN0YXRlIOaYr+WQpuespuWQiOmihOacn++8iOWmgiDoh6rlt7Horr7nva7nmoQgd3hfb3BlbilcbiAgICAgIGNvbnN0IGNvZGUgPSBwYXJhbXM/LmNvZGUgfHwgdXRpbHMuZ2V0UXVlcnkoJ2NvZGUnKVxuICAgICAgY29uc3Qgc3RhdGUgPSBwYXJhbXM/LnN0YXRlIHx8IHV0aWxzLmdldFF1ZXJ5KCdzdGF0ZScpXG5cbiAgICAgIC8vIOWPguaVsOagoemqjO+8mmNvZGXlkoxzdGF0ZeW/heWhq1xuICAgICAgaWYgKCFjb2RlKSB7XG4gICAgICAgIHJldHVybiB7IGRhdGE6IHt9LCBlcnJvcjogbmV3IEF1dGhFcnJvcih7IG1lc3NhZ2U6ICdDb2RlIGlzIHJlcXVpcmVkJyB9KSB9XG4gICAgICB9XG5cbiAgICAgIGlmICghc3RhdGUpIHtcbiAgICAgICAgcmV0dXJuIHsgZGF0YToge30sIGVycm9yOiBuZXcgQXV0aEVycm9yKHsgbWVzc2FnZTogJ1N0YXRlIGlzIHJlcXVpcmVkJyB9KSB9XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGNhY2hlRGF0YSA9IGdldEJyb3dzZXJTZXNzaW9uKHN0YXRlKVxuICAgICAgZGF0YS50eXBlID0gY2FjaGVEYXRhPy50eXBlXG5cbiAgICAgIGNvbnN0IHByb3ZpZGVyID0gcGFyYW1zPy5wcm92aWRlciB8fCBjYWNoZURhdGE/LnByb3ZpZGVyIHx8IHV0aWxzLmdldFF1ZXJ5KCdwcm92aWRlcicpXG5cbiAgICAgIGlmICghcHJvdmlkZXIpIHtcbiAgICAgICAgcmV0dXJuIHsgZGF0YSwgZXJyb3I6IG5ldyBBdXRoRXJyb3IoeyBtZXNzYWdlOiAnUHJvdmlkZXIgaXMgcmVxdWlyZWQnIH0pIH1cbiAgICAgIH1cblxuICAgICAgLy8gc3RhdGXnrKblkIjpooTmnJ/vvIzliJnojrflj5bor6XkuInmlrnlubPlj7B0b2tlblxuICAgICAgY29uc3QgeyBwcm92aWRlcl90b2tlbjogdG9rZW4gfSA9IGF3YWl0IHRoaXMuZ3JhbnRQcm92aWRlclRva2VuKHtcbiAgICAgICAgcHJvdmlkZXJfaWQ6IHByb3ZpZGVyLFxuICAgICAgICBwcm92aWRlcl9yZWRpcmVjdF91cmk6IGxvY2F0aW9uLm9yaWdpbiArIGxvY2F0aW9uLnBhdGhuYW1lLCAvLyDmjIflrprkuInmlrnlubPlj7Dot7Plm57nmoQgdXJsIOWcsOWdgFxuICAgICAgICBwcm92aWRlcl9jb2RlOiBjb2RlLCAvLyDnrKzkuInmlrnlubPlj7Dot7Povazlm57pobXpnaLml7bvvIx1cmwgcGFyYW0g5Lit5pC65bim55qEIGNvZGUg5Y+C5pWwXG4gICAgICB9KVxuXG4gICAgICBsZXQgcmVzOiBTaWduSW5SZXMgfCBMaW5rSWRlbnRpdHlSZXNcblxuICAgICAgaWYgKGNhY2hlRGF0YS50eXBlID09PSBPQVVUSF9UWVBFLkJJTkRfSURFTlRJVFkpIHtcbiAgICAgICAgcmVzID0gYXdhaXQgdGhpcy5vYXV0aEluc3RhbmNlLmF1dGhBcGkudG9CaW5kSWRlbnRpdHkoeyBwcm92aWRlcl90b2tlbjogdG9rZW4sIHByb3ZpZGVyLCBmaXJlRXZlbnQ6IHRydWUgfSlcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIOmAmui/hyBwcm92aWRlcl90b2tlbiDku4XnmbvlvZXmiJbnmbvlvZXlubbms6jlhozvvIjkuI7kupHlvIDlj5HlubPlj7At55m75b2V5pa55byPLei6q+S7vea6kOeZu+W9leaooeW8j+mFjee9ruacieWFs++8iVxuICAgICAgICByZXMgPSBhd2FpdCB0aGlzLnNpZ25JbldpdGhJZFRva2VuKHtcbiAgICAgICAgICB0b2tlbixcbiAgICAgICAgfSlcbiAgICAgICAgcmVzLmRhdGEgPSB7IC4uLmRhdGEsIC4uLnJlcy5kYXRhIH1cbiAgICAgIH1cblxuICAgICAgY29uc3QgbG9jYWxTZWFyY2ggPSBuZXcgVVJMU2VhcmNoUGFyYW1zKGxvY2F0aW9uPy5zZWFyY2gpXG4gICAgICBsb2NhbFNlYXJjaC5kZWxldGUoJ2NvZGUnKVxuICAgICAgbG9jYWxTZWFyY2guZGVsZXRlKCdzdGF0ZScpXG4gICAgICBhZGRVcmxTZWFyY2goXG4gICAgICAgIGNhY2hlRGF0YT8uc2VhcmNoID09PSB1bmRlZmluZWQgPyBgPyR7bG9jYWxTZWFyY2gudG9TdHJpbmcoKX1gIDogY2FjaGVEYXRhPy5zZWFyY2gsXG4gICAgICAgIGNhY2hlRGF0YT8uaGFzaCB8fCBsb2NhdGlvbi5oYXNoLFxuICAgICAgKVxuICAgICAgcmVtb3ZlQnJvd3NlclNlc3Npb24oc3RhdGUpXG5cbiAgICAgIHJldHVybiByZXNcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgcmV0dXJuIHsgZGF0YSwgZXJyb3I6IG5ldyBBdXRoRXJyb3IoZXJyb3IpIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogaHR0cHM6Ly9zdXBhYmFzZS5jb20vZG9jcy9yZWZlcmVuY2UvamF2YXNjcmlwdC9hdXRoLXNpZ25pbndpdGhvYXV0aFxuICAgKiDnlJ/miJDnrKzkuInmlrnlubPlj7DmjojmnYMgVXJpIO+8iOWmguW+ruS/oeS6jOe7tOeggeaJq+eggeaOiOadg+e9kemhte+8iVxuICAgKiBAcGFyYW0gcGFyYW1zXG4gICAqIEByZXR1cm5zIFByb21pc2U8U2lnbkluT0F1dGhSZXM+XG4gICAqL1xuICBhc3luYyBzaWduSW5XaXRoT0F1dGgocGFyYW1zOiBTaWduSW5XaXRoT0F1dGhSZXEpOiBQcm9taXNlPFNpZ25Jbk9BdXRoUmVzPiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIOWPguaVsOagoemqjO+8mnByb3ZpZGVy5b+F5aGrXG4gICAgICB0aGlzLnZhbGlkYXRlUGFyYW1zKHBhcmFtcywge1xuICAgICAgICBwcm92aWRlcjogeyByZXF1aXJlZDogdHJ1ZSwgbWVzc2FnZTogJ1Byb3ZpZGVyIGlzIHJlcXVpcmVkJyB9LFxuICAgICAgfSlcblxuICAgICAgY29uc3QgaHJlZiA9IHBhcmFtcy5vcHRpb25zPy5yZWRpcmVjdFRvIHx8IGxvY2F0aW9uLmhyZWZcblxuICAgICAgY29uc3QgdXJsT2JqZWN0ID0gbmV3IFVSTChocmVmKVxuXG4gICAgICBjb25zdCBwcm92aWRlcl9yZWRpcmVjdF91cmkgPSB1cmxPYmplY3Qub3JpZ2luICsgdXJsT2JqZWN0LnBhdGhuYW1lXG5cbiAgICAgIGNvbnN0IHN0YXRlID0gcGFyYW1zLm9wdGlvbnM/LnN0YXRlIHx8IGBwcmQtJHtwYXJhbXMucHJvdmlkZXJ9LSR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNilcbiAgICAgICAgLnNsaWNlKDIpfWBcblxuICAgICAgY29uc3QgeyB1cmkgfSA9IGF3YWl0IHRoaXMuZ2VuUHJvdmlkZXJSZWRpcmVjdFVyaSh7XG4gICAgICAgIHByb3ZpZGVyX2lkOiBwYXJhbXMucHJvdmlkZXIsXG4gICAgICAgIHByb3ZpZGVyX3JlZGlyZWN0X3VyaSxcbiAgICAgICAgc3RhdGUsXG4gICAgICB9KVxuXG4gICAgICAvLyDlr7kgVVJMIOi/m+ihjOino+eggVxuICAgICAgY29uc3QgZGVjb2RlZFVyaSA9IGRlY29kZVVSSUNvbXBvbmVudCh1cmkpXG5cbiAgICAgIC8vIOWQiOW5tumineWklueahOafpeivouWPguaVsFxuICAgICAgbGV0IGZpbmFsVXJpID0gZGVjb2RlZFVyaVxuXG4gICAgICBpZiAocGFyYW1zLm9wdGlvbnM/LnF1ZXJ5UGFyYW1zKSB7XG4gICAgICAgIGNvbnN0IHVybCA9IG5ldyBVUkwoZGVjb2RlZFVyaSlcbiAgICAgICAgT2JqZWN0LmVudHJpZXMocGFyYW1zLm9wdGlvbnMucXVlcnlQYXJhbXMpLmZvckVhY2goKFtrZXksIHZhbHVlXSkgPT4ge1xuICAgICAgICAgIHVybC5zZWFyY2hQYXJhbXMuc2V0KGtleSwgdmFsdWUpXG4gICAgICAgIH0pXG4gICAgICAgIGZpbmFsVXJpID0gdXJsLnRvU3RyaW5nKClcbiAgICAgIH1cblxuICAgICAgc2F2ZVRvQnJvd3NlclNlc3Npb24oc3RhdGUsIHtcbiAgICAgICAgcHJvdmlkZXI6IHBhcmFtcy5wcm92aWRlcixcbiAgICAgICAgc2VhcmNoOiB1cmxPYmplY3Quc2VhcmNoLFxuICAgICAgICBoYXNoOiB1cmxPYmplY3QuaGFzaCxcbiAgICAgICAgdHlwZTogcGFyYW1zLm9wdGlvbnM/LnR5cGUgfHwgT0FVVEhfVFlQRS5TSUdOX0lOLFxuICAgICAgfSlcblxuICAgICAgaWYgKGlzQnJvd3NlcigpICYmICFwYXJhbXMub3B0aW9ucz8uc2tpcEJyb3dzZXJSZWRpcmVjdCkge1xuICAgICAgICB3aW5kb3cubG9jYXRpb24uYXNzaWduKGZpbmFsVXJpKVxuICAgICAgfVxuXG4gICAgICByZXR1cm4geyBkYXRhOiB7IHVybDogZmluYWxVcmksIHByb3ZpZGVyOiBwYXJhbXMucHJvdmlkZXIgfSwgZXJyb3I6IG51bGwgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICByZXR1cm4geyBkYXRhOiB7fSwgZXJyb3I6IG5ldyBBdXRoRXJyb3IoZXJyb3IpIH1cbiAgICB9XG4gIH1cblxuICAvLyBodHRwczovL3N1cGFiYXNlLmNvbS9kb2NzL3JlZmVyZW5jZS9qYXZhc2NyaXB0L2F1dGgtc2lnbmlud2l0aHNzb1xuICBhc3luYyBzaWduSW5XaXRoU1NPKCkge1xuICAgIC8vXG4gIH1cblxuICAvLyBodHRwczovL3N1cGFiYXNlLmNvbS9kb2NzL3JlZmVyZW5jZS9qYXZhc2NyaXB0L2F1dGgtc2lnbmlud2l0aHdlYjNcbiAgYXN5bmMgc2lnbkluV2l0aFdlYjMoKSB7XG4gICAgLy9cbiAgfVxuXG4gIC8vIGh0dHBzOi8vc3VwYWJhc2UuY29tL2RvY3MvcmVmZXJlbmNlL2phdmFzY3JpcHQvYXV0aC1nZXRjbGFpbXNcbiAgYXN5bmMgZ2V0Q2xhaW1zKCk6IFByb21pc2U8R2V0Q2xhaW1zUmVzPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHsgYWNjZXNzVG9rZW4gfSA9IGF3YWl0IHRoaXMuZ2V0QWNjZXNzVG9rZW4oKVxuICAgICAgY29uc3QgcGFyc2VkVG9rZW4gPSB3ZWFwcEp3dERlY29kZUFsbChhY2Nlc3NUb2tlbilcbiAgICAgIHJldHVybiB7IGRhdGE6IHBhcnNlZFRva2VuLCBlcnJvcjogbnVsbCB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHJldHVybiB7IGRhdGE6IHt9LCBlcnJvcjogbmV3IEF1dGhFcnJvcihlcnJvcikgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBodHRwczovL3N1cGFiYXNlLmNvbS9kb2NzL3JlZmVyZW5jZS9qYXZhc2NyaXB0L2F1dGgtcmVzZXRwYXNzd29yZGZvcmVtYWlsXG4gICAqIOmAmui/hyBlbWFpbCDmiJbmiYvmnLrlj7fph43nva7lr4bnoIFcbiAgICogY29uc3QgeyBkYXRhIH0gPSBhd2FpdCBhcHAuYXV0aC5yZXNldFBhc3N3b3JkRm9yRW1haWwoXCJ4eHhAeHguY29tXCIpO1xuICAgKiBjb25zdCB7IGRhdGEgfSA9IGF3YWl0IGFwcC5hdXRoLnJlc2V0UGFzc3dvcmRGb3JFbWFpbChcIjEzODAwMTM4MDAwXCIpO1xuXG4gICAgIGF3YWl0IGRhdGEudXBkYXRlVXNlcihjb2RlLCBuZXdQYXNzV29yZCk7XG4gICAqXG4gICAqIEBwYXJhbSBlbWFpbE9yUGhvbmUg6YKu566x5oiW5omL5py65Y+3XG4gICAqIEByZXR1cm5zIFByb21pc2U8UmVzZXRQYXNzd29yZEZvckVtYWlsUmVzPlxuICAgKi9cbiAgYXN5bmMgcmVzZXRQYXNzd29yZEZvckVtYWlsKFxuICAgIGVtYWlsT3JQaG9uZTogc3RyaW5nLFxuICAgIG9wdGlvbnM/OiB7IHJlZGlyZWN0VG8/OiBzdHJpbmcgfSxcbiAgKTogUHJvbWlzZTxSZXNldFBhc3N3b3JkRm9yRW1haWxSZXM+IHtcbiAgICB0cnkge1xuICAgICAgLy8g5Y+C5pWw5qCh6aqM77yaZW1haWxPclBob25l5b+F5aGrXG4gICAgICB0aGlzLnZhbGlkYXRlUGFyYW1zKFxuICAgICAgICB7IGVtYWlsT3JQaG9uZSB9LFxuICAgICAgICB7XG4gICAgICAgICAgZW1haWxPclBob25lOiB7IHJlcXVpcmVkOiB0cnVlLCBtZXNzYWdlOiAnRW1haWwgb3IgcGhvbmUgaXMgcmVxdWlyZWQnIH0sXG4gICAgICAgIH0sXG4gICAgICApXG5cbiAgICAgIGNvbnN0IHsgcmVkaXJlY3RUbyB9ID0gb3B0aW9ucyB8fCB7fVxuXG4gICAgICAvLyDliKTmlq3mmK/pgq7nrrHov5jmmK/miYvmnLrlj7dcbiAgICAgIGNvbnN0IGlzRW1haWwgPSBlbWFpbE9yUGhvbmUuaW5jbHVkZXMoJ0AnKVxuICAgICAgbGV0IHZlcmlmaWNhdGlvblBhcmFtczogeyBlbWFpbD86IHN0cmluZzsgcGhvbmVfbnVtYmVyPzogc3RyaW5nIH1cblxuICAgICAgaWYgKGlzRW1haWwpIHtcbiAgICAgICAgdmVyaWZpY2F0aW9uUGFyYW1zID0geyBlbWFpbDogZW1haWxPclBob25lIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIOato+inhOWMluaJi+acuuWPt1xuICAgICAgICBjb25zdCBmb3JtYXR0ZWRQaG9uZSA9IHRoaXMuZm9ybWF0UGhvbmUoZW1haWxPclBob25lKVxuICAgICAgICB2ZXJpZmljYXRpb25QYXJhbXMgPSB7IHBob25lX251bWJlcjogZm9ybWF0dGVkUGhvbmUgfVxuICAgICAgfVxuXG4gICAgICAvLyDnrKzkuIDmraXvvJrlj5HpgIHpqozor4HnoIHlubblrZjlgqggdmVyaWZpY2F0aW9uSW5mb1xuICAgICAgY29uc3QgdmVyaWZpY2F0aW9uSW5mbyA9IGF3YWl0IHRoaXMuZ2V0VmVyaWZpY2F0aW9uKHZlcmlmaWNhdGlvblBhcmFtcylcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIC8vIOesrOS6jOatpe+8muetieW+heeUqOaIt+i+k+WFpemqjOivgeegge+8iOmAmui/hyBQcm9taXNlIOWMheijheeUqOaIt+i+k+WFpeS6i+S7tu+8iVxuICAgICAgICAgIHVwZGF0ZVVzZXI6IGFzeW5jIChhdHRyaWJ1dGVzOiBVcGRhdGVVc2VyQXR0cmlidXRlcyk6IFByb21pc2U8U2lnbkluUmVzPiA9PiB7XG4gICAgICAgICAgICB0aGlzLnZhbGlkYXRlUGFyYW1zKGF0dHJpYnV0ZXMsIHtcbiAgICAgICAgICAgICAgbm9uY2U6IHsgcmVxdWlyZWQ6IHRydWUsIG1lc3NhZ2U6ICdOb25jZSBpcyByZXF1aXJlZCcgfSxcbiAgICAgICAgICAgICAgcGFzc3dvcmQ6IHsgcmVxdWlyZWQ6IHRydWUsIG1lc3NhZ2U6ICdQYXNzd29yZCBpcyByZXF1aXJlZCcgfSxcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAvLyDnrKzkuInmraXvvJrlvoXnlKjmiLfovpPlhaXlrozpqozor4HnoIHkuYvlkI7vvIzpqozor4Hpqozor4HnoIFcbiAgICAgICAgICAgICAgY29uc3QgdmVyaWZpY2F0aW9uVG9rZW5SZXMgPSBhd2FpdCB0aGlzLnZlcmlmeSh7XG4gICAgICAgICAgICAgICAgdmVyaWZpY2F0aW9uX2lkOiB2ZXJpZmljYXRpb25JbmZvLnZlcmlmaWNhdGlvbl9pZCxcbiAgICAgICAgICAgICAgICB2ZXJpZmljYXRpb25fY29kZTogYXR0cmlidXRlcy5ub25jZSxcbiAgICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgICBhd2FpdCB0aGlzLm9hdXRoSW5zdGFuY2UuYXV0aEFwaS5yZXNldFBhc3N3b3JkKHtcbiAgICAgICAgICAgICAgICBlbWFpbDogaXNFbWFpbCA/IGVtYWlsT3JQaG9uZSA6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICBwaG9uZTogIWlzRW1haWwgPyBlbWFpbE9yUGhvbmUgOiB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgbmV3X3Bhc3N3b3JkOiBhdHRyaWJ1dGVzLnBhc3N3b3JkLFxuICAgICAgICAgICAgICAgIHZlcmlmaWNhdGlvbl90b2tlbjogdmVyaWZpY2F0aW9uVG9rZW5SZXMudmVyaWZpY2F0aW9uX3Rva2VuLFxuICAgICAgICAgICAgICB9KVxuXG4gICAgICAgICAgICAgIHRoaXMuY29uZmlnLmV2ZW50QnVzPy5maXJlKEVWRU5UUy5BVVRIX1NUQVRFX0NIQU5HRUQsIHsgZXZlbnQ6IEFVVEhfU1RBVEVfQ0hBTkdFRF9UWVBFLlBBU1NXT1JEX1JFQ09WRVJZIH0pXG5cbiAgICAgICAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgdGhpcy5zaWduSW5XaXRoUGFzc3dvcmQoe1xuICAgICAgICAgICAgICAgIGVtYWlsOiBpc0VtYWlsID8gZW1haWxPclBob25lIDogdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgIHBob25lOiAhaXNFbWFpbCA/IGVtYWlsT3JQaG9uZSA6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICBwYXNzd29yZDogYXR0cmlidXRlcy5wYXNzd29yZCxcbiAgICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgICBpZiAocmVkaXJlY3RUbyAmJiBpc0Jyb3dzZXIoKSkge1xuICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5hc3NpZ24ocmVkaXJlY3RUbylcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIHJldHVybiByZXNcbiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgIHJldHVybiB7IGRhdGE6IHt9LCBlcnJvcjogbmV3IEF1dGhFcnJvcihlcnJvcikgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIGVycm9yOiBudWxsLFxuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICByZXR1cm4geyBkYXRhOiB7fSwgZXJyb3I6IG5ldyBBdXRoRXJyb3IoZXJyb3IpIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog6YCa6L+H5pen5a+G56CB6YeN572u5a+G56CBXG4gICAqIEBwYXJhbSBuZXdfcGFzc3dvcmRcbiAgICogQHBhcmFtIG9sZF9wYXNzd29yZFxuICAgKiBAcmV0dXJuc1xuICAgKi9cbiAgYXN5bmMgcmVzZXRQYXNzd29yZEZvck9sZChwYXJhbXM6IFJlc2V0UGFzc3dvcmRGb3JPbGRSZXEpIHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgdGhpcy5vYXV0aEluc3RhbmNlLmF1dGhBcGkudXBkYXRlUGFzc3dvcmRCeU9sZCh7XG4gICAgICAgIG9sZF9wYXNzd29yZDogcGFyYW1zLm9sZF9wYXNzd29yZCxcbiAgICAgICAgbmV3X3Bhc3N3b3JkOiBwYXJhbXMubmV3X3Bhc3N3b3JkLFxuICAgICAgfSlcblxuICAgICAgY29uc3QgeyBkYXRhOiB7IHNlc3Npb24gfSA9IHt9IH0gPSBhd2FpdCB0aGlzLmdldFNlc3Npb24oKVxuXG4gICAgICByZXR1cm4geyBkYXRhOiB7IHVzZXI6IHNlc3Npb24udXNlciwgc2Vzc2lvbiB9LCBlcnJvcjogbnVsbCB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHJldHVybiB7IGRhdGE6IHt9LCBlcnJvcjogbmV3IEF1dGhFcnJvcihlcnJvcikgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBodHRwczovL3N1cGFiYXNlLmNvbS9kb2NzL3JlZmVyZW5jZS9qYXZhc2NyaXB0L2F1dGgtdmVyaWZ5b3RwXG4gICAqIExvZyBpbiBhIHVzZXIgZ2l2ZW4gYSBVc2VyIHN1cHBsaWVkIE9UUCBhbmQgdmVyaWZpY2F0aW9uSWQgcmVjZWl2ZWQgdGhyb3VnaCBtb2JpbGUgb3IgZW1haWwuXG4gICAqIGNvbnN0IHZlcmlmaWNhdGlvbkluZm8gPSBhd2FpdCBhcHAuYXV0aC5nZXRWZXJpZmljYXRpb24oe1xuICAgICAgcGhvbmU6IFwieHh4eHh4XCIsXG4gICAgfSk7XG5cbiAgICBjb25zdCBkYXRhID0gYXdhaXQgYXBwLmF1dGgudmVyaWZ5T3RwKHtcbiAgICAgIHR5cGU6IFwic21zXCIsXG4gICAgICBwaG9uZTogXCJ4eHh4eHhcIixcbiAgICAgIHRva2VuOiBcInh4eHh4eFwiLFxuICAgICAgdmVyaWZpY2F0aW9uSW5mbyxcbiAgICB9KVxuICAgKiBAcGFyYW0gcGFyYW1zXG4gICAqIEByZXR1cm5zIFByb21pc2U8U2lnbkluUmVzPlxuICAgKi9cbiAgYXN5bmMgdmVyaWZ5T3RwKHBhcmFtczogVmVyaWZ5T3RwUmVxKTogUHJvbWlzZTxTaWduSW5SZXM+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgeyB0eXBlIH0gPSBwYXJhbXNcbiAgICAgIC8vIOWPguaVsOagoemqjO+8mnRva2Vu5ZKMdmVyaWZpY2F0aW9uSW5mb+W/heWhq1xuICAgICAgdGhpcy52YWxpZGF0ZVBhcmFtcyhwYXJhbXMsIHtcbiAgICAgICAgdG9rZW46IHsgcmVxdWlyZWQ6IHRydWUsIG1lc3NhZ2U6ICdUb2tlbiBpcyByZXF1aXJlZCcgfSxcbiAgICAgICAgbWVzc2FnZUlkOiB7IHJlcXVpcmVkOiB0cnVlLCBtZXNzYWdlOiAnbWVzc2FnZUlkIGlzIHJlcXVpcmVkJyB9LFxuICAgICAgfSlcblxuICAgICAgaWYgKFsncGhvbmVfY2hhbmdlJywgJ2VtYWlsX2NoYW5nZSddLmluY2x1ZGVzKHR5cGUpKSB7XG4gICAgICAgIGF3YWl0IHRoaXMudmVyaWZ5KHtcbiAgICAgICAgICB2ZXJpZmljYXRpb25faWQ6IHBhcmFtcy5tZXNzYWdlSWQsXG4gICAgICAgICAgdmVyaWZpY2F0aW9uX2NvZGU6IHBhcmFtcy50b2tlbixcbiAgICAgICAgfSlcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGF3YWl0IHRoaXMuc2lnbkluV2l0aFVzZXJuYW1lKHtcbiAgICAgICAgICB2ZXJpZmljYXRpb25JbmZvOiB7IHZlcmlmaWNhdGlvbl9pZDogcGFyYW1zLm1lc3NhZ2VJZCwgaXNfdXNlcjogdHJ1ZSB9LFxuICAgICAgICAgIHZlcmlmaWNhdGlvbkNvZGU6IHBhcmFtcy50b2tlbixcbiAgICAgICAgICB1c2VybmFtZTogcGFyYW1zLmVtYWlsIHx8IHRoaXMuZm9ybWF0UGhvbmUocGFyYW1zLnBob25lKSB8fCAnJyxcbiAgICAgICAgICBsb2dpblR5cGU6IHBhcmFtcy5lbWFpbCA/ICdlbWFpbCcgOiAncGhvbmUnLFxuICAgICAgICB9KVxuICAgICAgfVxuXG4gICAgICBjb25zdCB7IGRhdGE6IHsgc2Vzc2lvbiB9ID0ge30gfSA9IGF3YWl0IHRoaXMuZ2V0U2Vzc2lvbigpXG5cbiAgICAgIHJldHVybiB7IGRhdGE6IHsgdXNlcjogc2Vzc2lvbi51c2VyLCBzZXNzaW9uIH0sIGVycm9yOiBudWxsIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgcmV0dXJuIHsgZGF0YToge30sIGVycm9yOiBuZXcgQXV0aEVycm9yKGVycm9yKSB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIGh0dHBzOi8vc3VwYWJhc2UuY29tL2RvY3MvcmVmZXJlbmNlL2phdmFzY3JpcHQvYXV0aC1nZXRTZXNzaW9uXG4gICAqIFJldHVybnMgdGhlIHNlc3Npb24sIHJlZnJlc2hpbmcgaXQgaWYgbmVjZXNzYXJ5LlxuICAgKiBUaGUgc2Vzc2lvbiByZXR1cm5lZCBjYW4gYmUgbnVsbCBpZiB0aGUgc2Vzc2lvbiBpcyBub3QgZGV0ZWN0ZWQgd2hpY2ggY2FuIGhhcHBlbiBpbiB0aGUgZXZlbnQgYSB1c2VyIGlzIG5vdCBzaWduZWQtaW4gb3IgaGFzIGxvZ2dlZCBvdXQuXG4gICAqIGNvbnN0IHsgZGF0YSB9ID0gYXdhaXQgYXBwLmF1dGguZ2V0U2Vzc2lvbigpXG4gICAqIEByZXR1cm5zIFByb21pc2U8U2lnbkluUmVzPlxuICAgKi9cbiAgYXN5bmMgZ2V0U2Vzc2lvbigpOiBQcm9taXNlPFNpZ25JblJlcz4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBjcmVkZW50aWFsczogQ3JlZGVudGlhbHMgPSBhd2FpdCB0aGlzLm9hdXRoSW5zdGFuY2Uub2F1dGgyY2xpZW50LmdldENyZWRlbnRpYWxzKClcblxuICAgICAgaWYgKCFjcmVkZW50aWFscyB8fCBjcmVkZW50aWFscy5zY29wZSA9PT0gJ2FjY2Vzc0tleScpIHtcbiAgICAgICAgcmV0dXJuIHsgZGF0YTogeyBzZXNzaW9uOiBudWxsIH0sIGVycm9yOiBudWxsIH1cbiAgICAgIH1cblxuICAgICAgY29uc3QgeyBkYXRhOiB7IHVzZXIgfSA9IHt9IH0gPSBhd2FpdCB0aGlzLmdldFVzZXIoKVxuXG4gICAgICByZXR1cm4geyBkYXRhOiB7IHNlc3Npb246IHsgLi4uY3JlZGVudGlhbHMsIHVzZXIgfSB9LCBlcnJvcjogbnVsbCB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHJldHVybiB7IGRhdGE6IHt9LCBlcnJvcjogbmV3IEF1dGhFcnJvcihlcnJvcikgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBodHRwczovL3N1cGFiYXNlLmNvbS9kb2NzL3JlZmVyZW5jZS9qYXZhc2NyaXB0L2F1dGgtcmVmcmVzaHNlc3Npb25cbiAgICog5peg6K666L+H5pyf54q25oCB5aaC5L2V77yM6YO96L+U5Zue5LiA5Liq5paw55qE5Lya6K+d44CC5o6l5Y+X5LiA5Liq5Y+v6YCJ55qEcmVmcmVzaF90b2tlbuOAguWmguaenOacquS8oOWFpeW9k+WJjeS8muivne+8jOWImXJlZnJlc2hTZXNzaW9uKCnlsIblsJ3or5Xku45nZXRTZXNzaW9uKCnkuK3mo4DntKLlroPjgILlpoLmnpzlvZPliY3kvJror53nmoTliLfmlrDku6TniYzml6DmlYjvvIzliJnkvJrmipvlh7rkuIDkuKrplJnor6/jgIJcbiAgICogY29uc3QgeyBkYXRhIH0gPSBhd2FpdCBhcHAuYXV0aC5yZWZyZXNoU2Vzc2lvbigpXG4gICAqIEBwYXJhbSByZWZyZXNoX3Rva2VuXG4gICAqIEByZXR1cm5zIFByb21pc2U8U2lnbkluUmVzPlxuICAgKi9cbiAgYXN5bmMgcmVmcmVzaFNlc3Npb24ocmVmcmVzaF90b2tlbj86IHN0cmluZyk6IFByb21pc2U8U2lnbkluUmVzPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGNyZWRlbnRpYWxzOiBDcmVkZW50aWFscyA9IGF3YWl0IHRoaXMub2F1dGhJbnN0YW5jZS5vYXV0aDJjbGllbnQubG9jYWxDcmVkZW50aWFscy5nZXRDcmVkZW50aWFscygpXG4gICAgICBjcmVkZW50aWFscy5yZWZyZXNoX3Rva2VuID0gcmVmcmVzaF90b2tlbiB8fCBjcmVkZW50aWFscy5yZWZyZXNoX3Rva2VuXG4gICAgICBjb25zdCBuZXdUb2tlbnMgPSBhd2FpdCB0aGlzLm9hdXRoSW5zdGFuY2Uub2F1dGgyY2xpZW50LnJlZnJlc2hUb2tlbihjcmVkZW50aWFscylcbiAgICAgIGNvbnN0IHsgZGF0YTogeyB1c2VyIH0gPSB7fSB9ID0gYXdhaXQgdGhpcy5nZXRVc2VyKClcblxuICAgICAgcmV0dXJuIHsgZGF0YTogeyB1c2VyLCBzZXNzaW9uOiB7IC4uLm5ld1Rva2VucywgdXNlciB9IH0sIGVycm9yOiBudWxsIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgcmV0dXJuIHsgZGF0YToge30sIGVycm9yOiBuZXcgQXV0aEVycm9yKGVycm9yKSB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIGh0dHBzOi8vc3VwYWJhc2UuY29tL2RvY3MvcmVmZXJlbmNlL2phdmFzY3JpcHQvYXV0aC1nZXR1c2VyXG4gICAqIOWmguaenOWtmOWcqOeOsOacieS8muivne+8jOWImeiOt+WPluW9k+WJjeeUqOaIt+ivpue7huS/oeaBr+OAguatpOaWueazleS8muWQkeacjeWKoeWZqOWPkei1t+e9kee7nOivt+axgu+8jOWboOatpOi/lOWbnueahOWAvOaYr+ecn+WunueahO+8jOWPr+eUqOS6juWItuWumuaOiOadg+inhOWImeOAglxuICAgKiBjb25zdCB7IGRhdGEgfSA9IGF3YWl0IGFwcC5hdXRoLmdldFVzZXIoKVxuICAgKiBAcmV0dXJucyBQcm9taXNlPEdldFVzZXJSZXM+XG4gICAqL1xuICBhc3luYyBnZXRVc2VyKCk6IFByb21pc2U8R2V0VXNlclJlcz4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB1c2VyID0gdGhpcy5jb252ZXJ0VG9Vc2VyKGF3YWl0IHRoaXMuZ2V0VXNlckluZm8oKSlcbiAgICAgIHJldHVybiB7IGRhdGE6IHsgdXNlciB9LCBlcnJvcjogbnVsbCB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHJldHVybiB7IGRhdGE6IHt9LCBlcnJvcjogbmV3IEF1dGhFcnJvcihlcnJvcikgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDliLfmlrDnlKjmiLfkv6Hmga9cbiAgICogQHJldHVybnMgUHJvbWlzZTxDb21tb25SZXM+XG4gICAqL1xuICBhc3luYyByZWZyZXNoVXNlcigpOiBQcm9taXNlPENvbW1vblJlcz4ge1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCB0aGlzLmN1cnJlbnRVc2VyLnJlZnJlc2goKVxuXG4gICAgICBjb25zdCB7IGRhdGE6IHsgc2Vzc2lvbiB9ID0ge30gfSA9IGF3YWl0IHRoaXMuZ2V0U2Vzc2lvbigpXG4gICAgICByZXR1cm4geyBkYXRhOiB7IHVzZXI6IHNlc3Npb24udXNlciwgc2Vzc2lvbiB9LCBlcnJvcjogbnVsbCB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHJldHVybiB7IGRhdGE6IHt9LCBlcnJvcjogbmV3IEF1dGhFcnJvcihlcnJvcikgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBodHRwczovL3N1cGFiYXNlLmNvbS9kb2NzL3JlZmVyZW5jZS9qYXZhc2NyaXB0L2F1dGgtdXBkYXRldXNlclxuICAgKiDmm7TmlrDnlKjmiLfkv6Hmga9cbiAgICogLSDkuI3mlK/mjIHmm7TmlrDlr4bnoIHvvIzmm7TmlrDlr4bnoIHor7fkvb/nlKggcmVzZXRQYXNzd29yZEZvckVtYWlsIOaIliByZWF1dGhlbnRpY2F0ZVxuICAgKiAtIOWmguaenOabtOaWsCBlbWFpbCDmiJYgcGhvbmXvvIzpnIDopoHlhYjlj5HpgIHpqozor4HnoIHvvIznhLblkI7osIPnlKjov5Tlm57nmoQgdmVyaWZ5T3RwIOWbnuiwg+i/m+ihjOmqjOivgVxuICAgKlxuICAgKiAvLyDmm7TmlrDkuI3pnIDopoHpqozor4HnmoTlrZfmrrVcbiAgICogY29uc3QgeyBkYXRhIH0gPSBhd2FpdCBhcHAuYXV0aC51cGRhdGVVc2VyKHtcbiAgICAgIHVzZXJuYW1lOiBcInh4eFwiLFxuICAgICAgZGVzY3JpcHRpb246IFwieHh4XCIsXG4gICAgICBhdmF0YXJfdXJsOiBcInh4eFwiLFxuICAgICAgbmlja25hbWU6IFwieHh4XCIsXG4gICAgICBnZW5kZXI6ICdNQUxFJ1xuICAgIH0pXG4gICAqXG4gICAqIC8vIOabtOaWsCBlbWFpbCDmiJYgcGhvbmXvvIjpnIDopoHpqozor4HvvIlcbiAgICogY29uc3QgeyBkYXRhIH0gPSBhd2FpdCBhcHAuYXV0aC51cGRhdGVVc2VyKHtcbiAgICAgIGVtYWlsOiBcIm5ld0BleGFtcGxlLmNvbVwiXG4gICAgfSlcbiAgICogLy8g6LCD55SoIHZlcmlmeU90cCDlm57osIPpqozor4FcbiAgICogYXdhaXQgZGF0YS52ZXJpZnlPdHAoeyBlbWFpbDogXCJuZXdAZXhhbXBsZS5jb21cIiwgdG9rZW46IFwiMTIzNDU2XCIgfSlcbiAgICpcbiAgICogQHBhcmFtIHBhcmFtc1xuICAgKiBAcmV0dXJucyBQcm9taXNlPEdldFVzZXJSZXMgfCBVcGRhdGVVc2VyV2l0aFZlcmlmaWNhdGlvblJlcz5cbiAgICovXG4gIGFzeW5jIHVwZGF0ZVVzZXIocGFyYW1zOiBVcGRhdGVVc2VyUmVxKTogUHJvbWlzZTxHZXRVc2VyUmVzIHwgVXBkYXRlVXNlcldpdGhWZXJpZmljYXRpb25SZXM+IHtcbiAgICB0cnkge1xuICAgICAgLy8g5Y+C5pWw5qCh6aqM77ya6Iez5bCR5pyJ5LiA5Liq5pu05paw5a2X5q616KKr5o+Q5L6bXG4gICAgICBjb25zdCBoYXNWYWx1ZSA9IE9iamVjdC5rZXlzKHBhcmFtcykuc29tZShrZXkgPT4gcGFyYW1zW2tleV0gIT09IHVuZGVmaW5lZCAmJiBwYXJhbXNba2V5XSAhPT0gbnVsbCAmJiBwYXJhbXNba2V5XSAhPT0gJycsKVxuICAgICAgaWYgKCFoYXNWYWx1ZSkge1xuICAgICAgICB0aHJvdyBuZXcgQXV0aEVycm9yKHsgbWVzc2FnZTogJ0F0IGxlYXN0IG9uZSBmaWVsZCBtdXN0IGJlIHByb3ZpZGVkIGZvciB1cGRhdGUnIH0pXG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHsgZW1haWwsIHBob25lLCAuLi5yZXN0UGFyYW1zIH0gPSBwYXJhbXNcblxuICAgICAgLy8g5qOA5p+l5piv5ZCm6ZyA6KaB5pu05pawIGVtYWlsIOaIliBwaG9uZVxuICAgICAgY29uc3QgbmVlZHNFbWFpbFZlcmlmaWNhdGlvbiA9IGVtYWlsICE9PSB1bmRlZmluZWRcbiAgICAgIGNvbnN0IG5lZWRzUGhvbmVWZXJpZmljYXRpb24gPSBwaG9uZSAhPT0gdW5kZWZpbmVkXG5cbiAgICAgIGxldCBleHRyYVJlcyA9IHt9XG5cbiAgICAgIGlmIChuZWVkc0VtYWlsVmVyaWZpY2F0aW9uIHx8IG5lZWRzUGhvbmVWZXJpZmljYXRpb24pIHtcbiAgICAgICAgLy8g6ZyA6KaB5Y+R6YCB6aqM6K+B56CBXG4gICAgICAgIGxldCB2ZXJpZmljYXRpb25QYXJhbXM6IHsgZW1haWw/OiBzdHJpbmc7IHBob25lX251bWJlcj86IHN0cmluZyB9XG4gICAgICAgIGxldCB2ZXJpZmljYXRpb25UeXBlOiAnZW1haWxfY2hhbmdlJyB8ICdwaG9uZV9jaGFuZ2UnXG5cbiAgICAgICAgaWYgKG5lZWRzRW1haWxWZXJpZmljYXRpb24pIHtcbiAgICAgICAgICB2ZXJpZmljYXRpb25QYXJhbXMgPSB7IGVtYWlsOiBwYXJhbXMuZW1haWwgfVxuICAgICAgICAgIHZlcmlmaWNhdGlvblR5cGUgPSAnZW1haWxfY2hhbmdlJ1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIOato+inhOWMluaJi+acuuWPt1xuICAgICAgICAgIGNvbnN0IGZvcm1hdHRlZFBob25lID0gdGhpcy5mb3JtYXRQaG9uZShwYXJhbXMucGhvbmUpXG4gICAgICAgICAgdmVyaWZpY2F0aW9uUGFyYW1zID0geyBwaG9uZV9udW1iZXI6IGZvcm1hdHRlZFBob25lIH1cbiAgICAgICAgICB2ZXJpZmljYXRpb25UeXBlID0gJ3Bob25lX2NoYW5nZSdcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIOWPkemAgemqjOivgeeggVxuICAgICAgICBjb25zdCB2ZXJpZmljYXRpb25JbmZvID0gYXdhaXQgdGhpcy5nZXRWZXJpZmljYXRpb24odmVyaWZpY2F0aW9uUGFyYW1zKVxuXG4gICAgICAgIE9iamVjdC5rZXlzKHJlc3RQYXJhbXMpLmxlbmd0aCA+IDAgJiYgYXdhaXQgdGhpcy51cGRhdGVVc2VyQmFzaWNJbmZvKHJlc3RQYXJhbXMpXG5cbiAgICAgICAgZXh0cmFSZXMgPSB7XG4gICAgICAgICAgbWVzc2FnZUlkOiB2ZXJpZmljYXRpb25JbmZvLnZlcmlmaWNhdGlvbl9pZCxcbiAgICAgICAgICB2ZXJpZnlPdHA6IGFzeW5jICh2ZXJpZnlQYXJhbXM6IHsgZW1haWw/OiBzdHJpbmc7IHBob25lPzogc3RyaW5nOyB0b2tlbjogc3RyaW5nIH0pOiBQcm9taXNlPEdldFVzZXJSZXM+ID0+IHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgIGlmICh2ZXJpZnlQYXJhbXMuZW1haWwgJiYgcGFyYW1zLmVtYWlsID09PSB2ZXJpZnlQYXJhbXMuZW1haWwpIHtcbiAgICAgICAgICAgICAgICAvLyDpqozor4HnoIHpqozor4FcbiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnZlcmlmeU90cCh7XG4gICAgICAgICAgICAgICAgICB0eXBlOiAnZW1haWxfY2hhbmdlJyxcbiAgICAgICAgICAgICAgICAgIGVtYWlsOiBwYXJhbXMuZW1haWwsXG4gICAgICAgICAgICAgICAgICB0b2tlbjogdmVyaWZ5UGFyYW1zLnRva2VuLFxuICAgICAgICAgICAgICAgICAgbWVzc2FnZUlkOiB2ZXJpZmljYXRpb25JbmZvLnZlcmlmaWNhdGlvbl9pZCxcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMudXBkYXRlVXNlckJhc2ljSW5mbyh7IGVtYWlsOiBwYXJhbXMuZW1haWwgfSlcbiAgICAgICAgICAgICAgfSBlbHNlIGlmICh2ZXJpZnlQYXJhbXMucGhvbmUgJiYgcGFyYW1zLnBob25lID09PSB2ZXJpZnlQYXJhbXMucGhvbmUpIHtcbiAgICAgICAgICAgICAgICAvLyDpqozor4HnoIHpqozor4FcbiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnZlcmlmeU90cCh7XG4gICAgICAgICAgICAgICAgICB0eXBlOiAncGhvbmVfY2hhbmdlJyxcbiAgICAgICAgICAgICAgICAgIHBob25lOiBwYXJhbXMucGhvbmUsXG4gICAgICAgICAgICAgICAgICB0b2tlbjogdmVyaWZ5UGFyYW1zLnRva2VuLFxuICAgICAgICAgICAgICAgICAgbWVzc2FnZUlkOiB2ZXJpZmljYXRpb25JbmZvLnZlcmlmaWNhdGlvbl9pZCxcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMudXBkYXRlVXNlckJhc2ljSW5mbyh7IHBob25lOiB0aGlzLmZvcm1hdFBob25lKHBhcmFtcy5waG9uZSkgfSlcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnZlcmlmeU90cCh7XG4gICAgICAgICAgICAgICAgICB0eXBlOiB2ZXJpZmljYXRpb25UeXBlLFxuICAgICAgICAgICAgICAgICAgZW1haWw6IG5lZWRzRW1haWxWZXJpZmljYXRpb24gPyBwYXJhbXMuZW1haWwgOiB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICBwaG9uZTogIW5lZWRzRW1haWxWZXJpZmljYXRpb24gPyBwYXJhbXMucGhvbmUgOiB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICB0b2tlbjogdmVyaWZ5UGFyYW1zLnRva2VuLFxuICAgICAgICAgICAgICAgICAgbWVzc2FnZUlkOiB2ZXJpZmljYXRpb25JbmZvLnZlcmlmaWNhdGlvbl9pZCxcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC8vIOmqjOivgeaIkOWKn+WQjuabtOaWsOeUqOaIt+S/oeaBr1xuICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMudXBkYXRlVXNlckJhc2ljSW5mbyhwYXJhbXMpXG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICBjb25zdCB7XG4gICAgICAgICAgICAgICAgZGF0YTogeyB1c2VyIH0sXG4gICAgICAgICAgICAgIH0gPSBhd2FpdCB0aGlzLmdldFVzZXIoKVxuICAgICAgICAgICAgICB0aGlzLmNvbmZpZy5ldmVudEJ1cz8uZmlyZShFVkVOVFMuQVVUSF9TVEFURV9DSEFOR0VELCB7IGV2ZW50OiBBVVRIX1NUQVRFX0NIQU5HRURfVFlQRS5VU0VSX1VQREFURUQgfSlcblxuICAgICAgICAgICAgICByZXR1cm4geyBkYXRhOiB7IHVzZXIgfSwgZXJyb3I6IG51bGwgfVxuICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHsgZGF0YToge30sIGVycm9yOiBuZXcgQXV0aEVycm9yKGVycm9yKSB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8g5LiN6ZyA6KaB6aqM6K+B77yM55u05o6l5pu05pawXG4gICAgICAgIGF3YWl0IHRoaXMudXBkYXRlVXNlckJhc2ljSW5mbyhwYXJhbXMpXG4gICAgICB9XG4gICAgICBjb25zdCB7XG4gICAgICAgIGRhdGE6IHsgdXNlciB9LFxuICAgICAgfSA9IGF3YWl0IHRoaXMuZ2V0VXNlcigpXG4gICAgICB0aGlzLmNvbmZpZy5ldmVudEJ1cz8uZmlyZShFVkVOVFMuQVVUSF9TVEFURV9DSEFOR0VELCB7IGV2ZW50OiBBVVRIX1NUQVRFX0NIQU5HRURfVFlQRS5VU0VSX1VQREFURUQgfSlcblxuICAgICAgcmV0dXJuIHsgZGF0YTogeyB1c2VyLCAuLi5leHRyYVJlcyB9LCBlcnJvcjogbnVsbCB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHJldHVybiB7IGRhdGE6IHt9LCBlcnJvcjogbmV3IEF1dGhFcnJvcihlcnJvcikgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBodHRwczovL3N1cGFiYXNlLmNvbS9kb2NzL3JlZmVyZW5jZS9qYXZhc2NyaXB0L2F1dGgtZ2V0dXNlcmlkZW50aXRpZXNcbiAgICog6I635Y+W5omA5pyJ6Lqr5Lu95rqQXG4gICAqIGNvbnN0IHsgZGF0YSB9ID0gYXdhaXQgYXBwLmF1dGguZ2V0VXNlcklkZW50aXRpZXMoKVxuICAgKiBAcmV0dXJucyBQcm9taXNlPEdldFVzZXJJZGVudGl0aWVzUmVzPlxuICAgKi9cbiAgYXN5bmMgZ2V0VXNlcklkZW50aXRpZXMoKTogUHJvbWlzZTxHZXRVc2VySWRlbnRpdGllc1Jlcz4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBwcm92aWRlcnMgPSBhd2FpdCB0aGlzLm9hdXRoSW5zdGFuY2UuYXV0aEFwaS5nZXRQcm92aWRlcnMoKVxuXG4gICAgICByZXR1cm4geyBkYXRhOiB7IGlkZW50aXRpZXM6IHByb3ZpZGVycz8uZGF0YT8uZmlsdGVyKHYgPT4gISF2LmJpbmQpIH0sIGVycm9yOiBudWxsIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgcmV0dXJuIHsgZGF0YToge30sIGVycm9yOiBuZXcgQXV0aEVycm9yKGVycm9yKSB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIGh0dHBzOi8vc3VwYWJhc2UuY29tL2RvY3MvcmVmZXJlbmNlL2phdmFzY3JpcHQvYXV0aC1saW5raWRlbnRpdHlcbiAgICog57uR5a6a6Lqr5Lu95rqQ5Yiw5b2T5YmN55So5oi377yM5aaC5p6c5bey5pyJ55So5oi357uR5a6a6K+l6Lqr5Lu95rqQ77yM5Lya5oqb5Ye66ZSZ6K+vXG4gICAqIGNvbnN0IHsgZGF0YSB9ID0gYXdhaXQgYXBwLmF1dGgubGlua0lkZW50aXR5KHtcbiAgICAgIHByb3ZpZGVyOiAnc3RyaW5nJ1xuICAgIH0pXG4gICAqIEBwYXJhbSBwYXJhbXNcbiAgICogQHJldHVybnMgUHJvbWlzZTxMaW5rSWRlbnRpdHlSZXM+XG4gICAqL1xuICBhc3luYyBsaW5rSWRlbnRpdHkocGFyYW1zOiBMaW5rSWRlbnRpdHlSZXEpOiBQcm9taXNlPExpbmtJZGVudGl0eVJlcz4ge1xuICAgIHRyeSB7XG4gICAgICAvLyDlj4LmlbDmoKHpqozvvJpwcm92aWRlcuW/heWhq1xuICAgICAgdGhpcy52YWxpZGF0ZVBhcmFtcyhwYXJhbXMsIHtcbiAgICAgICAgcHJvdmlkZXI6IHsgcmVxdWlyZWQ6IHRydWUsIG1lc3NhZ2U6ICdQcm92aWRlciBpcyByZXF1aXJlZCcgfSxcbiAgICAgIH0pXG5cbiAgICAgIGF3YWl0IHRoaXMuc2lnbkluV2l0aE9BdXRoKHtcbiAgICAgICAgcHJvdmlkZXI6IHBhcmFtcy5wcm92aWRlcixcbiAgICAgICAgb3B0aW9uczoge1xuICAgICAgICAgIHR5cGU6IE9BVVRIX1RZUEUuQklORF9JREVOVElUWSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIHJldHVybiB7IGRhdGE6IHsgcHJvdmlkZXI6IHBhcmFtcy5wcm92aWRlciB9LCBlcnJvcjogbnVsbCB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHJldHVybiB7IGRhdGE6IHt9LCBlcnJvcjogbmV3IEF1dGhFcnJvcihlcnJvcikgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBodHRwczovL3N1cGFiYXNlLmNvbS9kb2NzL3JlZmVyZW5jZS9qYXZhc2NyaXB0L2F1dGgtdW5saW5raWRlbnRpdHlcbiAgICog6Kej57uR6Lqr5Lu95rqQXG4gICAqIGNvbnN0IHsgZGF0YSB9ID0gYXdhaXQgYXBwLmF1dGgudW5saW5rSWRlbnRpdHkoe1xuICAgICAgcHJvdmlkZXI6IFwieHh4XCJcbiAgICB9KVxuICAgKiBAcGFyYW0gcGFyYW1zXG4gICAqIEByZXR1cm5zIFByb21pc2U8Q29tbW9uUmVzPlxuICAgKi9cbiAgYXN5bmMgdW5saW5rSWRlbnRpdHkocGFyYW1zOiBVbmxpbmtJZGVudGl0eVJlcSk6IFByb21pc2U8Q29tbW9uUmVzPiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIOWPguaVsOagoemqjO+8mnByb3ZpZGVy5b+F5aGrXG4gICAgICB0aGlzLnZhbGlkYXRlUGFyYW1zKHBhcmFtcywge1xuICAgICAgICBwcm92aWRlcjogeyByZXF1aXJlZDogdHJ1ZSwgbWVzc2FnZTogJ1Byb3ZpZGVyIGlzIHJlcXVpcmVkJyB9LFxuICAgICAgfSlcblxuICAgICAgYXdhaXQgdGhpcy5vYXV0aEluc3RhbmNlLmF1dGhBcGkudW5iaW5kUHJvdmlkZXIoeyBwcm92aWRlcl9pZDogcGFyYW1zLnByb3ZpZGVyIH0pXG5cbiAgICAgIHJldHVybiB7IGRhdGE6IHt9LCBlcnJvcjogbnVsbCB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHJldHVybiB7IGRhdGE6IHt9LCBlcnJvcjogbmV3IEF1dGhFcnJvcihlcnJvcikgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBodHRwczovL3N1cGFiYXNlLmNvbS9kb2NzL3JlZmVyZW5jZS9qYXZhc2NyaXB0L2F1dGgtcmVhdXRoZW50aWNhdGlvblxuICAgKiDph43mlrDorqTor4HjgILpgJrov4flj5HpgIHpqozor4HnoIHmnaXph43mlrDorqTor4HnlKjmiLfouqvku73vvIzmlK/mjIHmm7TmlrDlr4bnoIFcbiAgICogY29uc3QgeyBkYXRhIH0gPSBhd2FpdCBhcHAuYXV0aC5yZWF1dGhlbnRpY2F0ZSgpXG5cbiAgICAgYXdhaXQgZGF0YS51cGRhdGVVc2VyKGNvZGUsIG5ld1Bhc3NXb3JkKVxuICAgKlxuICAgKiBAcmV0dXJucyBQcm9taXNlPFJlYXV0aGVudGljYXRlUmVzPlxuICAgKi9cbiAgYXN5bmMgcmVhdXRoZW50aWNhdGUoKTogUHJvbWlzZTxSZWF1dGhlbnRpY2F0ZVJlcz4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB7XG4gICAgICAgIGRhdGE6IHsgdXNlciB9LFxuICAgICAgfSA9IGF3YWl0IHRoaXMuZ2V0VXNlcigpXG5cbiAgICAgIHRoaXMudmFsaWRhdGVBdExlYXN0T25lKHVzZXIsIFtbJ2VtYWlsJywgJ3Bob25lJ11dLCAnWW91IG11c3QgcHJvdmlkZSBlaXRoZXIgYW4gZW1haWwgb3IgcGhvbmUgbnVtYmVyJylcbiAgICAgIGNvbnN0IHVzZXJJbmZvID0gdXNlci5lbWFpbCA/IHsgZW1haWw6IHVzZXIuZW1haWwgfSA6IHsgcGhvbmVfbnVtYmVyOiB0aGlzLmZvcm1hdFBob25lKHVzZXIucGhvbmUpIH1cblxuICAgICAgLy8g56ys5LiA5q2l77ya5Y+R6YCB6aqM6K+B56CB5bm25a2Y5YKoIHZlcmlmaWNhdGlvbkluZm9cbiAgICAgIGNvbnN0IHZlcmlmaWNhdGlvbkluZm8gPSBhd2FpdCB0aGlzLmdldFZlcmlmaWNhdGlvbih1c2VySW5mbylcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIC8vIOesrOS6jOatpe+8muetieW+heeUqOaIt+i+k+WFpemqjOivgeegge+8iOmAmui/hyBQcm9taXNlIOWMheijheeUqOaIt+i+k+WFpeS6i+S7tu+8iVxuICAgICAgICAgIHVwZGF0ZVVzZXI6IGFzeW5jIChhdHRyaWJ1dGVzOiBVcGRhdGVVc2VyQXR0cmlidXRlcyk6IFByb21pc2U8U2lnbkluUmVzPiA9PiB7XG4gICAgICAgICAgICB0aGlzLnZhbGlkYXRlUGFyYW1zKGF0dHJpYnV0ZXMsIHtcbiAgICAgICAgICAgICAgbm9uY2U6IHsgcmVxdWlyZWQ6IHRydWUsIG1lc3NhZ2U6ICdOb25jZSBpcyByZXF1aXJlZCcgfSxcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICBpZiAoYXR0cmlidXRlcy5wYXNzd29yZCkge1xuICAgICAgICAgICAgICAgIC8vIOesrOS4ieatpe+8muW+heeUqOaIt+i+k+WFpeWujOmqjOivgeeggeS5i+WQju+8jOmqjOivgemqjOivgeeggVxuICAgICAgICAgICAgICAgIGNvbnN0IHZlcmlmaWNhdGlvblRva2VuUmVzID0gYXdhaXQgdGhpcy52ZXJpZnkoe1xuICAgICAgICAgICAgICAgICAgdmVyaWZpY2F0aW9uX2lkOiB2ZXJpZmljYXRpb25JbmZvLnZlcmlmaWNhdGlvbl9pZCxcbiAgICAgICAgICAgICAgICAgIHZlcmlmaWNhdGlvbl9jb2RlOiBhdHRyaWJ1dGVzLm5vbmNlLFxuICAgICAgICAgICAgICAgIH0pXG5cbiAgICAgICAgICAgICAgICAvLyDnrKzlm5vmraXvvJrojrflj5Ygc3Vkb190b2tlblxuICAgICAgICAgICAgICAgIGNvbnN0IHN1ZG9SZXMgPSBhd2FpdCB0aGlzLm9hdXRoSW5zdGFuY2UuYXV0aEFwaS5zdWRvKHtcbiAgICAgICAgICAgICAgICAgIHZlcmlmaWNhdGlvbl90b2tlbjogdmVyaWZpY2F0aW9uVG9rZW5SZXMudmVyaWZpY2F0aW9uX3Rva2VuLFxuICAgICAgICAgICAgICAgIH0pXG5cbiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLm9hdXRoSW5zdGFuY2UuYXV0aEFwaS5zZXRQYXNzd29yZCh7XG4gICAgICAgICAgICAgICAgICBuZXdfcGFzc3dvcmQ6IGF0dHJpYnV0ZXMucGFzc3dvcmQsXG4gICAgICAgICAgICAgICAgICBzdWRvX3Rva2VuOiBzdWRvUmVzLnN1ZG9fdG9rZW4sXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnNpZ25JbldpdGhVc2VybmFtZSh7XG4gICAgICAgICAgICAgICAgICB2ZXJpZmljYXRpb25JbmZvLFxuICAgICAgICAgICAgICAgICAgdmVyaWZpY2F0aW9uQ29kZTogYXR0cmlidXRlcy5ub25jZSxcbiAgICAgICAgICAgICAgICAgIC4uLnVzZXJJbmZvLFxuICAgICAgICAgICAgICAgICAgbG9naW5UeXBlOiB1c2VySW5mby5lbWFpbCA/ICdlbWFpbCcgOiAncGhvbmUnLFxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICBjb25zdCB7IGRhdGE6IHsgc2Vzc2lvbiB9ID0ge30gfSA9IGF3YWl0IHRoaXMuZ2V0U2Vzc2lvbigpXG5cbiAgICAgICAgICAgICAgcmV0dXJuIHsgZGF0YTogeyB1c2VyOiBzZXNzaW9uLnVzZXIsIHNlc3Npb24gfSwgZXJyb3I6IG51bGwgfVxuICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHsgZGF0YToge30sIGVycm9yOiBuZXcgQXV0aEVycm9yKGVycm9yKSB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAgZXJyb3I6IG51bGwsXG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHJldHVybiB7IGRhdGE6IHt9LCBlcnJvcjogbmV3IEF1dGhFcnJvcihlcnJvcikgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBodHRwczovL3N1cGFiYXNlLmNvbS9kb2NzL3JlZmVyZW5jZS9qYXZhc2NyaXB0L2F1dGgtcmVzZW5kXG4gICAqIOmHjeaWsOWPkemAgemqjOivgeeggVxuICAgKiAtIOWQkeeUqOaIt+mHjeaWsOWPkemAgemCrueuseOAgeaJi+acuuWPt+azqOWGjOaIlueZu+W9leeahOmqjOivgeeggeOAglxuICAgKiAtIOWPr+S7pemAmui/h+WGjeasoeiwg+eUqCBzaWduSW5XaXRoT3RwKCkg5pa55rOV5p2l6YeN5paw5Y+R6YCB6aqM6K+B56CB55m75b2V44CCXG4gICAqIC0g5Y+v5Lul6YCa6L+H5YaN5qyh6LCD55SoIHNpZ25VcCgpIOaWueazleadpemHjeaWsOWPkemAgemqjOivgeeggeazqOWGjOOAglxuICAgKiAtIOatpOaWueazleS7heWcqOiwg+eUqCBzaWduSW5XaXRoT3RwKCkg5oiWIHNpZ25VcCgpIOWQju+8jOmHjeaWsOWPkemAgemqjOivgeegge+8jOaUtuWIsOmqjOivgeeggeWQjuWGjee7p+e7reiwg+eUqCBzaWduSW5XaXRoT3RwKCkg5oiWIHNpZ25VcCgpIOeahGNhbGxiYWNr5Y+C5pWw77yM5bCGbWVzc2FnZUlk5Lyg5YWlY2FsbGJhY2vjgIJcbiAgICogY29uc3QgcmVzdWx0ID0gYXdhaXQgYXBwLmF1dGguc2lnbkluV2l0aE90cCh7IHBob25lOiBcInh4eFwiIH0pO1xuXG4gICAgbGV0IHNpZ25SZXNvbHZlID0gcmVzdWx0LmRhdGEudmVyaWZ5XG5cbiAgICBjb25zdCB7IGRhdGEgfSA9IGF3YWl0IGFwcC5hdXRoLnJlc2VuZCh7XG4gICAgICB0eXBlOiBcInNpZ251cFwiLFxuICAgICAgcGhvbmU6IFwieHh4XCIsXG4gICAgfSlcblxuICAgIGNvbnN0IHJlcyA9IGF3YWl0IHNpZ25SZXNvbHZlKGNvZGUsIGRhdGEubWVzc2FnZUlkKTtcbiAgICogQHBhcmFtIHBhcmFtc1xuICAgKiBAcmV0dXJucyBQcm9taXNlPFJlc2VuZFJlcz5cbiAgICovXG4gIGFzeW5jIHJlc2VuZChwYXJhbXM6IFJlc2VuZFJlcSk6IFByb21pc2U8UmVzZW5kUmVzPiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIOWPguaVsOagoemqjO+8mmVtYWls5oiWcGhvbmXlv4XloavlhbbkuIBcbiAgICAgIHRoaXMudmFsaWRhdGVBdExlYXN0T25lKHBhcmFtcywgW1snZW1haWwnXSwgWydwaG9uZSddXSwgJ1lvdSBtdXN0IHByb3ZpZGUgZWl0aGVyIGFuIGVtYWlsIG9yIHBob25lIG51bWJlcicpXG5cbiAgICAgIGNvbnN0IHRhcmdldCA9IHBhcmFtcy50eXBlID09PSAnc2lnbnVwJyA/ICdBTlknIDogJ1VTRVInXG4gICAgICBjb25zdCBkYXRhOiB7IGVtYWlsPzogc3RyaW5nOyBwaG9uZV9udW1iZXI/OiBzdHJpbmc7IHRhcmdldDogJ1VTRVInIHwgJ0FOWScgfSA9IHsgdGFyZ2V0IH1cbiAgICAgIGlmICgnZW1haWwnIGluIHBhcmFtcykge1xuICAgICAgICBkYXRhLmVtYWlsID0gcGFyYW1zLmVtYWlsXG4gICAgICB9XG5cbiAgICAgIGlmICgncGhvbmUnIGluIHBhcmFtcykge1xuICAgICAgICBkYXRhLnBob25lX251bWJlciA9IHRoaXMuZm9ybWF0UGhvbmUocGFyYW1zLnBob25lKVxuICAgICAgfVxuXG4gICAgICAvLyDph43mlrDlj5HpgIHpqozor4HnoIFcbiAgICAgIGNvbnN0IHsgdmVyaWZpY2F0aW9uX2lkOiB2ZXJpZmljYXRpb25JZCB9ID0gYXdhaXQgdGhpcy5vYXV0aEluc3RhbmNlLmF1dGhBcGkuZ2V0VmVyaWZpY2F0aW9uKGRhdGEpXG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIGRhdGE6IHsgbWVzc2FnZUlkOiB2ZXJpZmljYXRpb25JZCB9LFxuICAgICAgICBlcnJvcjogbnVsbCxcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBkYXRhOiB7fSxcbiAgICAgICAgZXJyb3I6IG5ldyBBdXRoRXJyb3IoZXJyb3IpLFxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBodHRwczovL3N1cGFiYXNlLmNvbS9kb2NzL3JlZmVyZW5jZS9qYXZhc2NyaXB0L2F1dGgtc2V0c2Vzc2lvblxuICAgKiDkvb/nlKhhY2Nlc3NfdG9rZW7lkoxyZWZyZXNoX3Rva2Vu5p2l6K6+572u5Lya6K+dXG4gICAqIOWmguaenOaIkOWKn++8jOWImeS8muinpuWPkeS4gOS4qlNJR05FRF9JTuS6i+S7tlxuICAgKiBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBhcHAuYXV0aC5zZXRTZXNzaW9uKHtcbiAgICAgIGFjY2Vzc190b2tlbixcbiAgICAgIHJlZnJlc2hfdG9rZW5cbiAgICB9KVxuICAgKiBAcGFyYW0gcGFyYW1zXG4gICAqIEByZXR1cm5zIFByb21pc2U8U2lnbkluUmVzPlxuICAgKi9cbiAgYXN5bmMgc2V0U2Vzc2lvbihwYXJhbXM6IFNldFNlc3Npb25SZXEpOiBQcm9taXNlPFNpZ25JblJlcz4ge1xuICAgIHRyeSB7XG4gICAgICB0aGlzLnZhbGlkYXRlUGFyYW1zKHBhcmFtcywge1xuICAgICAgICBhY2Nlc3NfdG9rZW46IHsgcmVxdWlyZWQ6IHRydWUsIG1lc3NhZ2U6ICdBY2Nlc3MgdG9rZW4gaXMgcmVxdWlyZWQnIH0sXG4gICAgICAgIHJlZnJlc2hfdG9rZW46IHsgcmVxdWlyZWQ6IHRydWUsIG1lc3NhZ2U6ICdSZWZyZXNoIHRva2VuIGlzIHJlcXVpcmVkJyB9LFxuICAgICAgfSlcblxuICAgICAgYXdhaXQgdGhpcy5vYXV0aEluc3RhbmNlLm9hdXRoMmNsaWVudC5yZWZyZXNoVG9rZW4ocGFyYW1zLCB7IHRocm93T25FcnJvcjogdHJ1ZSB9KVxuXG4gICAgICBjb25zdCB7IGRhdGE6IHsgc2Vzc2lvbiB9ID0ge30gfSA9IGF3YWl0IHRoaXMuZ2V0U2Vzc2lvbigpXG5cbiAgICAgIHRoaXMuY29uZmlnLmV2ZW50QnVzPy5maXJlKEVWRU5UUy5BVVRIX1NUQVRFX0NIQU5HRUQsIHsgZXZlbnQ6IEFVVEhfU1RBVEVfQ0hBTkdFRF9UWVBFLlNJR05FRF9JTiB9KVxuXG4gICAgICByZXR1cm4geyBkYXRhOiB7IHVzZXI6IHNlc3Npb24udXNlciwgc2Vzc2lvbiB9LCBlcnJvcjogbnVsbCB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHJldHVybiB7IGRhdGE6IHt9LCBlcnJvcjogbmV3IEF1dGhFcnJvcihlcnJvcikgfVxuICAgIH1cbiAgfVxuXG4gIC8vIGh0dHBzOi8vc3VwYWJhc2UuY29tL2RvY3MvcmVmZXJlbmNlL2phdmFzY3JpcHQvYXV0aC1leGNoYW5nZWNvZGVmb3JzZXNzaW9uXG4gIGFzeW5jIGV4Y2hhbmdlQ29kZUZvclNlc3Npb24oKSB7XG4gICAgLy9cbiAgfVxuXG4gIC8qKlxuICAgKiDliKDpmaTlvZPliY3nlKjmiLdcbiAgICogQHBhcmFtIHBhcmFtc1xuICAgKiBAcmV0dXJuc1xuICAgKi9cbiAgYXN5bmMgZGVsZXRlVXNlcihwYXJhbXM6IERlbGV0ZU1lUmVxKTogUHJvbWlzZTxDb21tb25SZXM+IHtcbiAgICB0cnkge1xuICAgICAgdGhpcy52YWxpZGF0ZVBhcmFtcyhwYXJhbXMsIHtcbiAgICAgICAgcGFzc3dvcmQ6IHsgcmVxdWlyZWQ6IHRydWUsIG1lc3NhZ2U6ICdQYXNzd29yZCBpcyByZXF1aXJlZCcgfSxcbiAgICAgIH0pXG5cbiAgICAgIGNvbnN0IHsgc3Vkb190b2tlbiB9ID0gYXdhaXQgdGhpcy5vYXV0aEluc3RhbmNlLmF1dGhBcGkuc3VkbyhwYXJhbXMpXG5cbiAgICAgIGF3YWl0IHRoaXMub2F1dGhJbnN0YW5jZS5hdXRoQXBpLmRlbGV0ZU1lKHsgc3Vkb190b2tlbiB9KVxuXG4gICAgICByZXR1cm4geyBkYXRhOiB7fSwgZXJyb3I6IG51bGwgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICByZXR1cm4geyBkYXRhOiB7fSwgZXJyb3I6IG5ldyBBdXRoRXJyb3IoZXJyb3IpIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog6Lez6L2s57O757uf6buY6K6k55m75b2V6aG1XG4gICAqIEByZXR1cm5zIHtQcm9taXNlPGF1dGhNb2RlbHMuVG9EZWZhdWx0TG9naW5QYWdlPn1cbiAgICogQG1lbWJlcm9mIEF1dGhcbiAgICovXG4gIGFzeW5jIHRvRGVmYXVsdExvZ2luUGFnZShwYXJhbXM6IGF1dGhNb2RlbHMuVG9EZWZhdWx0TG9naW5QYWdlID0ge30pOiBQcm9taXNlPENvbW1vblJlcz4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBjb25maWdWZXJzaW9uID0gcGFyYW1zLmNvbmZpZ192ZXJzaW9uIHx8ICdlbnYnXG4gICAgICBjb25zdCBxdWVyeSA9IE9iamVjdC5rZXlzKHBhcmFtcy5xdWVyeSB8fCB7fSlcbiAgICAgICAgLm1hcChrZXkgPT4gYCR7a2V5fT0ke3BhcmFtcy5xdWVyeVtrZXldfWApXG4gICAgICAgIC5qb2luKCcmJylcblxuICAgICAgaWYgKGFkYXB0ZXJGb3JXeE1wLmlzTWF0Y2goKSkge1xuICAgICAgICB3eC5uYXZpZ2F0ZVRvKHsgdXJsOiBgL3BhY2thZ2VzLyR3ZF9zeXN0ZW0vcGFnZXMvbG9naW4vaW5kZXgke3F1ZXJ5ID8gYD8ke3F1ZXJ5fWAgOiAnJ31gIH0pXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCByZWRpcmVjdFVyaSA9IHBhcmFtcy5yZWRpcmVjdF91cmkgfHwgd2luZG93LmxvY2F0aW9uLmhyZWZcbiAgICAgICAgY29uc3QgdXJsT2JqID0gbmV3IFVSTChyZWRpcmVjdFVyaSlcbiAgICAgICAgY29uc3QgbG9naW5QYWdlID0gYCR7dXJsT2JqLm9yaWdpbn0vX19hdXRoLz9hcHBfaWQ9JHtwYXJhbXMuYXBwX2lkIHx8ICcnfSZlbnZfaWQ9JHt0aGlzLmNvbmZpZy5lbnZ9JmNsaWVudF9pZD0ke1xuICAgICAgICAgIHRoaXMuY29uZmlnLmNsaWVudElkIHx8IHRoaXMuY29uZmlnLmVudlxuICAgICAgICB9JmNvbmZpZ192ZXJzaW9uPSR7Y29uZmlnVmVyc2lvbn0mcmVkaXJlY3RfdXJpPSR7ZW5jb2RlVVJJQ29tcG9uZW50KHJlZGlyZWN0VXJpKX0ke3F1ZXJ5ID8gYCYke3F1ZXJ5fWAgOiAnJ31gXG4gICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gbG9naW5QYWdlXG4gICAgICB9XG4gICAgICByZXR1cm4geyBkYXRhOiB7fSwgZXJyb3I6IG51bGwgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICByZXR1cm4geyBkYXRhOiB7fSwgZXJyb3I6IG5ldyBBdXRoRXJyb3IoZXJyb3IpIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog6Ieq5a6a5LmJ55m75b2VXG4gICAqIEBwYXJhbSBnZXRUaWNrRm4gKCkgPT4gUHJvbWlzZTxzdHJpbmc+LCDojrflj5boh6rlrprkuYnnmbvlvZUgdGlja2V0IOeahOWHveaVsFxuICAgKiBAcmV0dXJuc1xuICAgKi9cbiAgYXN5bmMgc2lnbkluV2l0aEN1c3RvbVRpY2tldChnZXRUaWNrRm4/OiBhdXRoTW9kZWxzLkdldEN1c3RvbVNpZ25UaWNrZXRGbik6IFByb21pc2U8U2lnbkluUmVzPiB7XG4gICAgaWYgKGdldFRpY2tGbikge1xuICAgICAgdGhpcy5zZXRDdXN0b21TaWduRnVuYyhnZXRUaWNrRm4pXG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHRoaXMub2F1dGhJbnN0YW5jZS5hdXRoQXBpLnNpZ25JbldpdGhDdXN0b21UaWNrZXQoKVxuICAgICAgY29uc3QgbG9naW5TdGF0ZSA9IGF3YWl0IHRoaXMuY3JlYXRlTG9naW5TdGF0ZSgpXG5cbiAgICAgIGNvbnN0IHsgZGF0YTogeyBzZXNzaW9uIH0gPSB7fSB9ID0gYXdhaXQgdGhpcy5nZXRTZXNzaW9uKClcblxuICAgICAgLy8gbG9naW5TdGF0Zei/lOWbnuaYr+S4uuS6huWFvOWuuXYy54mI5pysXG4gICAgICByZXR1cm4geyAuLi4obG9naW5TdGF0ZSBhcyBhbnkpLCBkYXRhOiB7IHVzZXI6IHNlc3Npb24udXNlciwgc2Vzc2lvbiB9LCBlcnJvcjogbnVsbCB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHJldHVybiB7IGRhdGE6IHt9LCBlcnJvcjogbmV3IEF1dGhFcnJvcihlcnJvcikgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDlsI/nqIvluo9vcGVuSWTpnZnpu5jnmbvlvZVcbiAgICogQHBhcmFtIHBhcmFtc1xuICAgKiBAcmV0dXJucyBQcm9taXNlPFNpZ25JblJlcz5cbiAgICovXG4gIGFzeW5jIHNpZ25JbldpdGhPcGVuSWQoeyB1c2VXeENsb3VkID0gdHJ1ZSB9ID0ge30pOiBQcm9taXNlPFNpZ25JblJlcz4ge1xuICAgIGlmICghYWRhcHRlckZvcld4TXAuaXNNYXRjaCgpKSB7XG4gICAgICB0aHJvdyBFcnJvcignd3ggYXBpIHVuZGVmaW5lZCcpXG4gICAgfVxuICAgIGNvbnN0IHd4SW5mbyA9IHd4LmdldEFjY291bnRJbmZvU3luYygpLm1pbmlQcm9ncmFtXG5cbiAgICBjb25zdCBtYWluRnVuYyA9IGFzeW5jIChjb2RlKSA9PiB7XG4gICAgICBsZXQgcmVzdWx0OiBhdXRoTW9kZWxzLkdyYW50UHJvdmlkZXJUb2tlblJlc3BvbnNlIHwgdW5kZWZpbmVkID0gdW5kZWZpbmVkXG4gICAgICBsZXQgY3JlZGVudGlhbHM6IENyZWRlbnRpYWxzIHwgdW5kZWZpbmVkID0gdW5kZWZpbmVkXG5cbiAgICAgIHRyeSB7XG4gICAgICAgIHJlc3VsdCA9IGF3YWl0IHRoaXMub2F1dGhJbnN0YW5jZS5hdXRoQXBpLmdyYW50UHJvdmlkZXJUb2tlbihcbiAgICAgICAgICB7XG4gICAgICAgICAgICBwcm92aWRlcl9pZDogd3hJbmZvPy5hcHBJZCxcbiAgICAgICAgICAgIHByb3ZpZGVyX2NvZGU6IGNvZGUsXG4gICAgICAgICAgICBwcm92aWRlcl9wYXJhbXM6IHtcbiAgICAgICAgICAgICAgcHJvdmlkZXJfY29kZV90eXBlOiAnb3Blbl9pZCcsXG4gICAgICAgICAgICAgIGFwcGlkOiB3eEluZm8/LmFwcElkLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHVzZVd4Q2xvdWQsXG4gICAgICAgIClcblxuICAgICAgICBpZiAoKHJlc3VsdCBhcyBhbnkpPy5lcnJvcl9jb2RlIHx8ICFyZXN1bHQucHJvdmlkZXJfdG9rZW4pIHtcbiAgICAgICAgICB0aHJvdyByZXN1bHRcbiAgICAgICAgfVxuXG4gICAgICAgIGNyZWRlbnRpYWxzID0gYXdhaXQgdGhpcy5vYXV0aEluc3RhbmNlLmF1dGhBcGkuc2lnbkluV2l0aFByb3ZpZGVyKFxuICAgICAgICAgIHsgcHJvdmlkZXJfdG9rZW46IHJlc3VsdC5wcm92aWRlcl90b2tlbiB9LFxuICAgICAgICAgIHVzZVd4Q2xvdWQsXG4gICAgICAgIClcblxuICAgICAgICBpZiAoKGNyZWRlbnRpYWxzIGFzIGFueSk/LmVycm9yX2NvZGUpIHtcbiAgICAgICAgICB0aHJvdyBjcmVkZW50aWFsc1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICB0aHJvdyBlcnJvclxuICAgICAgfVxuICAgICAgYXdhaXQgdGhpcy5vYXV0aEluc3RhbmNlLm9hdXRoMmNsaWVudC5zZXRDcmVkZW50aWFscyhjcmVkZW50aWFscyBhcyBDcmVkZW50aWFscylcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgYXdhaXQgbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICB3eC5sb2dpbih7XG4gICAgICAgICAgc3VjY2VzczogYXN5bmMgKHJlczogeyBjb2RlOiBzdHJpbmcgfSkgPT4ge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgYXdhaXQgbWFpbkZ1bmMocmVzLmNvZGUpXG4gICAgICAgICAgICAgIHJlc29sdmUodHJ1ZSlcbiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgIHJlamVjdChlcnJvcilcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIGZhaWw6IChyZXM6IGFueSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZXJyb3IgPSBuZXcgRXJyb3IocmVzPy5lcnJNc2cpXG4gICAgICAgICAgICA7KGVycm9yIGFzIGFueSkuY29kZSA9IHJlcz8uZXJybm9cbiAgICAgICAgICAgIHJlamVjdChlcnJvcilcbiAgICAgICAgICB9LFxuICAgICAgICB9KVxuICAgICAgfSlcblxuICAgICAgY29uc3QgbG9naW5TdGF0ZSA9IGF3YWl0IHRoaXMuY3JlYXRlTG9naW5TdGF0ZSgpXG5cbiAgICAgIGNvbnN0IHsgZGF0YTogeyBzZXNzaW9uIH0gPSB7fSB9ID0gYXdhaXQgdGhpcy5nZXRTZXNzaW9uKClcblxuICAgICAgLy8gbG9naW5TdGF0Zei/lOWbnuaYr+S4uuS6huWFvOWuuXYy54mI5pysXG4gICAgICByZXR1cm4geyAuLi4obG9naW5TdGF0ZSBhcyBhbnkpLCBkYXRhOiB7IHVzZXI6IHNlc3Npb24udXNlciwgc2Vzc2lvbiB9LCBlcnJvcjogbnVsbCB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHJldHVybiB7IGRhdGE6IHt9LCBlcnJvcjogbmV3IEF1dGhFcnJvcihlcnJvcikgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDlsI/nqIvluo/miYvmnLrlj7fmjojmnYPnmbvlvZXvvIznm67liY3lj6rmlK/mjIHlhajmiZjnrqHmiYvmnLrlj7fmjojmnYPnmbvlvZVcbiAgICogQHBhcmFtIHBhcmFtc1xuICAgKiBAcmV0dXJucyBQcm9taXNlPFNpZ25JblJlcz5cbiAgICovXG4gIGFzeW5jIHNpZ25JbldpdGhQaG9uZUF1dGgoeyBwaG9uZUNvZGUgPSAnJyB9KTogUHJvbWlzZTxTaWduSW5SZXM+IHtcbiAgICBpZiAoIWFkYXB0ZXJGb3JXeE1wLmlzTWF0Y2goKSkge1xuICAgICAgcmV0dXJuIHsgZGF0YToge30sIGVycm9yOiBuZXcgQXV0aEVycm9yKHsgbWVzc2FnZTogJ3d4IGFwaSB1bmRlZmluZWQnIH0pIH1cbiAgICB9XG4gICAgY29uc3Qgd3hJbmZvID0gd3guZ2V0QWNjb3VudEluZm9TeW5jKCkubWluaVByb2dyYW1cbiAgICBjb25zdCBwcm92aWRlckluZm8gPSB7XG4gICAgICBwcm92aWRlcl9wYXJhbXM6IHsgcHJvdmlkZXJfY29kZV90eXBlOiAncGhvbmUnIH0sXG4gICAgICBwcm92aWRlcl9pZDogd3hJbmZvLmFwcElkLFxuICAgIH1cblxuICAgIGNvbnN0IHsgY29kZSB9ID0gYXdhaXQgd3gubG9naW4oKVxuICAgIDsocHJvdmlkZXJJbmZvIGFzIGFueSkucHJvdmlkZXJfY29kZSA9IGNvZGVcblxuICAgIHRyeSB7XG4gICAgICBsZXQgcHJvdmlkZXJUb2tlbiA9IGF3YWl0IHRoaXMub2F1dGhJbnN0YW5jZS5hdXRoQXBpLmdyYW50UHJvdmlkZXJUb2tlbihwcm92aWRlckluZm8pXG4gICAgICBpZiAocHJvdmlkZXJUb2tlbi5lcnJvcl9jb2RlKSB7XG4gICAgICAgIHRocm93IHByb3ZpZGVyVG9rZW5cbiAgICAgIH1cblxuICAgICAgcHJvdmlkZXJUb2tlbiA9IGF3YWl0IHRoaXMub2F1dGhJbnN0YW5jZS5hdXRoQXBpLnBhdGNoUHJvdmlkZXJUb2tlbih7XG4gICAgICAgIHByb3ZpZGVyX3Rva2VuOiBwcm92aWRlclRva2VuLnByb3ZpZGVyX3Rva2VuLFxuICAgICAgICBwcm92aWRlcl9pZDogd3hJbmZvLmFwcElkLFxuICAgICAgICBwcm92aWRlcl9wYXJhbXM6IHtcbiAgICAgICAgICBjb2RlOiBwaG9uZUNvZGUsXG4gICAgICAgICAgcHJvdmlkZXJfY29kZV90eXBlOiAncGhvbmUnLFxuICAgICAgICB9LFxuICAgICAgfSlcbiAgICAgIGlmIChwcm92aWRlclRva2VuLmVycm9yX2NvZGUpIHtcbiAgICAgICAgdGhyb3cgcHJvdmlkZXJUb2tlblxuICAgICAgfVxuXG4gICAgICBjb25zdCBzaWduSW5SZXMgPSBhd2FpdCB0aGlzLm9hdXRoSW5zdGFuY2UuYXV0aEFwaS5zaWduSW5XaXRoUHJvdmlkZXIoe1xuICAgICAgICBwcm92aWRlcl90b2tlbjogcHJvdmlkZXJUb2tlbi5wcm92aWRlcl90b2tlbixcbiAgICAgIH0pXG5cbiAgICAgIGlmICgoc2lnbkluUmVzIGFzIGFueSk/LmVycm9yX2NvZGUpIHtcbiAgICAgICAgdGhyb3cgc2lnbkluUmVzXG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHJldHVybiB7IGRhdGE6IHt9LCBlcnJvcjogbmV3IEF1dGhFcnJvcihlcnJvcikgfVxuICAgIH1cblxuICAgIGNvbnN0IGxvZ2luU3RhdGUgPSBhd2FpdCB0aGlzLmNyZWF0ZUxvZ2luU3RhdGUoKVxuXG4gICAgY29uc3QgeyBkYXRhOiB7IHNlc3Npb24gfSA9IHt9IH0gPSBhd2FpdCB0aGlzLmdldFNlc3Npb24oKVxuXG4gICAgLy8gbG9naW5TdGF0Zei/lOWbnuaYr+S4uuS6huWFvOWuuXYy54mI5pysXG4gICAgcmV0dXJuIHsgLi4uKGxvZ2luU3RhdGUgYXMgYW55KSwgZGF0YTogeyB1c2VyOiBzZXNzaW9uLnVzZXIsIHNlc3Npb24gfSwgZXJyb3I6IG51bGwgfVxuICB9XG5cbiAgcHJpdmF0ZSBmb3JtYXRQaG9uZShwaG9uZTogc3RyaW5nKSB7XG4gICAgaWYgKCEvXFxzKy8udGVzdChwaG9uZSkgJiYgL15cXCtcXGR7MSwzfVxcZCsvLnRlc3QocGhvbmUpKSB7XG4gICAgICByZXR1cm4gcGhvbmUucmVwbGFjZSgvXihcXCtcXGR7MSwyfSkoXFxkKykkLywgJyQxICQyJylcbiAgICB9XG4gICAgcmV0dXJuIC9eXFwrXFxkezEsM31cXHMrLy50ZXN0KHBob25lKSA/IHBob25lIDogYCs4NiAke3Bob25lfWBcbiAgfVxuXG4gIHByaXZhdGUgbm90aWZ5TGlzdGVuZXJzKGV2ZW50LCBzZXNzaW9uLCBpbmZvKTogT25BdXRoU3RhdGVDaGFuZ2VDYWxsYmFjayB7XG4gICAgdGhpcy5saXN0ZW5lcnMuZm9yRWFjaCgoY2FsbGJhY2tzKSA9PiB7XG4gICAgICBjYWxsYmFja3MuZm9yRWFjaCgoY2FsbGJhY2spID0+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjYWxsYmFjayhldmVudCwgc2Vzc2lvbiwgaW5mbylcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiBhdXRoIHN0YXRlIGNoYW5nZSBjYWxsYmFjazonLCBlcnJvcilcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICB9KVxuICAgIHJldHVyblxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBpbml0KCk6IFByb21pc2U8eyBlcnJvcjogRXJyb3IgfCBudWxsIH0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgY3JlZGVudGlhbHM6IENyZWRlbnRpYWxzID0gYXdhaXQgdGhpcy5vYXV0aEluc3RhbmNlLm9hdXRoMmNsaWVudC5sb2NhbENyZWRlbnRpYWxzLmdldENyZWRlbnRpYWxzKClcbiAgICAgIGlmIChjcmVkZW50aWFscykge1xuICAgICAgICB0aGlzLmNvbmZpZy5ldmVudEJ1cz8uZmlyZShFVkVOVFMuQVVUSF9TVEFURV9DSEFOR0VELCB7IGV2ZW50OiBBVVRIX1NUQVRFX0NIQU5HRURfVFlQRS5JTklUSUFMX1NFU1NJT04gfSlcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgLy8gSWdub3JlIGVycm9ycyB3aGVuIGNoZWNraW5nIGZvciBleGlzdGluZyBjcmVkZW50aWFsc1xuICAgIH1cblxuICAgIHJldHVybiB7IGVycm9yOiBudWxsIH1cbiAgfVxuXG4gIHByaXZhdGUgc2V0dXBMaXN0ZW5lcnMoKSB7XG4gICAgdGhpcy5jb25maWcuZXZlbnRCdXM/Lm9uKEVWRU5UUy5BVVRIX1NUQVRFX0NIQU5HRUQsIGFzeW5jIChwYXJhbXMpID0+IHtcbiAgICAgIGNvbnN0IGV2ZW50ID0gcGFyYW1zPy5kYXRhPy5ldmVudFxuICAgICAgY29uc3QgaW5mbyA9IHBhcmFtcz8uZGF0YT8uaW5mb1xuICAgICAgY29uc3Qge1xuICAgICAgICBkYXRhOiB7IHNlc3Npb24gfSxcbiAgICAgIH0gPSBhd2FpdCB0aGlzLmdldFNlc3Npb24oKVxuXG4gICAgICB0aGlzLm5vdGlmeUxpc3RlbmVycyhldmVudCwgc2Vzc2lvbiwgaW5mbylcbiAgICB9KVxuICB9XG5cbiAgcHJpdmF0ZSBjb252ZXJ0VG9Vc2VyKHVzZXJJbmZvOiBhdXRoTW9kZWxzLlVzZXJJbmZvICYgUGFydGlhbDxVc2VyPikge1xuICAgIGlmICghdXNlckluZm8pIHJldHVybiBudWxsXG5cbiAgICAvLyDkvJjlhYjkvb/nlKggdXNlckluZm8g5Lit55qE5pWw5o2u77yIVjMgQVBJ77yJXG4gICAgY29uc3QgZW1haWwgPSB1c2VySW5mbz8uZW1haWwgfHwgdXNlckluZm8/LnVzZXJuYW1lXG4gICAgY29uc3QgcGhvbmUgPSB1c2VySW5mbz8ucGhvbmVfbnVtYmVyXG4gICAgY29uc3QgdXNlcklkID0gdXNlckluZm8/LnN1YiB8fCB1c2VySW5mbz8udWlkIHx8ICcnXG5cbiAgICByZXR1cm4ge1xuICAgICAgaWQ6IHVzZXJJZCxcbiAgICAgIGF1ZDogJ2F1dGhlbnRpY2F0ZWQnLFxuICAgICAgcm9sZTogdXNlckluZm8uZ3JvdXBzLFxuICAgICAgZW1haWw6IGVtYWlsIHx8ICcnLFxuICAgICAgZW1haWxfY29uZmlybWVkX2F0OiB1c2VySW5mbz8uZW1haWxfdmVyaWZpZWQgPyB1c2VySW5mby5jcmVhdGVkX2F0IDogdXNlckluZm8uY3JlYXRlZF9hdCxcbiAgICAgIHBob25lLFxuICAgICAgcGhvbmVfY29uZmlybWVkX2F0OiBwaG9uZSA/IHVzZXJJbmZvLmNyZWF0ZWRfYXQgOiB1bmRlZmluZWQsXG4gICAgICBjb25maXJtZWRfYXQ6IHVzZXJJbmZvLmNyZWF0ZWRfYXQsXG4gICAgICBsYXN0X3NpZ25faW5fYXQ6IHVzZXJJbmZvLmxhc3Rfc2lnbl9pbl9hdCxcbiAgICAgIGFwcF9tZXRhZGF0YToge1xuICAgICAgICBwcm92aWRlcjogdXNlckluZm8ubG9naW5UeXBlPy50b0xvd2VyQ2FzZSgpIHx8ICdjbG91ZGJhc2UnLFxuICAgICAgICBwcm92aWRlcnM6IFt1c2VySW5mby5sb2dpblR5cGU/LnRvTG93ZXJDYXNlKCkgfHwgJ2Nsb3VkYmFzZSddLFxuICAgICAgfSxcbiAgICAgIHVzZXJfbWV0YWRhdGE6IHtcbiAgICAgICAgLy8gVjMgQVBJIOeUqOaIt+S/oeaBr1xuICAgICAgICBuYW1lOiB1c2VySW5mbz8ubmFtZSxcbiAgICAgICAgcGljdHVyZTogdXNlckluZm8/LnBpY3R1cmUsXG4gICAgICAgIHVzZXJuYW1lOiB1c2VySW5mbz8udXNlcm5hbWUsIC8vIOeUqOaIt+WQjeensO+8jOmVv+W6piA1LTI0IOS9je+8jOaUr+aMgeWtl+espuS4reiLseaWh+OAgeaVsOWtl+OAgeeJueauiuWtl+espu+8iOS7heaUr+aMgV8t77yJ77yM5LiN5pSv5oyB5Lit5paHXG4gICAgICAgIGdlbmRlcjogdXNlckluZm8/LmdlbmRlcixcbiAgICAgICAgbG9jYWxlOiB1c2VySW5mbz8ubG9jYWxlLFxuICAgICAgICAvLyBWMiBBUEkg5YW85a6577yI5L2/55SoIGFueSDpgb/lhY3nsbvlnovplJnor6/vvIlcbiAgICAgICAgdWlkOiB1c2VySW5mby51aWQsXG4gICAgICAgIG5pY2tOYW1lOiB1c2VySW5mby5uaWNrTmFtZSxcbiAgICAgICAgYXZhdGFyVXJsOiB1c2VySW5mby5hdmF0YXJVcmwgfHwgdXNlckluZm8ucGljdHVyZSxcbiAgICAgICAgbG9jYXRpb246IHVzZXJJbmZvLmxvY2F0aW9uLFxuICAgICAgICBoYXNQYXNzd29yZDogdXNlckluZm8uaGFzUGFzc3dvcmQsXG4gICAgICB9LFxuICAgICAgaWRlbnRpdGllczpcbiAgICAgICAgdXNlckluZm8/LnByb3ZpZGVycz8ubWFwKHAgPT4gKHtcbiAgICAgICAgICBpZDogcC5pZCB8fCAnJyxcbiAgICAgICAgICBpZGVudGl0eV9pZDogcC5pZCB8fCAnJyxcbiAgICAgICAgICB1c2VyX2lkOiB1c2VySWQsXG4gICAgICAgICAgaWRlbnRpdHlfZGF0YToge1xuICAgICAgICAgICAgcHJvdmlkZXJfaWQ6IHAuaWQsXG4gICAgICAgICAgICBwcm92aWRlcl91c2VyX2lkOiBwLnByb3ZpZGVyX3VzZXJfaWQsXG4gICAgICAgICAgICBuYW1lOiBwLm5hbWUsXG4gICAgICAgICAgfSxcbiAgICAgICAgICBwcm92aWRlcjogcC5pZCB8fCAnY2xvdWRiYXNlJyxcbiAgICAgICAgICBjcmVhdGVkX2F0OiB1c2VySW5mby5jcmVhdGVkX2F0LFxuICAgICAgICAgIHVwZGF0ZWRfYXQ6IHVzZXJJbmZvLnVwZGF0ZWRfYXQsXG4gICAgICAgICAgbGFzdF9zaWduX2luX2F0OiB1c2VySW5mby5sYXN0X3NpZ25faW5fYXQsXG4gICAgICAgIH0pKSB8fCBbXSxcbiAgICAgIGNyZWF0ZWRfYXQ6IHVzZXJJbmZvLmNyZWF0ZWRfYXQsXG4gICAgICB1cGRhdGVkX2F0OiB1c2VySW5mby51cGRhdGVkX2F0LFxuICAgICAgaXNfYW5vbnltb3VzOiB1c2VySW5mby5uYW1lID09PSAnYW5vbnltb3VzJyxcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog5Y+C5pWw5qCh6aqM6L6F5Yqp5pa55rOVXG4gICAqL1xuICBwcml2YXRlIHZhbGlkYXRlUGFyYW1zKHBhcmFtczogYW55LCBydWxlczogeyBba2V5OiBzdHJpbmddOiB7IHJlcXVpcmVkPzogYm9vbGVhbjsgbWVzc2FnZTogc3RyaW5nIH0gfSk6IHZvaWQge1xuICAgIGZvciAoY29uc3QgW2tleSwgcnVsZV0gb2YgT2JqZWN0LmVudHJpZXMocnVsZXMpKSB7XG4gICAgICBpZiAocnVsZS5yZXF1aXJlZCAmJiAocGFyYW1zPy5ba2V5XSA9PT0gdW5kZWZpbmVkIHx8IHBhcmFtcz8uW2tleV0gPT09IG51bGwgfHwgcGFyYW1zPy5ba2V5XSA9PT0gJycpKSB7XG4gICAgICAgIHRocm93IG5ldyBBdXRoRXJyb3IoeyBtZXNzYWdlOiBydWxlLm1lc3NhZ2UgfSlcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog5qCh6aqM5b+F5aGr5Y+C5pWw57uE77yI6Iez5bCR5pyJ5LiA5Liq5Y+C5pWw5b+F6aG75pyJ5YC877yJXG4gICAqL1xuICBwcml2YXRlIHZhbGlkYXRlQXRMZWFzdE9uZShwYXJhbXM6IGFueSwgZmllbGRHcm91cHM6IHN0cmluZ1tdW10sIG1lc3NhZ2U6IHN0cmluZyk6IHZvaWQge1xuICAgIGNvbnN0IGhhc1ZhbHVlID0gZmllbGRHcm91cHMuc29tZShncm91cCA9PiBncm91cC5zb21lKGZpZWxkID0+IHBhcmFtcz8uW2ZpZWxkXSAhPT0gdW5kZWZpbmVkICYmIHBhcmFtcz8uW2ZpZWxkXSAhPT0gbnVsbCAmJiBwYXJhbXM/LltmaWVsZF0gIT09ICcnKSwpXG5cbiAgICBpZiAoIWhhc1ZhbHVlKSB7XG4gICAgICB0aHJvdyBuZXcgQXV0aEVycm9yKHsgbWVzc2FnZSB9KVxuICAgIH1cbiAgfVxufVxuIl19