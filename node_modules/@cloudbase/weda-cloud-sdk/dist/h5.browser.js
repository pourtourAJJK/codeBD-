/*!
   * @cloudbase/weda-cloud-sdk
   * Copyright© 2026 Tencent
   */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("mobx"),require("@cloudbase/js-sdk")):"function"==typeof define&&define.amd?define(["exports","mobx","@cloudbase/js-sdk"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).CloudSDK={},e.mobx,e.cloudbase)}(this,(function(e,t,n){"use strict";function i(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var r=i(n);function o(e,t,n,i){return new(n||(n=Promise))((function(r,o){function s(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((i=i.apply(e,t||[])).next())}))}function s(e,t,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(e):i?i.value:t.get(e)}function a(e,t,n,i,r){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?r.call(e,n):r?r.value=n:t.set(e,n),n}class c extends Error{constructor(e,t,n){super(t),this.code=e,this.name="TCBError",this.original=n}}function l(e,t){return!!e&&Object.prototype.hasOwnProperty.call(e,t)}const u={};let d;function f(e){if(!d)throw new Error("app config not inited");return e?d[e]:d}function h(){}function p(e){d=Object.assign(d||{},e)}function g(e){return!e&&d.useLegacyDatasource?"lcap-common-service":"lowcode-datasource"+(d.isProd?"":"-preview")}function m(e,t){return e.length===t.length&&e.every(((e,n)=>e===t[n]))}const v=[];function y(e,...t){const n=v.find((n=>n[0]===e&&m(n[1],t)));if(n)return n[2];const i=e(...t);return v.push([e,t,i]),i}function w(e,t){if(!e)return e;return t.reduce(((t,n)=>(l(e,n)&&(t[n]=e[n]),t)),{})}const S={};function O(e,t){S[e]=t}function I(e,t){const n=S[e];return n&&"function"==typeof n?n(t):n}function b(e){const t=e=>({status:"fulfilled",value:e}),n=e=>({status:"rejected",reason:e});return Promise.all(e.map((e=>Promise.resolve(e).then(t,n))))}function T(e){return"string"==typeof e}function x(e){return"[object Object]"===Object.prototype.toString.call(e)}const A=e=>{const t=t=>{for(const n in e)e.hasOwnProperty(n)&&(t[n]=A(e[n]));return t},n=null==e?"NullOrUndefined":Object.prototype.toString.call(e).slice(8,-1);if(["Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"].includes(n))return e.slice();switch(n){case"Object":return t(Object.create(Object.getPrototypeOf(e)));case"Array":return t([]);case"Date":return new Date(e.valueOf());case"RegExp":return new RegExp(e.source,`${e.global?"g":""}${e.ignoreCase?"i":""}${e.multiline?"m":""}${e.sticky?"y":""}${e.unicode?"u":""}`);default:return e}};function N(e){const t=f("datasetProfiles");return e?t[e]:t}class U{constructor(e){this.localStorage=(null==e?void 0:e.localStorage)||globalThis.localStorage}getItem(e){return o(this,void 0,void 0,(function*(){return this.localStorage.getItem(e)}))}removeItem(e){return o(this,void 0,void 0,(function*(){this.localStorage.removeItem(e)}))}setItem(e,t){return o(this,void 0,void 0,(function*(){this.localStorage.setItem(e,t)}))}getItemSync(e){return this.localStorage.getItem(e)}setItemSync(e,t){this.localStorage.setItem(e,t)}removeItemSync(e){this.localStorage.removeItem(e)}}const _=/^[^:]+:\/\/[^/]+(\/[^?#]+)/;function E(e){if(e)return function(t,n){var i;return o(this,void 0,void 0,(function*(){let r;const o=null===(i=null==n?void 0:n.headers)||void 0===i?void 0:i["x-request-id"];try{const i=Object.assign({},n);i.body&&"string"!=typeof i.body&&(i.body=JSON.stringify(i.body)),r=yield e(Object.assign(Object.assign({},i),{url:t,method:i.method||"GET"})),r.code&&(r={error:r.code,error_description:r.message||r.code,request_id:r.requestId})}catch(e){r={error:"unreachable",error_description:e.message}}if(r.request_id||(r.request_id=o),r.error)throw r.error_uri=k(t),r;return r}))}}function k(e){return _.test(e)?RegExp.$1:e}function D(e,t){return o(this,void 0,void 0,(function*(){if(e.privatelink){let n;if(e.getPrivatelinkAdapter){const t=yield e.getPrivatelinkAdapter();t&&(n=t)}else try{n="undefined"!=typeof window?window.tcbAdapterPrivatelink:void 0}catch(e){}return(null==n?void 0:n.generateAdapterWithConfig)?n.generateAdapterWithConfig({__privatelink_config__:Object.assign({pathname:"/tcb_private_link"},e.privatelink),__tcbAPIEdnpointReg__:t?new RegExp(t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")):void 0}):void 0}}))}const j={},C={},P={};function L(e,t){const n=e.split(".");if(2!==n.length)return void console.warn("[weda-cloud-sdk]setStateVar: invalid varPath",e);let i=n[0];if("$page"===i){const e=f("currentPageId");if(!e||"$global"===e)return void console.warn("[weda-cloud-sdk]setStateVar: can not find currentPageId",i);i=e}const r=u[i],o=n[1];if(r&&(l(r.state.$status,o)||l(r.state,o))){if(r.state.$status[o]){if(t instanceof Error)return void(r.state.$status[o]={status:"failed",code:t.code||-1,message:t.message,error:t});"success"!==r.state.$status[o].status&&(r.state.$status[o]={status:"success"})}r.state[o]=t}}const $={setState:L,setParams:function(e,t,n){const i=(f("datasetProfiles")||{})[e],r=u[e];if(!r)return;let o=t;if(!(null==n?void 0:n.force)){if(!i||!i.params)return;o=w(t,Object.keys(i.params))}r.params||(r.params={}),Object.entries(o).forEach((([e,t])=>{r.params[e]=t}))},EVENT_BUS:{on(e,t){j[e]&&console.warn(`event ${e} has been registered`),j[e]=t},once(e,t){if(P[e])return P[e].push(t);P[e]=[t]},emit(e,...t){return o(this,void 0,void 0,(function*(){j[e]&&j[e](...t),P[e]&&(P[e].forEach((e=>e(...t))),P[e]=[])}))},off(e){Array.isArray(e)?e.forEach((e=>delete j[e])):delete j[e]},listen(e,t){C[e]||(C[e]=[]),C[e].includes(t)||C[e].push(t)},broadcast(e,...t){const n=C[e];n&&0!==n.length&&n.forEach((e=>{try{e(...t)}catch(e){}}))},quit(e,t){const n=C[e];if(!n||0===n.length)return;const i=n.indexOf(t);i>-1&&n.splice(i,1)}}},R={tempURLMaxWaitGap:50};function M(e){Object.assign(R,e)}function F(){return"undefined"!=typeof window&&window||"undefined"!=typeof globalThis&&globalThis}function V(){try{const e=F();if(!e)return;return"undefined"==typeof wx?F().location.href:e.__wxRoute}catch(e){}}function z(){const e=F();if(null==e?void 0:e.navigator)return e.navigator.userAgent;if("undefined"!=typeof wx&&wx.getSystemInfo){let e;return wx.getSystemInfo({success(t){t&&(e=["brand","model","version","system","platform","SDKVersion","language"].map((e=>`${e}: ${t[e]}`)).join(", "))}}),e}}!function(){try{if(M({userAgent:z()}),"undefined"!=typeof window&&window&&window.top){const e=window.__wconfig||top.location.search,t={};if(/\b__wedaTarget=([^&]+)/.test(e)){const e=decodeURIComponent(RegExp.$1);e&&(t.wedaTarget=e)}/\b__useLegacy=true\b/.test(e)&&(t.useLegacyDatasource=!0),p(t)}}catch(e){}}();const W="1.0.109";function G(e,t){if("OPERATION_FAIL"===e.code||/OPERATION_FAIL/.test(e.message)){if(/FUNCTION_NOT_FOUND/.test(e.message)){const n=(null==t?void 0:t.FUNCTION_NOT_FOUND)||"找不到数据源的云函数";return new c("FUNCTION_NOT_FOUND",n,e)}if(/FUNCTIONS_EXECUTE_FAIL/.test(e.message)){const n=(null==t?void 0:t.FUNCTIONS_EXECUTE_FAIL)||"云函数执行失败";return new c("FUNCTIONS_EXECUTE_FAIL",n,e)}}if(/network request error/.test(e.message))return new c("NETWORK_ERROR","网络故障, 请检查本地网络连接是否正常",e);if(/method .* not found in datasource/i.test(e.message)){const n=(null==t?void 0:t.DS_METHOD_NOT_FOUND)||"找不到数据源的方法";return new c("DS_METHOD_NOT_FOUND",n,e)}return(null==t?void 0:t.DEFAULT_ERROR)?new c(e.code||"DEFAULT_ERROR",t.DEFAULT_ERROR,e):e}let q=new Map;const B=["wedaGetItem","wedaGetRecords","wedaGetItemV2","wedaGetRecordsV2","getApiKey"],J=["callWedaApi"],K=(e,t,n={},i)=>o(void 0,void 0,void 0,(function*(){const{cacheTime:r}=n||{},{methodName:o=n.methodName,dataSourceName:s=n.dataSourceName,action:a}=e.data||{},c=r||2e4,l=i||`${o}_${s||a}`,u=JSON.stringify(e),d=q.get(l)||new Map;n.forceClear&&d.delete(u);const f=d.get(u)||{value:null,time:0,promise:null};d.set(u,f),q.set(l,d);return Date.now()-f.time>c&&!f.promise?f.promise=t(e).then((e=>{f.value=e,f.time=Date.now(),f.promise=null})).catch((e=>{f.value=e,f.time=Date.now()-c,f.promise=null})):f.promise||f.value,f.promise&&!f.value&&(yield f.promise),f.value})),H={setItem(e,t){wx.setStorageSync(e,t)},getItem:e=>wx.getStorageSync(e),removeItem(e){wx.removeStorageSync(e)},clear(){wx.clearStorageSync()},getKeys(){const{keys:e}=wx.getStorageInfoSync();return e||[]}};const X=new class{constructor(e){this.localStorage=(null==e?void 0:e.localStorage)||globalThis.localStorage}getItem(e){return o(this,void 0,void 0,(function*(){return this.localStorage.getItem(e)}))}removeItem(e){return o(this,void 0,void 0,(function*(){this.localStorage.removeItem(e)}))}setItem(e,t){return o(this,void 0,void 0,(function*(){this.localStorage.setItem(e,t)}))}getItemSync(e){return this.localStorage.getItem(e)}setItemSync(e,t){this.localStorage.setItem(e,t)}removeItemSync(e){this.localStorage.removeItem(e)}getKeysSync(){return this.localStorage===globalThis.localStorage?Object.keys(this.localStorage):this.localStorage.getKeys()}}({localStorage:Y()?H:void 0});function Y(){if("undefined"==typeof wx)return!1;if("undefined"==typeof Page)return!1;if(!wx.getSystemInfoSync)return!1;if(!wx.getStorageSync)return!1;if(!wx.setStorageSync)return!1;if(!wx.connectSocket)return!1;if(!wx.request)return!1;try{if(!wx.getSystemInfoSync())return!1;if("qq"===wx.getSystemInfoSync().AppPlatform)return!1}catch(e){return!1}return!0}const Z=["wedaGetRecords","wedaGetItem"],Q=["wedaCreateV2","wedaBatchCreateV2","wedaUpdateV2","wedaBatchUpdateV2","wedaDeleteV2","wedaBatchDeleteV2","wedaGetItemV2","wedaGetRecordsV2"],ee={wedaCreateV2:"create",wedaBatchCreateV2:"createMany",wedaUpdateV2:"update",wedaBatchUpdateV2:"updateMany",wedaDeleteV2:"delete",wedaBatchDeleteV2:"deleteMany",wedaGetItemV2:"get",wedaGetRecordsV2:"list"};function te(e){var t,n;return o(this,void 0,void 0,(function*(){const i="boolean"!=typeof e.parseBusinessInfo||e.parseBusinessInfo,r=Object.assign({},e),o=r.name||r.dataSourceName,{methodName:s}=r,a={params:r.params,methodName:s},c=(e=>{if(e&&Object.keys(e).length)return Object.assign({swrMode:!0},e)})(null===(t=r.params)||void 0===t?void 0:t.swr);delete r.name,delete r.parseBusinessInfo,(null===(n=r.params)||void 0===n?void 0:n.swr)&&delete r.params.swr;const l=Object.assign(r.extraParams||{},{dataSourceName:o,methodName:s,defaultParams:I(o,a),params:r.params});try{const e=f("customCallDataSource");if(e){return yield e(Object.assign({},l,{parseBusinessInfo:i}))}const t=f("beforeDSRequest");t&&t(r);const n=yield ie({name:g(!0),data:l},{unwrapResult:!0,parseBusinessInfo:i,swr:c}),o=f("afterDSRequest");return o&&o(r,null,n),n}catch(e){if(console.warn(`[weda-cloud-sdk] failed to invoke datasource ${o}'s method ${s}`,e),i){const t=G(e,{FUNCTION_NOT_FOUND:`找不到数据源${o}的云函数`,DS_METHOD_NOT_FOUND:`数据源${o}中的方法${s}不存在或者未启用`,FUNCTIONS_EXECUTE_FAIL:`调用数据源${o}方法${s}失败: 请检查该数据源所有自定义方法的代码中是否存在语法错误`,DEFAULT_ERROR:`调用数据源${o}方法${s}失败: ${e.errMsg||e.message}`}),n=f("afterDSRequest");throw n&&n(r,t),t}return{code:e.errCode||-2,message:`调用数据源${o}方法${s}失败: ${e.errMsg||e.message}`}}}))}function ne(e,t){return new Proxy({},{get(n,i){if(t){const e=t(i);if(e)return e}return new Proxy({},{get:(t,n)=>(t,r)=>te({name:i,methodName:n,extraParams:r,params:t,parseBusinessInfo:e})})}})}function ie(e,t){var n,i;return o(this,void 0,void 0,(function*(){let r=A(e);const s=(null===(n=e.data)||void 0===n?void 0:n.envType)||(f("isProd")?"prod":"pre"),a={wedaAppId:f("appID"),userAgent:R.userAgent,referrer:V(),envType:s,wedaTarget:f("wedaTarget"),"x-cloud-sdk-version":W},l=e.data||{};for(const e in l){const t=l[e];"symbol"==typeof(null==t?void 0:t._internalType)&&(r.data||(r.data={}),r.data[e]=t)}r.data=Object.assign({},r.data,a);const u=f("beforeCallFunction");let d;u&&(r=yield u(r));const h=f("afterCallFunction");try{if(r=re(r),(e=>{const{methodName:t}=(null==e?void 0:e.data)||{};B.includes(t)||J.includes(t)||(q=new Map)})(r),d=yield function(e,t){var n,i,r,s,a,c;return o(this,void 0,void 0,(function*(){const o=f("initTcb"),l=f("isPrivate"),{methodName:u,dataSourceName:d}=e.data||{};let h=null==t?void 0:t.app;if(h||(h=(yield o()).app),!Y()&&!l&&ee[u||""]&&(null==h?void 0:h.models)){const o=ee[u],c=null===(n=h.models[d])||void 0===n?void 0:n[o],l=Object.assign(Object.assign({},null===(i=e.data)||void 0===i?void 0:i.params),{envType:null===(r=e.data)||void 0===r?void 0:r.envType,"x-cloud-sdk-version":null===(s=e.data)||void 0===s?void 0:s["x-cloud-sdk-version"]});let f={};try{f=(null===(a=null==t?void 0:t.swr)||void 0===a?void 0:a.swrMode)?yield K(l,c.bind(h),Object.assign(Object.assign({},null==t?void 0:t.swr),{dataSourceName:d,methodName:u})):yield c(l)}catch(e){throw e}return(null==t?void 0:t.unwrapResult)&&(f=Object.assign(Object.assign({},f),{result:f})),f}return(null===(c=null==t?void 0:t.swr)||void 0===c?void 0:c.swrMode)?yield K(e,h.callFunction.bind(h),null==t?void 0:t.swr):yield h.callFunction(e)}))}(r,t),h&&h(r,null,JSON.parse(JSON.stringify(d))),(null===(i=null==t?void 0:t.swr)||void 0===i?void 0:i.swrMode)&&(null==d?void 0:d.error))throw d}catch(e){throw h&&h(r,e),e}if(null==t?void 0:t.unwrapResult){const{result:e}=d;if(!t.parseBusinessInfo)return e;if(e&&!e.code)return e.data;throw console.warn("[weda-cloud-sdk]failed to invoke backend, %c调用后端接口失败, 请仔细查看下述错误信息:","color: red;"),console.warn(`\tcode: ${null==e?void 0:e.code}\n\tmessage: ${null==e?void 0:e.message}\n\treason: ${null==e?void 0:e.reason}\n\trequestId: ${d.requestId}\n\toriginal response: `,d),new c(null==e?void 0:e.code,null==e?void 0:e.message,d)}return d}))}const re=e=>{try{const{methodName:t,params:n={}}=(null==e?void 0:e.data)||{};n.hasOwnProperty("where")&&Z.includes(t||"")&&(n.where=oe(n.where)),n.hasOwnProperty("filter")&&Q.includes(t||"")&&(n.filter=oe(n.filter))}catch(e){}return e},oe=e=>{let t;return Array.isArray(e)?(t=t||[],e.forEach((e=>{const n=oe(e);void 0!==n&&t.push(n)})),t):x(e)?(Object.keys(e).forEach((n=>{const i=oe(e[n]);void 0!==i&&(t=t||{},t[n]=i)})),t):e},se=e=>{if(e&&Object.keys(e).length)return Object.assign({swrMode:!0},e)};function ae(e,t){return o(this,void 0,void 0,(function*(){const n=A(e),i=A(n.swr||{});return delete n.swr,ie({name:g(),data:Object.assign(Object.assign({},n),{mode:"c"})},{app:t,unwrapResult:!0,parseBusinessInfo:!0,swr:i}).catch((e=>{throw G(e,{FUNCTION_NOT_FOUND:"微搭环境异常: 未找到数据源公共云函数",FUNCTIONS_EXECUTE_FAIL:"微搭环境异常: 数据源公共云函数调用失败"})}))}))}function ce(e){return o(this,void 0,void 0,(function*(){const t=A(e);return e&&delete t.swr,ae({methodName:"callWedaApi",params:t,swr:se(null==e?void 0:e.swr)}).then((e=>e.Data))}))}const le={_:[]};function ue(e){return JSON.parse(JSON.stringify(e))}const de={wrapperDatasourceMethod:e=>function(t){return te({name:e.dataSourceName,methodName:e.methodName,params:t})}};function fe(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}const he="object"==typeof performance&&performance&&"function"==typeof performance.now?performance:Date,pe=()=>he.now(),ge=e=>e===1/0||(e=>e&&e===Math.floor(e)&&e>0&&isFinite(e))(e);class me{constructor({max:e=1/0,ttl:t,updateAgeOnGet:n=!1,checkAgeOnGet:i=!1,noUpdateTTL:r=!1,dispose:o,noDisposeOnSet:s=!1}={}){if(this.expirations=Object.create(null),this.data=new Map,this.expirationMap=new Map,void 0!==t&&!ge(t))throw new TypeError("ttl must be positive integer or Infinity if set");if(!ge(e))throw new TypeError("max must be positive integer or Infinity");if(this.ttl=t,this.max=e,this.updateAgeOnGet=!!n,this.checkAgeOnGet=!!i,this.noUpdateTTL=!!r,this.noDisposeOnSet=!!s,void 0!==o){if("function"!=typeof o)throw new TypeError("dispose must be function if set");this.dispose=o}this.timer=void 0,this.timerExpiration=void 0}setTimer(e,t){if(this.timerExpiration<e)return;this.timer&&clearTimeout(this.timer);const n=setTimeout((()=>{this.timer=void 0,this.timerExpiration=void 0,this.purgeStale();for(const e in this.expirations){this.setTimer(e,e-pe());break}}),t);n.unref&&n.unref(),this.timerExpiration=e,this.timer=n}cancelTimer(){this.timer&&(clearTimeout(this.timer),this.timerExpiration=void 0,this.timer=void 0)}cancelTimers(){return process.emitWarning('TTLCache.cancelTimers has been renamed to TTLCache.cancelTimer (no "s"), and will be removed in the next major version update'),this.cancelTimer()}clear(){const e=this.dispose!==me.prototype.dispose?[...this]:[];this.data.clear(),this.expirationMap.clear(),this.cancelTimer(),this.expirations=Object.create(null);for(const[t,n]of e)this.dispose(n,t,"delete")}setTTL(e,t=this.ttl){const n=this.expirationMap.get(e);if(void 0!==n){const t=this.expirations[n];!t||t.length<=1?delete this.expirations[n]:this.expirations[n]=t.filter((t=>t!==e))}if(t!==1/0){const n=Math.floor(pe()+t);this.expirationMap.set(e,n),this.expirations[n]||(this.expirations[n]=[],this.setTimer(n,t)),this.expirations[n].push(e)}else this.expirationMap.set(e,1/0)}set(e,t,{ttl:n=this.ttl,noUpdateTTL:i=this.noUpdateTTL,noDisposeOnSet:r=this.noDisposeOnSet}={}){if(!ge(n))throw new TypeError("ttl must be positive integer or Infinity");if(this.expirationMap.has(e)){i||this.setTTL(e,n);const o=this.data.get(e);o!==t&&(this.data.set(e,t),r||this.dispose(o,e,"set"))}else this.setTTL(e,n),this.data.set(e,t);for(;this.size>this.max;)this.purgeToCapacity();return this}has(e){return this.data.has(e)}getRemainingTTL(e){const t=this.expirationMap.get(e);return t===1/0?t:void 0!==t?Math.max(0,Math.ceil(t-pe())):0}get(e,{updateAgeOnGet:t=this.updateAgeOnGet,ttl:n=this.ttl,checkAgeOnGet:i=this.checkAgeOnGet}={}){const r=this.data.get(e);if(!i||0!==this.getRemainingTTL(e))return t&&this.setTTL(e,n),r;this.delete(e)}dispose(e,t){}delete(e){const t=this.expirationMap.get(e);if(void 0!==t){const n=this.data.get(e);this.data.delete(e),this.expirationMap.delete(e);const i=this.expirations[t];return i&&(i.length<=1?delete this.expirations[t]:this.expirations[t]=i.filter((t=>t!==e))),this.dispose(n,e,"delete"),0===this.size&&this.cancelTimer(),!0}return!1}purgeToCapacity(){for(const e in this.expirations){const t=this.expirations[e];if(!(this.size-t.length>=this.max)){const e=this.size-this.max,n=[];for(const i of t.splice(0,e))n.push([i,this.data.get(i)]),this.data.delete(i),this.expirationMap.delete(i);for(const[e,t]of n)this.dispose(t,e,"evict");return}{delete this.expirations[e];const n=[];for(const e of t)n.push([e,this.data.get(e)]),this.data.delete(e),this.expirationMap.delete(e);for(const[e,t]of n)this.dispose(t,e,"evict")}}}get size(){return this.data.size}purgeStale(){const e=Math.ceil(pe());for(const t in this.expirations){if("Infinity"===t||t>e)return;const n=[...this.expirations[t]||[]],i=[];delete this.expirations[t];for(const e of n)i.push([e,this.data.get(e)]),this.data.delete(e),this.expirationMap.delete(e);for(const[e,t]of i)this.dispose(t,e,"stale")}0===this.size&&this.cancelTimer()}*entries(){for(const e in this.expirations)for(const t of this.expirations[e])yield[t,this.data.get(t)]}*keys(){for(const e in this.expirations)for(const t of this.expirations[e])yield t}*values(){for(const e in this.expirations)for(const t of this.expirations[e])yield this.data.get(t)}[Symbol.iterator](){return this.entries()}}const ve=new(fe(me))({max:1e3,ttl:2e4,checkAgeOnGet:!0});let ye=[],we=[],Se=[];let Oe=0,Ie=0;function be(){return o(this,void 0,void 0,(function*(){const e=we.splice(0);ye=ye.concat(e);try{const t=f("initTcb"),{app:n}=yield t(),i=(yield b(function(e,t){const n=[];for(let i=0;i<e.length;i+=t)n.push(e.slice(i,i+t));return n}(e,40).map((e=>n.getTempFileURL({fileList:e}))))).filter((e=>"fulfilled"===e.status));ye=ye.filter((t=>!e.includes(t)));const r=i.reduce(((e,t)=>{const n=t.value||{};return n.code&&"SUCCESS"!==n.code?(console.warn("[cloud.getTempFileURL]server response error",n),e):e.concat(n.fileList)}),[]);if(!r.length)return void Te({},e);const o={},s=[];r.forEach((e=>{var t;(l(t=e,"code")?"SUCCESS"===t.code:l(t,"status")&&!t.status)?o[e.fileID]=e.tempFileURL:(console.warn("[cloud.getTempFileURL]single item failed",e),s.push(e.fileID))})),Te(o,s)}catch(t){ye=ye.filter((t=>!e.includes(t))),console.warn("[cloud.getTempFileURL] request failed",t),Te({},e)}}))}function Te(e,t){Object.keys(null!=e?e:{}).forEach((t=>{ve.set(t,e[t])})),Se.forEach((e=>{const n=xe(e.fileIds,t);!1!==n&&(e.resolve(n),e.isDone=!0)})),Se=Se.filter((e=>!e.isDone))}function xe(e,t=[]){try{if(Array.isArray(e)){const n={};return e.reduce(((e,n)=>{const i=ve.get(n);if(!i){if(t.includes(n))return e;throw new Error("not found")}return e[n]=i,e}),n)}const n=ve.get(e);if(!n){if(t.includes(e))return;throw new Error("not found")}return n}catch(e){return!1}}const Ae=ne(!1,(e=>{if("$call"===e)return e=>te(Object.assign({},e,{parseBusinessInfo:!1}))})),Ne={dataSources:ne(!0),callDataSource:te,callConnector:te,callModel:te,IS_WEDA_IDE:!1,version:W,utils:de,getCloudInstance:function(){return o(this,void 0,void 0,(function*(){const e=f("initTcb"),{app:t}=yield e();return t}))},callGraphql:function(e){return o(this,void 0,void 0,(function*(){try{const t=f("beforeDSRequest");t&&t(e);const n=yield ie({name:g(!0),data:{mode:"graphql",params:e}},{unwrapResult:!0}),i=f("afterDSRequest");return i&&i(e,null,n),n}catch(t){const n=f("afterDSRequest");throw n&&n(e,t),t}}))},callFunction:ie,callWorkflow:function(e){return o(this,void 0,void 0,(function*(){return ce(e)}))},callWedaApi:ce,callCommonService:ae,getTempFileURL:function(e){const t=function(e){const t=e&&"object"==typeof e&&e.fileList?e.fileList:e;return"string"==typeof t||Array.isArray(t)?t:void 0}(e);if(!t||!t.length)return Promise.resolve();const n=xe(t);return!1!==n?Promise.resolve(n):new Promise(((e,n)=>{!function(e,t,n){Se.push({fileIds:e,resolve:t,reject:n});let i=(Array.isArray(e)?e:[e]).filter((e=>x(e)||T(e)));we.length&&(i=i.filter((e=>!we.includes(e))));i.length&&ye.length&&(i=i.filter((e=>!ye.includes(e))));i.length&&(i=i.filter((e=>!ve.has(e))));if(!i.length)return;we=we.concat(i),clearTimeout(Ie);const r=Date.now();Oe=!Oe||r>Oe?r+R.tempURLMaxWaitGap:Oe,Ie=setTimeout(be,Oe-r)}(t,e,n)}))},getDataSourceViewId:h,getDataSourceProfile:function(e){const t=f("dataSourceProfiles");if(!t||!t.length)return void console.warn("[weda-cloud-sdk]datasource profile is empty");const n="string"==typeof e?{val:e,key:"name"}:e,i="function"==typeof n?n:e=>e&&e[n.key]===n.val;return t.find(i)},getDataSourceProfileAsync:function(e){return o(this,void 0,void 0,(function*(){const t="string"==typeof e,n=t?{Name:e}:e,i=JSON.stringify(n);if(le[i])return ue(le[i]);if(t){const t=le._.find((t=>t.name===e));if(t)return ue(t)}const r=f("dataSourceProfiles");if((null==r?void 0:r.length)&&t){const t=r.find((t=>t.name===e));if(t)return ue(t)}const{swrMode:o}=n;delete n.swrMode;const s=function(e){const t={};Object.keys(e).reduce(((t,n)=>(t[n.charAt(0).toLowerCase()+n.slice(1)]=e[n],t)),t);const n={schema:{},methods:[]};return Object.keys(n).forEach((e=>{try{t[e]=JSON.parse(t[e])}catch(i){t[e]=n[e]}})),t}(yield ce({action:"RuntimeDescribeDataSource",data:n,swr:{swrMode:o}}));return le[i]=s,le._.push(s),ue(s)}))},setConfig:M,checkAuth:function(e){return ce({action:"DescribeWedaAccessResourcesByType",data:e})},setDataSourceDefaultParams:O};var Ue,_e,Ee,ke,De,je,Ce,Pe,Le;_e=new WeakMap,Ee=new WeakMap,ke=new WeakMap,De=new WeakMap,je=new WeakMap,Ue=new WeakSet,Ce=function(e){s(this,De,"f")===e&&(e.next?a(this,De,e.next,"f"):e.pre&&a(this,De,e.pre,"f")),e!==s(this,ke,"f")&&(e.pre&&(e.pre.next=e.next),e.next&&(e.next.pre=e.pre),e.next=s(this,ke,"f"),e.pre=null,s(this,ke,"f")&&(s(this,ke,"f").pre=e),a(this,ke,e,"f"))},Pe=function(e){for(;e>0&&s(this,De,"f");){const{size:t}=s(this,De,"f").data;s(this,Ee,"f").delete(s(this,De,"f").data.key),s(this,De,"f").pre?(s(this,De,"f").pre.next=null,a(this,De,s(this,De,"f").pre,"f")):a(this,De,null,"f"),e-=t,this.calculatedSize-=t}},Le=function(e,t){const n=s(this,Ee,"f").get(e,t);return(null==n?void 0:n.node)&&s(this,Ue,"m",Ce).call(this,null==n?void 0:n.node),n};class $e{constructor(e,t){this.data={key:e,size:t},this.pre=null,this.next=null}}const Re=/^(?:(\d*);)?(.*)$/;function Me(e){const t=e||"";if("string"==typeof t){const e=t.match(Re);if(e)return{timestamp:Number(e[1])||0,value:e[2]}}}class Fe extends Map{constructor(){super()}get(e,t={}){const{refreshCache:n=!0}=t,i=super.get(e);let r=X.getItemSync(e);if(i&&r){const t=Me(r);return t&&(r=t.value,n&&X.setItem(e,`${Date.now()};${r}`)),{node:i,value:r}}}set(e,t,n={}){const{refreshCache:i=!0}=n||{},r=super.set(e,t.node);return i&&X.setItemSync(e,`${Date.now()};${t.value}`),r}delete(e){const t=super.delete(e);return X.removeItemSync(e),t}}const Ve=new class{constructor({map:e=new Map,size:t,sizeCalculation:n=(()=>1),onInit:i}){return Ue.add(this),_e.set(this,0),Ee.set(this,void 0),ke.set(this,void 0),De.set(this,void 0),je.set(this,void 0),this.calculatedSize=0,a(this,_e,t||0,"f"),a(this,Ee,e,"f"),a(this,je,n,"f"),this.calculatedSize=0,a(this,ke,null,"f"),a(this,De,null,"f"),i&&i(this),this}list(){var e;let t=s(this,ke,"f");const n=[];for(;null==t?void 0:t.data;)n.push({key:t.data.key,value:null===(e=s(this,Ue,"m",Le).call(this,t.data.key))||void 0===e?void 0:e.value}),t=t.next;return n}get(e,t){const n=s(this,Ue,"m",Le).call(this,e,t);return null==n?void 0:n.value}set(e,t,n){var i;const r=s(this,je,"f").call(this,t,e);if(r>s(this,_e,"f"))return s(this,Ee,"f").delete(e),void(this.calculatedSize-=r);const o=s(this,Ue,"m",Le).call(this,e,n),c=null==o?void 0:o.node,l=r-((null===(i=null==c?void 0:c.data)||void 0===i?void 0:i.size)||0);if(c)c.data.size=r,s(this,Ee,"f").set(e,{node:c,value:t},n);else{const i=new $e(e,s(this,je,"f").call(this,t,e));null==s(this,ke,"f")&&null===s(this,De,"f")&&a(this,De,i,"f"),i.next=s(this,ke,"f"),s(this,ke,"f")&&(s(this,ke,"f").pre=i),a(this,ke,i,"f"),s(this,Ee,"f").set(e,{node:i,value:t},n)}s(this,Ue,"m",Pe).call(this,this.calculatedSize+l-s(this,_e,"f")),this.calculatedSize=this.calculatedSize+l}delete(e){const t=s(this,Ee,"f").get(e);t&&(s(this,ke,"f")===t.node&&a(this,ke,t.node.next,"f"),s(this,De,"f")===t.node&&a(this,De,t.node.pre,"f"),t.node.pre&&(t.node.pre.next=t.node.next),t.node.next&&(t.node.next.pre=t.node.pre),t.node.pre=null,t.node.next=null,this.calculatedSize=this.calculatedSize-t.node.data.size,s(this,Ee,"f").delete(e))}}({size:2048e3,sizeCalculation:(e,t)=>`${String(e)}${String(t)}`.length,map:new Fe,onInit:e=>{(X.getKeysSync()||[]).filter((e=>e.startsWith("dataset_"))).map((e=>{const t=X.getItemSync(e),{value:n,timestamp:i}=Me(t)||{value:t||"",timestamp:0};return{key:e,value:n,timestamp:i}})).sort(((e,t)=>e.timestamp-t.timestamp>=0?1:-1)).forEach((({key:t,value:n})=>{e.set(t,n,{refreshCache:!1})}))}});function ze(e,t){if(!e)return;const n=Object.keys(e);if(!n.length)return{};return n.reduce(((n,i)=>{const r=e[i];return n[i]=void 0!==r.initialValue?r.initialValue:r.required?"":void 0,t&&(n[i]=r.sampleValue||n[i]),n}),{})}function We(e,t){if(!e)return{};const n=Object.keys(e),i={},r=n.reduce(((n,r)=>{const o=e[r];if("state"!==o.varType)return n;if(o.enableSyncLocal){const e=Ge(null==t?void 0:t.appId,null==t?void 0:t.datasetProfileKey,r);e&&(i[e]=!0);try{const e=function(e,t,n,i=!0){const r=Ge(e,t,n);if(r){const e=Ve.get(r,{local:!!i});if("string"==typeof e)return JSON.parse(e)}return}(null==t?void 0:t.appId,null==t?void 0:t.datasetProfileKey,r,!1);n[r]=e}catch(e){console.error("get local state error:",e)}}return void 0===n[r]&&(n[r]=o.initialValue),n}),{});return function(e,t,n={}){const i=qe(e,t);if(i){(X.getKeysSync()||[]).forEach((e=>{!n[e]&&e.startsWith(i)&&Promise.resolve().then((()=>{Ve.delete(e)}))}))}}(null==t?void 0:t.appId,null==t?void 0:t.datasetProfileKey,i),r}function Ge(e,t,n){const i=qe(e,t);if(i&&n)return`${i}${n}`}function qe(e,t){if(e&&t)return`dataset_${e}_${t}_`}function Be(){let e;try{e=f("customConfig")}catch(e){}return e||window._WedaHostConfig||{}}function Je(e){return o(this,void 0,void 0,(function*(){const t=r.default,n=f(),i=Be();let o;const s=n.isPrivate?new URL(n.tcbApiOrigin||location.origin):void 0,a=s?s.host:"",c=n.isPrivate?new URL(n.gatewayOrigin||location.origin):void 0,l=yield D(n,a);if(null==i?void 0:i.tcbInstance)o=i.tcbInstance;else{if(l&&(console.log("use privatelink adapter"),t.useAdapters(l)),o=t.init({timeout:6e4,env:e,clientId:n.tcbClientId,region:n.region,lang:n.lang||""}),s){const{host:e,protocol:n}=s;t.registerEndPoint(`//${e}/web`,n)}if(c){const{host:e,protocol:n}=c;t.registerEndPointWithKey({key:"GATEWAY",url:`//${e}/v1`,protocol:n})}}let u={persistence:"local"};if(l)try{const{genOauthAdaper:e=(()=>({}))}=l,t=e({generateOauthClientRequest:E,OauthClientStorgeBase:U});u=Object.assign(Object.assign({},u),t)}catch(e){console.error("adapter generate fail:",e)}const d=o.auth(u);return{app:o,auth:d}}))}function Ke(){return y(Je,f().envID)}function He(){return o(this,void 0,void 0,(function*(){const{auth:e}=yield Ke();if(e.loginScope){const t={notLogin:!0,isAnonymous:!1,hasLogin:!1};try{if(e.hasLoginState()){yield e.getAccessToken();const n=yield e.loginScope();try{t.groups=yield e.loginGroups()}catch(e){console.warn("[weda-cloud-sdk] loginGroups faile",e)}t.notLogin=!1,t.isAnonymous="anonymous"===n,t.hasLogin="anonymous"!==n}}catch(e){console.warn("[weda-cloud-sdk] getLoginState fail",e)}return t}if(e.hasLoginState){const t=e.hasLoginState();return{notLogin:!t,isAnonymous:!!t&&"ANONYMOUS"===t.loginType,hasLogin:!!t&&"ANONYMOUS"!==t.loginType,version:"1.0"}}return console.warn("[weda-cloud-sdk] unable to get loginState due to unsupported @cloudbase/js-sdk version, please update to latest version."),{notLogin:!1,isAnonymous:!0,hasLogin:!1,version:"1.0"}}))}const Xe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Ye=/^(?:[A-Za-z\d+/]{4})*?(?:[A-Za-z\d+/]{2}(?:==)?|[A-Za-z\d+/]{3}=?)?$/;const Ze=e=>{var t,n;try{const i=function(e){if(e=String(e).replace(/[\t\n\f\r ]+/g,""),!Ye.test(e))throw new TypeError("Failed to execute 'atob' on 'Window': The string to be decoded is not correctly encoded.");let t;e+="==".slice(2-(3&e.length));let n,i,r="",o=0;for(;o<e.length;)t=Xe.indexOf(e.charAt(o++))<<18|Xe.indexOf(e.charAt(o++))<<12|(n=Xe.indexOf(e.charAt(o++)))<<6|(i=Xe.indexOf(e.charAt(o++))),r+=64===n?String.fromCharCode(t>>16&255):64===i?String.fromCharCode(t>>16&255,t>>8&255):String.fromCharCode(t>>16&255,t>>8&255,255&t);return r}(null===(n=null===(t=e.split("."))||void 0===t?void 0:t[1])||void 0===n?void 0:n.replace(/-/g,"+").replace(/_/g,"/"));return JSON.parse(i)||{}}catch(e){return{}}};let Qe={};function et(e){return e.key&&(Qe[e.key]=!0),function({key:e,getTcbInstance:t,value:n="",type:i="get"}){var r;return o(this,void 0,void 0,(function*(){if(X&&e)try{const{auth:o}=yield t(),{envID:s="",tcbClientId:a=""}=f(),{accessToken:c=""}=(yield o.getAccessToken())||{},{user_id:l="",sub:u="",scope:d=""}=Ze(c),h=`${s}-${a}`,p=`${d}_${l||u}`,g=JSON.parse(X.getItemSync(e)||"{}");if("remove"===i)return delete g[h],void X.setItemSync(e,JSON.stringify(g));if("_"===p)return;if("get"===i)return null===(r=g[h])||void 0===r?void 0:r[p];if("set"===i)return void X.setItemSync(e,JSON.stringify(Object.assign(Object.assign({},g),{[h]:{[p]:n}})))}catch(e){return}}))}(Object.assign(Object.assign({},e),{getTcbInstance:Ke}))}function tt(){try{Object.keys(Qe).forEach((e=>{et({key:e,type:"remove"})})),Qe={}}catch(e){console.error("clear cache error:",e)}}const nt=t.observable({currentUser:null}),it=({app:e,params:t,methodName:n})=>o(void 0,void 0,void 0,(function*(){var i,r;if(n){if(nt.currentUser=yield ae({methodName:n,params:t||{}},e),null===(i=nt.currentUser)||void 0===i?void 0:i.userExtend)try{nt.currentUser.wxOpenId=nt.currentUser.wxOpenId||(null===(r=JSON.parse(nt.currentUser.userExtend))||void 0===r?void 0:r.open_id)||""}catch(e){}nt.currentUser=Object.assign(Object.assign({},t),nt.currentUser),et({key:{signIn:"SIGNIN_INFO",getUserInfo:"USER_INFO"}[n],value:nt.currentUser,type:"set"})}}));function rt(e){return o(this,void 0,void 0,(function*(){const{app:t}=yield Ke(),n=yield et({key:"SIGNIN_INFO",type:"get"});return n?(nt.currentUser=n,setTimeout((()=>{it({app:t,params:e,methodName:"signIn"})}),0)):yield it({app:t,params:e,methodName:"signIn"}),nt.currentUser}))}function ot(){return o(this,void 0,void 0,(function*(){const{auth:e}=yield Ke();e.anonymousAuthProvider?yield e.anonymousAuthProvider().signIn():e.signInAnonymously?yield e.signInAnonymously():console.warn("[weda-cloud-sdk] failed to anonymous login, unsupported @cloudbase/js-sdk version")}))}var st={signIn:rt,getUserInfo:function(e=!1){return o(this,void 0,void 0,(function*(){if(e||!nt.currentUser){const{app:e}=yield Ke(),t=yield et({key:"USER_INFO",type:"get"});t?(nt.currentUser=Object.assign(Object.assign({},nt.currentUser),t),setTimeout((()=>{it({app:e,methodName:"getUserInfo"})}),0)):yield it({app:e,methodName:"getUserInfo"})}return nt.currentUser}))},signOut:function(e){return o(this,void 0,void 0,(function*(){const t=yield He(),{auth:n}=yield Ke();if(nt.currentUser=null,t.hasLogin){const t=yield n.signOut(e);if(tt(),t.redirect_uri)try{return window.location.replace(t.redirect_uri),t}catch(e){console.log("[cloud-sdk] signOut redirect_uri error",e)}}return t.isAnonymous||(yield ot(),yield rt({userType:"anonymousUser"})),{}}))},anonymousLogin:ot,get currentUser(){if(nt.currentUser)return Object.assign({},nt.currentUser);const e=Be(),t=null==e?void 0:e.wedaUser;return t?(n=t,Object.assign(Object.assign({},n),{wedaId:n.userId||"",avatarUrl:n.avatar,nickName:n.nickName||n.name||"",gender:0,wxOpenId:(()=>{if(n.userExtend)try{const e=JSON.parse(n.userExtend);return(null==e?void 0:e.open_id)||""}catch(e){return""}return""})()})):null;var n},setCurrentUserInfo(e={}){for(const t in e)nt.currentUser&&(nt.currentUser[t]=e[t])},getUrlWithOpenidToken(e){return o(this,void 0,void 0,(function*(){return e||""}))},openIdLoginInWxApp(){return o(this,void 0,void 0,(function*(){return!1}))},unionIdLoginInWxApp(){return o(this,void 0,void 0,(function*(){return!1}))},modifyCurrentUser:function({nickName:e="",userName:t="",avatarUrl:n="",description:i=""}={}){return o(this,void 0,void 0,(function*(){const{userType:r,wedaId:o,nickName:s,avatarUrl:a,name:c,userDesc:l}=nt.currentUser;if("anonymousUser"===r||!o)return{};try{const{app:r,auth:u}=yield Ke();return yield u.updateUserBasicInfo({user_id:o,nickname:e||s||"",username:t||c||"",description:i||l||"",avatar_url:n||a||""}),yield it({app:r,methodName:"getUserInfo"}),nt.currentUser}catch(e){console.log("=======> [modifyCurrentUser]: error ",e)}return{}}))}};const at=Object.assign(Ne,st);function ct(e){var t,n,i,r;return o(this,void 0,void 0,(function*(){const{app:e,auth:s}=yield Ke(),a=Be(),c=yield He();let l=!c.hasLogin;if(!(null==a?void 0:a.login)||c.hasLogin&&!(null==a?void 0:a.forceLogin))c.notLogin&&(yield st.anonymousLogin(),l=!0);else try{yield a.login({app:e,auth:s,loginState:c,defaultLogin(){return o(this,void 0,void 0,(function*(){yield st.anonymousLogin()}))}}),l=!1}catch(e){if("anonymous_login"!==(null===(t=null==a?void 0:a.loginConfig)||void 0===t?void 0:t.failurePolicy))throw e;yield st.anonymousLogin(),l=!0}if(a&&!(null===(n=null==a?void 0:a.loginConfig)||void 0===n?void 0:n.needSignIn))(null===(i=null==a?void 0:a.wedaUser)||void 0===i?void 0:i.relatedRoles)||(yield st.getUserInfo(null==a?void 0:a.forceLogin));else{const e=l?"anonymousUser":"1.0"===c.version||(null===(r=c.groups)||void 0===r?void 0:r.includes("internal"))?"internalUser":"externalUser";try{yield st.signIn({userType:e})}catch(e){console.warn("[weda-cloud-sdk] initial signIn failed",e)}}return{app:e,auth:s}}))}function lt(e=!1){return o(this,void 0,void 0,(function*(){const{envID:t}=f();return e?ct():y(ct,t)}))}Object.defineProperty(at,"currentUser",{get:()=>st.currentUser}),p({initTcb:lt}),e.CLOUD_API=Ne,e.CLOUD_SDK=at,e.DATASET_CONTEXT=u,e.DS_SDK=Ae,e.EXTRA_API=$,e.OauthClientStorgeBase=U,e.PromiseAllSettled=b,e.TCBError=c,e._generatePrivatelinkAdapter=D,e.callDataSource=te,e.clearCache=tt,e.createDataset=function(e,n,i){p({currentPageId:e});const r=(f("datasetProfiles")||{})[e],o=t.observable({state:{$status:{}},params:{}});if(u[e]=o,!r)return o;const s=ze(r.params,n),a=We(r.state,{appId:null==i?void 0:i.appId,datasetProfileKey:e});return Object.assign(o.params,s),Object.assign(o.state,a),o},e.createParamsVar=ze,e.createSetDefaultParams=function(e){return t=>{O(e,t)}},e.createStateDataSourceVar=function(e,t){var n,i;return o(this,void 0,void 0,(function*(){const r=null===(n=u[e])||void 0===n?void 0:n.state,s=f("datasetProfiles")||{},a=null===(i=s[e])||void 0===i?void 0:i.state;if(!r||!a)return;Object.keys(a).forEach((n=>o(this,void 0,void 0,(function*(){const i=a[n];if("datasource"===i.varType){if(!i.initMethod||!i.initMethod.name)return r[n]={},void(r.$status[n]={status:"idle"});try{r.$status[i.name]={status:"loading"};const{initMethod:n}=i,o=yield Ne.callDataSource({name:i.dataSourceName,methodName:n.name,params:t(n.params,n),options:{showLoading:!0}});L(`${e}.${i.name}`,o)}catch(t){console.error(`[weda-cloud-sdk] 初始化变量 ${e}.${i.name} 失败`,t),L(`${e}.${i.name}`,t)}}}))))}))},e.createStaticStateVar=We,e.dealCache=et,e.deepClone=A,e.deepMerge=function e(t,n){const i=Object.assign({},t);return Object.keys(n).forEach((t=>{n.hasOwnProperty(t)&&("object"!=typeof n[t]||Array.isArray(n[t])||"object"!=typeof i[t]?i[t]=n[t]:i[t]=e(i[t],n[t]))})),i},e.execOnce=y,e.generateOauthClientRequest=E,e.generateParamsParser=function(e){return t=>{if(!t)return t;const n={};return Object.keys(t).forEach((i=>{n[i]=t[i](e.app,e.$page,e.$w)})),n}},e.getAccessToken=function(){return o(this,void 0,void 0,(function*(){const{auth:e}=yield Ke();if(e.getAccessToken)return e.getAccessToken();if(e.getAuthHeader){const t=e.getAuthHeader();return t?Object.assign({},t,{accessToken:t["x-cloudbase-credentials"]}):t}}))},e.getCommonCloudFnName=g,e.getConfig=f,e.getDataSourceViewId=h,e.getDatasetProfiles=N,e.getDatasourceCloudFnName=function(e){return d.useLegacyDatasource?`lcap-${e.id}-${e.name}${d.isProd?"":"-preview"}`:"lowcode-datasource"+(d.isProd?"":"-preview")},e.getDefaultParams=I,e.getTcbInstance=Ke,e.getUrlPath=k,e.hasOwn=l,e.initTcb=lt,e.isObject=x,e.isSameArray=m,e.isString=T,e.pick=w,e.setConfig=p,e.setDatasetProfiles=function(e){p({datasetProfiles:Object.assign(f("datasetProfiles")||{},e)})},e.setDefaultParams=O,e.setLocalDatasetState=function(e,t,n,i){var r,o;const s=Ge(e,t,n);if(s){const a=(null===(r=N(t))||void 0===r?void 0:r.state)||{};if(void 0===i)Ve.delete(s);else{const t=JSON.stringify(i);let r;try{r=JSON.stringify(null===(o=null==a?void 0:a[n])||void 0===o?void 0:o.initialValue)}catch(e){}if(t===r)Ve.delete(s);else try{Ve.set(s,t)}catch(t){if(/exceed storage max size/.test(null==t?void 0:t.message)||"QuotaExceededError"===t.name||"NS_ERROR_DOM_QUOTA_REACHED"===t.name){(X.getKeysSync()||[]).forEach((t=>{t.startsWith("dataset_")&&!t.startsWith(`dataset_${e}`)&&Promise.resolve().then((()=>{Ve.delete(s)}))}))}else Ve.delete(s);throw t}}}},e.useTcbApi=function(){return"tcb-api"===f("endpointType")},Object.defineProperty(e,"__esModule",{value:!0})}));
